var W=Object.defineProperty,G=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var M=(e,u,o)=>u in e?W(e,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[u]=o,f=(e,u)=>{for(var o in u||(u={}))J.call(u,o)&&M(e,o,u[o]);if(A)for(var o of A(u))X.call(u,o)&&M(e,o,u[o]);return e},R=(e,u)=>G(e,T(u));import{r as $,U as z,_ as L,u as Q,b as Y,d as j,O}from"./index.1a2bb961.js";import{d as P,r as K,c as H,i as x,I as k,Y as v,O as ee,o as ue,E as D,m as F,q as b,y as t,G as l,z as h,F as y,A as te,C as _}from"../vendors/element-plus-6f9977bb.js";import{C as ae}from"./concurrent-3772512c.js";import{r as oe}from"./departmentmanage-17d266d9.js";import{u as w}from"./unique-bfe2af3c.js";import{_ as re}from"./tip-1b2ff95a.js";function se(e){return $.post(z.ORDER.addMiddleTableOrder,e)}function le(e,u){const o=new ae({concurrent:5,total:e.length,requestFunc:se});for(let i=0;i<e.length;i++)o.request(e[i],u)}const ne=P({setup(){const e=Q(),u=Y(),o=j(),i={FROM_WHERE:"/orderadd"},r=K({loginUser:H(()=>o.getters.user),searchParam:{invoiceTogether:!0},totalMoney:H(()=>r.tableData.reduce((a,p)=>{const{purchase_number:c,purchase_price:d}=p;return a+=Number(c)*Number(d),a},0)),tableData:[],headersConfig:[{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u54C1\u724C",prop:"brand"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7C7B\u578B",prop:"type"},{label:"\u89C4\u683C",prop:"size"},{label:"\u50A8\u5B58\u6761\u4EF6",prop:"restore_condition"},{label:"\u6E29\u5EA6\u8303\u56F4",prop:"temperature"},{label:"\u5230\u8D27\u8303\u56F4",prop:"arrived_scope"},{label:"\u5230\u8D27\u65E5\u671F",prop:"arrived_date"},{label:"\u8BF7\u8D2D\u6570\u91CF",prop:"purchase_number"},{label:"\u91C7\u8D2D\u5355\u4EF7",prop:"purchase_price"},{label:"\u6253\u5370\u5F00\u74F6\u6807\u8D34",prop:"print_label"},{label:"\u6240\u5C5E\u90E8\u95E8",prop:"department"},{label:"\u6240\u5C5E\u4EEA\u5668",prop:"instrument"},{label:"\u5F00\u5C01\u6548\u671F",prop:"open_expire"},{label:"\u5E93\u5B58\u4F4D\u7F6E",prop:"store_position"},{label:"\u91C7\u8D2D\u5355\u4F4D",prop:"purchase_unit"},{label:"\u6700\u5C0F\u5355\u4F4D",prop:"min_unit"},{label:"\u552F\u4E00\u7BA1\u7406\u7801",prop:"unique_code"},{label:"\u662F\u5426\u8D60\u54C1",prop:"is_gift"},{label:"\u91C7\u8D2D\u72B6\u6001",prop:"purchase_status"},{label:"\u516C\u5171\u8BD5\u5242",prop:"public"},{label:"\u6700\u5C0F\u5355\u4F4D\u91C7\u8D2D",prop:"min_unit_purchase"},{label:"\u4F9B\u5E94\u5546",prop:"supplier"},{label:"\u5F00\u7968\u516C\u53F8",prop:"invoice_company"},{label:"\u53D1\u8D27\u516C\u53F8",prop:"ship_company"}],orderaddDialog:!1,orderadding:!1,departmentIdMap:new Map}),g={calcHeaderWidth:x("calcHeaderMinWidth"),handleOrderAdd(){r.orderaddDialog=!0},confirmOrderAdd(){const a=k(r.tableData),{Username:p,identities:c}=k(r.loginUser),d=JSON.parse(c);if(!d.activeIdentity)return r.orderaddDialog=!1,v({title:"\u9519\u8BEF\u63D0\u793A",message:"\u5F53\u524D\u767B\u9646\u7684\u7528\u6237\u6CA1\u6709\u8BBE\u7F6E\u6FC0\u6D3B\u7684\u89D2\u8272\uFF0C\u8BF7\u524D\u5F80\u7528\u6237\u7BA1\u7406\u8FDB\u884C\u8BBE\u7F6E\u6216\u8005\u8054\u7CFB\u7BA1\u7406\u5458\u8FDB\u884C\u6FC0\u6D3B\uFF01",type:"error"});const C=d.activeIdentity.department,E=new Date,n=a.map((m,s)=>{const{serverObj:B,id:q,material_name:S,hospital_code:Z,size:U,purchase_unit:I,purchase_number:N,supplier:V}=m;return{RZ_XH:w.uniqueRZXH(E)+s,DJH:w.uniqueDJH(E)+s,SHRQ:O(),ZCXH:q,ZCDM:Z,ZCMC:S,GGXH:U,UNIT:I,AMOUNT:N,SQBMDM:C,SQBMMC:r.departmentIdMap.get(C),GHDWXH:B.supplier,GHDWMC:V,SYZT:"0",ZFY:"0",MEMO:"0",JLZT:"0",JLSCRQ:O(),ZDRDM:p,ZDRMC:p,DDBZ:"",Remark:"",buy_a_to_b:""}});le(n,m=>{m.every(s=>s.success)&&(v({title:"\u64CD\u4F5C\u6210\u529F",message:"\u7531\u4E8E\u7B2C\u4E09\u65B9\u7CFB\u7EDF\u7684\u5EF6\u8FDF\uFF0C2\u5206\u949F\u540E\u53EF\u4EE5\u5728\u8BA2\u5355\u5217\u8868\u4E2D\u67E5\u770B\u5230\u60A8\u521A\u521A\u6DFB\u52A0\u7684\u8BA2\u5355\u3002",type:"success"}),e.push(i.FROM_WHERE)),r.orderaddDialog=!1})},handleGoBack(){e.go(-1)}};return ee(()=>{let a=u.params.tableData;if(!a||(a=JSON.parse(a),!a.length))return e.push(i.FROM_WHERE);r.tableData=a.map(p=>R(f({},p),{purchase_number:1}))}),ue(()=>{oe().then(a=>{a.departments.forEach(p=>{const{id:c,name:d}=p;r.departmentIdMap.set(Number(c),d),r.departmentIdMap.set(String(c),d)})})}),f({state:r},g)}}),pe={class:"total-money"},de=_("\u91C7\u8D2D\u603B\u91D1\u989D\uFF1A"),ie={class:"money"},ce=_("\u786E\u5B9A\u91C7\u8D2D"),_e=_("\u8FD4\u56DE\u9009\u62E9"),me={style:{"margin-left":"4px"}},De={key:1},Fe=t("div",{class:"title"},"\u63D0\u793A",-1),be={class:"tip-body"},he=t("img",{src:re,alt:""},null,-1),Ce=_("\u786E\u8BA4\u8981\u5BF9\u9009\u4E2D\u7684"),Ee={class:"item-name"},Be=_("\u4E2A\u7269\u6599\u8FDB\u884C\u91C7\u8D2D\u5417?"),fe={class:"right-footer"},ye=_("\u53D6\u6D88"),ge=_("\u786E\u5B9A");function Ae(e,u,o,i,r,g){const a=D("el-button"),p=D("styled-search"),c=D("el-input"),d=D("el-table-column"),C=D("styled-table"),E=D("el-dialog");return F(),b(y,null,[t(p,{"hide-search-more":""},{"styled-search-left":l(()=>[t("span",pe,[de,t("span",ie,"\uFFE5"+h(e.state.totalMoney),1)])]),"styled-search-right":l(()=>[t(a,{type:"primary",class:"search",onClick:e.handleOrderAdd},{default:l(()=>[ce]),_:1},8,["onClick"]),t(a,{type:"primary",plain:"",onClick:e.handleGoBack},{default:l(()=>[_e]),_:1},8,["onClick"])]),_:1}),t(C,{data:e.state.tableData},{"table-columns":l(()=>[(F(!0),b(y,null,te(e.state.headersConfig,(n,m)=>(F(),b(d,{"show-overflow-tooltip":"",key:m,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,m)},{header:l(s=>[t("span",null,h(s.column.label),1)]),default:l(s=>[s.column.property==="purchase_number"?(F(),b(y,{key:0},[t(c,{size:"small",style:{width:"calc(100% - 40px)"},type:"text",modelValue:s.row[n.prop],"onUpdate:modelValue":B=>s.row[n.prop]=B},null,8,["modelValue","onUpdate:modelValue"]),t("span",me,h(s.row.purchase_unit),1)],64)):(F(),b("span",De,h(s.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"]),t(E,{width:"466px",modelValue:e.state.orderaddDialog,"onUpdate:modelValue":u[2]||(u[2]=n=>e.state.orderaddDialog=n)},{title:l(()=>[Fe]),footer:l(()=>[t("div",fe,[t(a,{onClick:u[1]||(u[1]=n=>e.state.orderaddDialog=!1),class:"cancel"},{default:l(()=>[ye]),_:1}),t(a,{type:"primary",loading:e.state.orderadding,onClick:e.confirmOrderAdd,class:"confirm"},{default:l(()=>[ge]),_:1},8,["loading","onClick"])])]),default:l(()=>[t("div",be,[he,t("span",null,[Ce,t("span",Ee,h(e.state.tableData.length),1),Be])])]),_:1},8,["modelValue"])],64)}var qe=L(ne,[["render",Ae]]);export{qe as default};
