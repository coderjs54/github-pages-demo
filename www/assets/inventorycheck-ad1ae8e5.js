var Z=Object.defineProperty,x=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var V=(e,t,s)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,A=(e,t)=>{for(var s in t||(t={}))ae.call(t,s)&&V(e,s,t[s]);if(z)for(var s of z(t))te.call(t,s)&&V(e,s,t[s]);return e},U=(e,t)=>x(e,ee(t));import{d as ne,i as W,r as oe,c as B,I as p,S as re,w as se,o as le,j as ie,k as ue,E as c,m as _,q as w,y as l,N as de,t as pe,x as ce,z as P,C as N,F as G,A as he,B as ge}from"../vendors/element-plus-6f9977bb.js";import{r as $,U as q,_ as me,d as Ce,u as ye,b as be}from"./index.1a2bb961.js";function L(e){return $.post(q.INVENTORY.queryInventory,e)}function Se(e){return $.post(q.INVENTORY.getInventoryCheckRecords,e)}const De=ne({setup(){const e=Ce(),t=ye(),s=be(),R=W("setTableHeaders"),M=()=>{a.loading=!0;const{pageSize:o,currentPage:r}=p(a.pagination),{searchWord:n,dateRange:i,diseaseType:u,isDanger:m}=p(a.searchParam),{department:C,materialType:y,brand:b,instrument:S,warehouse:D}=p(a.searchMoreParam),[f,k]=i||["",""];L({InStoreBeginDate:f,InStoreEndDate:k,SearchWord:n,NeedCheckHChemical:!0,isHazardousChemical:m,DiseaseType:u,DepartmentId:C,MaterialType:y,Brand:b,Instrument:S,GoodsShelf:D,IsBelongToMe:!1,NeedPaging:!0,PageNo:r,RecordPerPage:o,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then(h=>{a.pagination.total=h.TotalRecordCount,F(h.StoreInfo),T()}).finally(()=>{a.loading=!1})},H=()=>{const{pageSize:o,currentPage:r}=p(a.pagination),{searchWord:n,dateRange:i,diseaseType:u,isDanger:m}=p(a.searchParam),{department:C,materialType:y,brand:b,instrument:S,warehouse:D}=p(a.searchMoreParam),[f,k]=i||["",""];return L({InStoreBeginDate:f,InStoreEndDate:k,SearchWord:n,NeedCheckHChemical:!0,isHazardousChemical:m,DiseaseType:u,DepartmentId:C,MaterialType:y,Brand:b,Instrument:S,GoodsShelf:D,IsBelongToMe:!1,NeedPaging:!1,PageNo:r,RecordPerPage:o,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then(h=>h.StoreInfo)},T=()=>{const o={BeginDate:"",EndDate:"",SearchWord:"",StockTakingId:"",DepartmentId:"0",Status:"\u76D8\u70B9\u4E2D",IsHChemical:a.searchParam.isDanger?"1":"0",MaterialType:"",Brand:"",Instrument:"",GoodsShelf:"",NeedPaging:!1,PageNo:"",RecordPerPage:""};Se(o).then(r=>{a.unFinishedCheckAmount=r.stRecords.length})},F=o=>{a.tableData=o.map(r=>{const{material:n,store:i}=r,{id:u,MaterialId:m,Operator1Id:C,amount:y,GoodsShelf:b,EndDate:S,CloneNumber:D,unit:f,DiseaseType:k,LotNumber:E,DepartmentName:h}=i,{system_code:Y,name:O,short_name:j,brand_id:K,material_type:Q,spec:J}=n||{},X=a.brandIdMap[K];return{id:u,hospital_code:m,system_code:Y,name:O,Operator1Id:C,position1:b,shortname:j,LotNumber:E,brand:X,department:h,inventory:y,price:"",amount:"",unit:a.MinUnitTypeMap.get(f),size:J,kind:a.MaterialTypeMap.get(Q),validity:S.substring(0,10),CloneNumber:D,DiseaseType:k}})},a=oe({loading:!1,MinUnitTypeMap:B(()=>e.getters.MinUnitTypeMap),searchParam:{searchWord:"",dateRange:"",diseaseType:"",isDanger:!1},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},unFinishedCheckAmount:0,pagination:{currentPage:1,total:0,pageSize:300},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C\u540D\u79F0",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u7269\u6599\u6548\u671F",prop:"validity"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],multipleSelection:[],hospitalCodeMap:new Map,brandIdMap:B(()=>e.getters.brandIdMap),MaterialTypeMap:B(()=>e.getters.MaterialTypeMap),chosenHospitalCodes:[]}),g=o=>{o&&(a.pagination.currentPage=1),M()},v=B(()=>a.headersConfig.filter(o=>!o.hidden)),I={calcHeaderWidth:W("calcHeaderMinWidth"),handleClickSetting(){R(a.headersConfig,o=>{a.headersConfig=o})},handlePaginationChange(){g(!1)},handleSearch(){g(!0)},handleSearchMoreParamChange(o){a.searchMoreParam=o,g(!0)},handleChangeMultiple(o){a.multipleSelection=o},handleAddToCheckList(){const r=p(a.multipleSelection).map(n=>n.hospital_code);r.push(...a.chosenHospitalCodes),a.chosenHospitalCodes=[...new Set(r)]},handleGoToCheckInventory(){!p(a.multipleSelection).length||t.push(`/inventorychecking?danger=${a.searchParam.isDanger}&hospital_codes=${a.chosenHospitalCodes.join(",")}`)},handleGoToCheckAllInventory(){H().then(o=>{const r=[...new Set(o.map(n=>{var i;return(i=n.material)==null?void 0:i.hospital_code}).filter(Boolean))];if(!r.length)return re.error("\u76EE\u524D\u6CA1\u6709\u53EF\u4F9B\u76D8\u5E93\u7684\u5E93\u5B58");t.push(`/inventorychecking?danger=${a.searchParam.isDanger}&hospital_codes=${r.join(",")}`)})},handleToggleIsDanger(){a.chosenHospitalCodes=[],I.handleSearch()}};return se(()=>e.getters.settings,()=>{a.headersConfig=e.getters.settings[s.name]||a.headersConfig}),le(()=>{M()}),U(A({state:a},I),{headersShown:v})}}),d=ge();ie("data-v-388ba484");const fe={class:"date-box"},ke=N("\u67E5\u8BE2"),Ie=N("\u52A0\u5165\u76D8\u70B9\u6E05\u5355");ue();const Be=d((e,t,s,R,M,H)=>{const T=c("el-date-picker"),F=c("el-input"),a=c("el-button"),g=c("el-switch"),v=c("styled-search"),I=c("el-table-column"),o=c("styled-table"),r=c("styled-pagination");return _(),w(G,null,[l(v,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":d(()=>[l("div",fe,[l(T,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=n=>e.state.searchParam.dateRange=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),l(F,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[2]||(t[2]=n=>e.state.searchParam.searchWord=n),placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57",clearable:"",onKeydown:de(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(a,{type:"primary",class:"search",onClick:e.handleSearch},{default:d(()=>[ke]),_:1},8,["onClick"]),l(g,{modelValue:e.state.searchParam.isDanger,"onUpdate:modelValue":t[3]||(t[3]=n=>e.state.searchParam.isDanger=n),"active-text":"\u5371\u9669\u54C1","inactive-text":"\u975E\u5371\u9669\u54C1",onChange:e.handleToggleIsDanger},null,8,["modelValue","onChange"])]),"styled-search-right":d(()=>[pe(l("span",{class:"warning"},"\u5F53\u524D\u5B58\u5728 "+P(e.state.unFinishedCheckAmount)+" \u6761\u672A\u5B8C\u6210\u7684\u76D8\u70B9\uFF0C\u8BF7\u5230\u76D8\u70B9\u8BB0\u5F55\u4E2D\u5B8C\u6210",513),[[ce,e.state.unFinishedCheckAmount]]),l(a,{type:"success",class:"export",disabled:e.state.multipleSelection.length===0,onClick:e.handleAddToCheckList},{default:d(()=>[Ie]),_:1},8,["disabled","onClick"]),l(a,{type:"success",class:"export",disabled:e.state.chosenHospitalCodes.length===0,onClick:e.handleGoToCheckInventory},{default:d(()=>[N("\u53BB\u76D8\u70B9("+P(e.state.chosenHospitalCodes.length)+")",1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),l(o,{loading:e.state.loading,multiple:"",setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting,onChangeMultiple:e.handleChangeMultiple},{"table-columns":d(()=>[(_(!0),w(G,null,he(e.headersShown,(n,i)=>(_(),w(I,{"show-overflow-tooltip":"",key:i,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,i)},{header:d(u=>[l("span",null,P(u.column.label),1)]),default:d(u=>[l("span",null,P(u.row[n.prop]),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting","onChangeMultiple"]),l(r,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[4]||(t[4]=n=>e.state.pagination.currentPage=n),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[5]||(t[5]=n=>e.state.pagination.pageSize=n),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)});var Fe=me(De,[["render",Be],["__scopeId","data-v-388ba484"]]);export{Fe as default};
