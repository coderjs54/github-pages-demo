var L=Object.defineProperty,W=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var U=(e,t,r)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))K.call(t,r)&&U(e,r,t[r]);if(O)for(var r of O(t))Y.call(t,r)&&U(e,r,t[r]);return e},w=(e,t)=>W(e,q(t));import{d as $,i as C,r as G,c as A,w as j,o as Q,E as d,m as h,q as m,y as u,G as s,N as H,F as V,A as J,z as T,C as F,I as _}from"../vendors/element-plus-6f9977bb.js";import{r as Z,U as x,_ as ee,d as ae,b as te}from"./index.1a2bb961.js";function ne(e){return Z.post(x.OUTWAREHOUSE.queryOutWarehouseRecords,e)}const re=$({setup(){const e=ae(),t=te(),r=C("exportPDF"),k=C("exportXLSX"),I=C("setTableHeaders"),E=()=>{n.loading=!0;const{pageSize:o,currentPage:g}=_(n.pagination),{shortname:a,dateRange:p,diseaseType:l,cloneNumber:P}=_(n.searchParam),{department:D,materialType:N,brand:B,instrument:M,warehouse:v}=_(n.searchMoreParam),[z,X]=p||["",""];ne({search_word:a,QueryHChemical:1,departmentId:"",InStoreBeginTime:z,InStoreEndTime:X,CloneNumber:P,DiseaseType:l,DepartmentId:D,MaterialType:N,Brand:B,Instrument:M,GoodsShelf:v,NeedPaging:!0,PageNo:g,RecordPerPage:o}).then(R=>{n.pagination.total=R.TotalRecordCount,S(R.stores)}).finally(()=>{n.loading=!1})},S=o=>{n.tableData=o.map(g=>{const{material:a,store:p}=g,{MaterialinThisStage:l,ChangeReason:P,OperateTime:D,departmentId:N,unit:B,departmentName:M}=p;return w(b({},p),{currStage:P,MaterialinThisStage:l?"\u662F":"\u5426",OperateTime:D.substr(0,19).replace("T"," "),departmentName:M,unit:n.MinUnitTypeMap.get(B),material_name:a.name,shortname:a==null?void 0:a.short_name,standard:a==null?void 0:a.spec,brandName:n.brandIdMap[a==null?void 0:a.brand_id]})})},i=o=>{o&&(n.pagination.currentPage=1),E()},c={currentStages:{\u4E00\u7EA7\u51FA\u5E93:"level-one-out",\u4E8C\u7EA7\u51FA\u5E93:"level-two-out",\u4E09\u7EA7\u51FA\u5E93:"level-three-out"}},n=G({loading:!1,searchParam:{shortname:"",dateRange:"",cloneNumber:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u8BA2\u5355\u53F7",prop:"DeliverOrderId"},{label:"\u9662\u5185\u7801",prop:"MaterialId"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u89C4\u683C\u578B\u53F7",prop:"standard"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u6548\u671F",prop:"EndDate",width:160},{label:"\u6570\u91CF",prop:"amount"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u51FA\u5E93\u4EBA",prop:"Operator1Id"},{label:"\u7B2C\u4E00\u9A8C\u6536\u4EBA",prop:"Operator2Id"},{label:"\u7B2C\u4E8C\u9A8C\u6536\u4EBA",prop:"Operator3Id"},{label:"\u51FA\u5E93\u65F6\u95F4",prop:"OperateTime"},{label:"\u51FA\u5E93\u7B49\u7EA7",prop:"currStage"},{label:"\u6240\u5C5E\u90E8\u95E8",prop:"departmentName"}],tableData:[],pagination:{currentPage:1,total:0,pageSize:30},PDFHandling:!1,MinUnitTypeMap:A(()=>e.getters.MinUnitTypeMap),brandIdMap:A(()=>e.getters.brandIdMap)}),y=A(()=>n.headersConfig.filter(o=>!o.hidden)),f={calcHeaderWidth:C("calcHeaderMinWidth"),handleClickSetting(){I(n.headersConfig,o=>{n.headersConfig=o})},handlePaginationChange(){i(!1)},handleSearch(){i(!0)},handleSearchMoreParamChange(o){n.searchMoreParam=o,i(!0)},handleExportXLSX(){k(n.headersConfig,n.tableData,"\u5371\u9669\u54C1\u51FA\u5E93\u8BB0\u5F55","\u5371\u9669\u54C1\u51FA\u5E93\u8BB0\u5F55\u8BE6\u60C5")},handleExportPDF(){n.PDFHandling=!0,r(n.headersConfig,n.tableData,"\u5371\u9669\u54C1\u51FA\u5E93\u8BB0\u5F55").finally(()=>{n.PDFHandling=!1})}};return j(()=>e.getters.settings,()=>{n.headersConfig=e.getters.settings[t.name]||n.headersConfig}),Q(()=>{E()}),w(b(b({state:n},f),c),{headersShown:y})}}),oe={class:"date-box"},ue=F("\u67E5\u8BE2"),le=F("\u5BFC\u51FAxlsx "),se=F("\u5BFC\u51FApdf "),de={key:1};function pe(e,t,r,k,I,E){const S=d("el-date-picker"),i=d("el-input"),c=d("el-button"),n=d("styled-search"),y=d("el-tag"),f=d("el-table-column"),o=d("styled-table"),g=d("styled-pagination");return h(),m(V,null,[u(n,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":s(()=>[u("div",oe,[u(S,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),u(i,{modelValue:e.state.searchParam.shortname,"onUpdate:modelValue":t[2]||(t[2]=a=>e.state.searchParam.shortname=a),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u540D\u79F0\u3001\u7B80\u79F0\u3001\u6216\u9662\u5185\u7801",clearable:"",onKeydown:H(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),u(i,{modelValue:e.state.searchParam.cloneNumber,"onUpdate:modelValue":t[3]||(t[3]=a=>e.state.searchParam.cloneNumber=a),placeholder:"\u8BF7\u8F93\u5165\u514B\u9686\u53F7",clearable:"",onKeydown:H(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),u(c,{type:"primary",class:"search",onClick:e.handleSearch},{default:s(()=>[ue]),_:1},8,["onClick"])]),"styled-search-right":s(()=>[u(c,{type:"success",class:"export",disabled:e.state.tableData.length===0,onClick:e.handleExportXLSX},{default:s(()=>[le]),_:1},8,["disabled","onClick"]),u(c,{type:"success",class:"export",disabled:e.state.tableData.length===0,loading:e.state.PDFHandling,onClick:e.handleExportPDF},{default:s(()=>[se]),_:1},8,["disabled","loading","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),u(o,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":s(()=>[(h(!0),m(V,null,J(e.headersShown,(a,p)=>(h(),m(f,{"show-overflow-tooltip":"",key:p,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,p)},{header:s(l=>[u("span",null,T(l.column.label),1)]),default:s(l=>[l.column.property==="currStage"?(h(),m(y,{key:0,class:e.currentStages[l.row[a.prop]]},{default:s(()=>[F(T(l.row[a.prop]),1)]),_:2},1032,["class"])):(h(),m("span",de,T(l.row[a.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting"]),u(g,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[4]||(t[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[5]||(t[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var me=ee(re,[["render",pe]]);export{me as default};
