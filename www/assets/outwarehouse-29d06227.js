var Q=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var H=(e,t,r)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))x.call(t,r)&&H(e,r,t[r]);if(W)for(var r of W(t))ee.call(t,r)&&H(e,r,t[r]);return e},I=(e,t)=>X(e,Z(t));import{d as ae,i as R,r as te,c as y,I as D,w as ne,o as oe,E as i,m as c,q as h,y as s,G as u,N as re,C as f,z as m,F as V,A as le}from"../vendors/element-plus-6f9977bb.js";import{r as se,U as ue,_ as ie,d as pe,u as de,b as ce}from"./index.1a2bb961.js";function he(e){return se.post(ue.OUTWAREHOUSE.queryUsable,e)}const ge=ae({setup(){const e=pe(),t=de(),r=ce(),U=R("exportPDF"),z=R("setTableHeaders"),S=()=>{a.loading=!0;const{pageSize:o,currentPage:p}=D(a.pagination),{dateRange:n,searchWord:d}=D(a.searchParam),{department:l,materialType:E,brand:_,instrument:k,warehouse:w}=D(a.searchMoreParam),[B,T]=n||["",""];he({BeginDate:B,EndDate:T,SearchWord:d,DepartmentId:l,MaterialType:E,Brand:_,Instrument:k,GoodsShelf:w,isHazardousChemical:0,NeedPaging:!0,PageNum:p,RecordPerPage:o}).then(C=>{a.pagination.total=C.TotalRecordCount,F(C.Stores)}).finally(()=>{a.loading=!1})},F=o=>{a.tableData=o.map(p=>{const{material:n,store:d}=p,{id:l,MaterialId:E,Operator1Id:_,amount:k,unit:w,GoodsShelf:B,EndDate:T,CloneNumber:N,DiseaseType:C,DepartmentName:q,LotNumber:A,ChangeReason:L}=d,{system_code:O,name:G,short_name:Y,brand_id:$,material_type:K,spec:j}=n||{},J=a.brandIdMap[$];return{material:n,id:l,LotNumber:A,DiseaseType:C,inventory_check_status:p.InStockStaking?"\u76D8\u5E93\u4E2D":"\u53EF\u9886\u7528",hospital_code:E,system_code:O,name:G,Operator1Id:_,ChangeReason:L,shortname:Y,brand:J,department:q,inventory:k,price:"",amount:"",size:j,unit:a.MinUnitTypeMap.get(w),kind:a.MaterialTypeMap.get(K),validity:T.substring(0,10),position1:B,CloneNumber:N}})},M={changeReasons:{\u4E09\u7EA7\u51FA\u5E93:"level-three-out",\u9886\u7528:"request-for-use",\u7528\u5269\u5F52\u8FD8:"return-back"},inventoryCheckStatus:{\u53EF\u9886\u7528:"default",\u76D8\u5E93\u4E2D:"danger"}},a=te({loading:!1,MaterialTypeMap:y(()=>e.getters.MaterialTypeMap),MinUnitTypeMap:y(()=>e.getters.MinUnitTypeMap),searchParam:{dateRange:"",searchWord:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u76D8\u70B9\u72B6\u6001",prop:"inventory_check_status"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u5E93\u5B58\u53D8\u52A8\u539F\u56E0",prop:"ChangeReason"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:110},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],multipleSelection:[],PDFHandling:!1,brandIdMap:y(()=>e.getters.brandIdMap)}),g=o=>{o&&(a.pagination.currentPage=1),S()},b=y(()=>a.headersConfig.filter(o=>!o.hidden)),P={calcHeaderWidth:R("calcHeaderMinWidth"),handleClickSetting(){z(a.headersConfig,o=>{a.headersConfig=o})},handlePaginationChange(){g(!1)},handleSearch(){g(!0)},handleSearchMoreParamChange(o){a.searchMoreParam=o,g(!0)},handleChangeMultiple(o){a.multipleSelection=o},handleModify(o){console.log(o)},handleExportPDF(){a.PDFHandling=!0,U(a.headersConfig,a.tableData,"\u6D4B\u8BD5\u6587\u4EF6").finally(()=>{a.PDFHandling=!1})},handleGoToOutWarehouse(){const o=D(a.multipleSelection);!o.length||t.push({name:"outwarehousing",params:{chosenTableData:JSON.stringify(o)}})}};return ne(()=>e.getters.settings,()=>{a.headersConfig=e.getters.settings[r.name]||a.headersConfig}),oe(()=>{S()}),I(v(v({state:a},P),M),{headersShown:b})}}),me={class:"date-box"},be=f("\u67E5\u8BE2"),Ce={key:2};function ye(e,t,r,U,z,S){const F=i("el-date-picker"),M=i("el-input"),a=i("el-button"),g=i("styled-search"),b=i("el-tag"),P=i("el-table-column"),o=i("styled-table"),p=i("styled-pagination");return c(),h(V,null,[s(g,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":u(()=>[s("div",me,[s(F,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=n=>e.state.searchParam.dateRange=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),s(M,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[2]||(t[2]=n=>e.state.searchParam.searchWord=n),placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u5B57",clearable:"",onKeydown:re(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),s(a,{type:"primary",class:"search",onClick:e.handleSearch},{default:u(()=>[be]),_:1},8,["onClick"])]),"styled-search-right":u(()=>[s(a,{type:"success",class:"export",onClick:e.handleGoToOutWarehouse,disabled:e.state.multipleSelection.length===0},{default:u(()=>[f("\u51FA\u5E93("+m(e.state.multipleSelection.length)+") ",1)]),_:1},8,["onClick","disabled"])]),_:1},8,["onChooseSearchMoreParam"]),s(o,{loading:e.state.loading,multiple:"",setting:"",data:e.state.tableData,onChangeMultiple:e.handleChangeMultiple,onClickSetting:e.handleClickSetting},{"table-columns":u(()=>[(c(!0),h(V,null,le(e.headersShown,(n,d)=>(c(),h(P,{"show-overflow-tooltip":"",key:d,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,d)},{header:u(l=>[s("span",null,m(l.column.label),1)]),default:u(l=>[l.column.property==="ChangeReason"?(c(),h(b,{key:0,class:e.changeReasons[l.row[n.prop]]},{default:u(()=>[f(m(l.row[n.prop]),1)]),_:2},1032,["class"])):l.column.property==="inventory_check_status"?(c(),h(b,{key:1,type:e.inventoryCheckStatus[l.row[n.prop]]},{default:u(()=>[f(m(l.row[n.prop]),1)]),_:2},1032,["type"])):(c(),h("span",Ce,m(l.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onChangeMultiple","onClickSetting"]),s(p,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[3]||(t[3]=n=>e.state.pagination.currentPage=n),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[4]||(t[4]=n=>e.state.pagination.pageSize=n),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var Fe=ie(ge,[["render",ye]]);export{Fe as default};
