System.register(["./index-legacy.acc39ef9.js","../vendors/element-plus-legacy-e48d1ae3.js","./concurrent-legacy-5288d5cc.js","./departmentmanage-legacy-17c36275.js","./unique-legacy-208d2722.js","./tip-legacy-d18ff986.js"],(function(e){"use strict";var a,t,r,l,o,n,p,s,d,i,c,u,m,b,h,_,g,y,f,D,M,C,v,k,w,H,O,Z;return{setters:[function(e){a=e.r,t=e.U,r=e._,l=e.u,o=e.b,n=e.d,p=e.O},function(e){s=e.d,d=e.r,i=e.c,c=e.i,u=e.I,m=e.Y,b=e.O,h=e.o,_=e.E,g=e.m,y=e.q,f=e.y,D=e.G,M=e.z,C=e.F,v=e.A,k=e.C},function(e){w=e.C},function(e){H=e.r},function(e){O=e.u},function(e){Z=e._}],execute:function(){function R(e){return a.post(t.ORDER.addMiddleTableOrder,e)}const S=s({setup(){const e=l(),a=o(),t=n(),r="/orderadd",s=d({loginUser:i((()=>t.getters.user)),searchParam:{invoiceTogether:!0},totalMoney:i((()=>s.tableData.reduce(((e,a)=>{const{purchase_number:t,purchase_price:r}=a;return e+=Number(t)*Number(r)}),0))),tableData:[],headersConfig:[{label:"院内码",prop:"hospital_code"},{label:"物料名称",prop:"material_name"},{label:"品牌",prop:"brand"},{label:"系统码",prop:"system_code"},{label:"类型",prop:"type"},{label:"规格",prop:"size"},{label:"储存条件",prop:"restore_condition"},{label:"温度范围",prop:"temperature"},{label:"到货范围",prop:"arrived_scope"},{label:"到货日期",prop:"arrived_date"},{label:"请购数量",prop:"purchase_number"},{label:"采购单价",prop:"purchase_price"},{label:"打印开瓶标贴",prop:"print_label"},{label:"所属部门",prop:"department"},{label:"所属仪器",prop:"instrument"},{label:"开封效期",prop:"open_expire"},{label:"库存位置",prop:"store_position"},{label:"采购单位",prop:"purchase_unit"},{label:"最小单位",prop:"min_unit"},{label:"唯一管理码",prop:"unique_code"},{label:"是否赠品",prop:"is_gift"},{label:"采购状态",prop:"purchase_status"},{label:"公共试剂",prop:"public"},{label:"最小单位采购",prop:"min_unit_purchase"},{label:"供应商",prop:"supplier"},{label:"开票公司",prop:"invoice_company"},{label:"发货公司",prop:"ship_company"}],orderaddDialog:!1,orderadding:!1,departmentIdMap:new Map}),_={calcHeaderWidth:c("calcHeaderMinWidth"),handleOrderAdd(){s.orderaddDialog=!0},confirmOrderAdd(){const a=u(s.tableData),{Username:t,identities:l}=u(s.loginUser),o=JSON.parse(l);if(!o.activeIdentity)return s.orderaddDialog=!1,m({title:"错误提示",message:"当前登陆的用户没有设置激活的角色，请前往用户管理进行设置或者联系管理员进行激活！",type:"error"});const n=o.activeIdentity.department,d=new Date;!function(e,a){const t=new w({concurrent:5,total:e.length,requestFunc:R});for(let r=0;r<e.length;r++)t.request(e[r],a)}(a.map(((e,a)=>{const{serverObj:r,id:l,material_name:o,hospital_code:i,size:c,purchase_unit:u,purchase_number:m,supplier:b}=e;return{RZ_XH:O.uniqueRZXH(d)+a,DJH:O.uniqueDJH(d)+a,SHRQ:p(),ZCXH:l,ZCDM:i,ZCMC:o,GGXH:c,UNIT:u,AMOUNT:m,SQBMDM:n,SQBMMC:s.departmentIdMap.get(n),GHDWXH:r.supplier,GHDWMC:b,SYZT:"0",ZFY:"0",MEMO:"0",JLZT:"0",JLSCRQ:p(),ZDRDM:t,ZDRMC:t,DDBZ:"",Remark:"",buy_a_to_b:""}})),(a=>{a.every((e=>e.success))&&(m({title:"操作成功",message:"由于第三方系统的延迟，2分钟后可以在订单列表中查看到您刚刚添加的订单。",type:"success"}),e.push(r)),s.orderaddDialog=!1}))},handleGoBack(){e.go(-1)}};return b((()=>{let t=a.params.tableData;return t?(t=JSON.parse(t),t.length?void(s.tableData=t.map((e=>({...e,purchase_number:1})))):e.push(r)):e.push(r)})),h((()=>{H().then((e=>{e.departments.forEach((e=>{const{id:a,name:t}=e;s.departmentIdMap.set(Number(a),t),s.departmentIdMap.set(String(a),t)}))}))})),{state:s,..._}}}),U={class:"total-money"},I=k("采购总金额："),j={class:"money"},q=k("确定采购"),x=k("返回选择"),G={style:{"margin-left":"4px"}},N={key:1},V=f("div",{class:"title"},"提示",-1),A={class:"tip-body"},J=f("img",{src:Z,alt:""},null,-1),T=k("确认要对选中的"),B={class:"item-name"},W=k("个物料进行采购吗?"),X={class:"right-footer"},z=k("取消"),E=k("确定");e("default",r(S,[["render",function(e,a,t,r,l,o){const n=_("el-button"),p=_("styled-search"),s=_("el-input"),d=_("el-table-column"),i=_("styled-table"),c=_("el-dialog");return g(),y(C,null,[f(p,{"hide-search-more":""},{"styled-search-left":D((()=>[f("span",U,[I,f("span",j,"￥"+M(e.state.totalMoney),1)])])),"styled-search-right":D((()=>[f(n,{type:"primary",class:"search",onClick:e.handleOrderAdd},{default:D((()=>[q])),_:1},8,["onClick"]),f(n,{type:"primary",plain:"",onClick:e.handleGoBack},{default:D((()=>[x])),_:1},8,["onClick"])])),_:1}),f(i,{data:e.state.tableData},{"table-columns":D((()=>[(g(!0),y(C,null,v(e.state.headersConfig,((a,t)=>(g(),y(d,{"show-overflow-tooltip":"",key:t,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,t)},{header:D((e=>[f("span",null,M(e.column.label),1)])),default:D((e=>["purchase_number"===e.column.property?(g(),y(C,{key:0},[f(s,{size:"small",style:{width:"calc(100% - 40px)"},type:"text",modelValue:e.row[a.prop],"onUpdate:modelValue":t=>e.row[a.prop]=t},null,8,["modelValue","onUpdate:modelValue"]),f("span",G,M(e.row.purchase_unit),1)],64)):(g(),y("span",N,M(e.row[a.prop]),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["data"]),f(c,{width:"466px",modelValue:e.state.orderaddDialog,"onUpdate:modelValue":a[2]||(a[2]=a=>e.state.orderaddDialog=a)},{title:D((()=>[V])),footer:D((()=>[f("div",X,[f(n,{onClick:a[1]||(a[1]=a=>e.state.orderaddDialog=!1),class:"cancel"},{default:D((()=>[z])),_:1}),f(n,{type:"primary",loading:e.state.orderadding,onClick:e.confirmOrderAdd,class:"confirm"},{default:D((()=>[E])),_:1},8,["loading","onClick"])])])),default:D((()=>[f("div",A,[J,f("span",null,[T,f("span",B,M(e.state.tableData.length),1),W])])])),_:1},8,["modelValue"])],64)}]]))}}}));
