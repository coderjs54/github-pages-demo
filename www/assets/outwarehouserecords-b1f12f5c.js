var L=Object.defineProperty,W=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var H=(e,n,o)=>n in e?L(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,b=(e,n)=>{for(var o in n||(n={}))K.call(n,o)&&H(e,o,n[o]);if(U)for(var o of U(n))Y.call(n,o)&&H(e,o,n[o]);return e},T=(e,n)=>W(e,q(n));import{d as $,i as F,r as G,c as A,w as j,o as Q,E as d,m as g,q as h,y as l,G as u,N as V,F as v,A as J,z as N,C,I as _}from"../vendors/element-plus-6f9977bb.js";import{r as Z,U as x,_ as ee,d as ae,b as te}from"./index.1a2bb961.js";function ne(e){return Z.post(x.OUTWAREHOUSE.queryOutWarehouseRecords,e)}const oe=$({setup(){const e=ae(),n=te(),o=F("exportXLSX"),k=F("exportPDF"),R=F("setTableHeaders"),S=()=>{t.loading=!0;const{pageSize:r,currentPage:c}=_(t.pagination),{shortname:a,dateRange:i,diseaseType:s,cloneNumber:P}=_(t.searchParam),{department:D,materialType:B,brand:M,instrument:w,warehouse:O}=_(t.searchMoreParam),[z,X]=i||["",""];ne({search_word:a,QueryHChemical:0,departmentId:"",InStoreBeginTime:z,InStoreEndTime:X,CloneNumber:P,DiseaseType:s,DepartmentId:D,MaterialType:B,Brand:M,Instrument:w,GoodsShelf:O,NeedPaging:!0,PageNo:c,RecordPerPage:r}).then(I=>{t.pagination.total=I.TotalRecordCount,y(I.stores)}).finally(()=>{t.loading=!1})},y=r=>{t.tableData=r.map(c=>{const{material:a,store:i}=c,{CloneNumber:s,OperateTime:P,MaterialinThisStage:D,ChangeReason:B,unit:M,departmentName:w}=i;return T(b({},i),{currStage:B,MaterialinThisStage:D?"\u662F":"\u5426",OperateTime:P.substr(0,19).replace("T"," "),departmentName:w,unit:t.MinUnitTypeMap.get(M),material_name:a.name,shortname:a==null?void 0:a.short_name,brandName:t.brandIdMap[a==null?void 0:a.brand_id],standard:a==null?void 0:a.spec,cloneNumber:s})})},m={currentStages:{\u4E00\u7EA7\u51FA\u5E93:"level-one-out",\u4E8C\u7EA7\u51FA\u5E93:"level-two-out",\u4E09\u7EA7\u51FA\u5E93:"level-three-out"}},t=G({loading:!1,MinUnitTypeMap:A(()=>e.getters.MinUnitTypeMap),brandIdMap:A(()=>e.getters.brandIdMap),searchParam:{shortname:"",dateRange:"",diseaseType:"",cloneNumber:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u8BA2\u5355\u53F7",prop:"DeliverOrderId"},{label:"\u9662\u5185\u7801",prop:"MaterialId"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u89C4\u683C\u578B\u53F7",prop:"standard"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u6548\u671F",prop:"EndDate",width:160},{label:"\u6570\u91CF",prop:"amount"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u51FA\u5E93\u4EBA",prop:"Operator1Id"},{label:"\u51FA\u5E93\u65F6\u95F4",prop:"OperateTime"},{label:"\u51FA\u5E93\u7B49\u7EA7",prop:"currStage"},{label:"\u6240\u5C5E\u90E8\u95E8",prop:"departmentName"},{label:"\u514B\u9686\u53F7",prop:"cloneNumber"}],tableData:[],PDFHandling:!1}),p=r=>{r&&(t.pagination.currentPage=1),S()},f=A(()=>t.headersConfig.filter(r=>!r.hidden)),E={calcHeaderWidth:F("calcHeaderMinWidth"),handleClickSetting(){R(t.headersConfig,r=>{t.headersConfig=r})},handlePaginationChange(){p(!1)},handleSearch(){p(!0)},handleSearchMoreParamChange(r){t.searchMoreParam=r,p(!0)},handleExportXLSX(){o(t.headersConfig,t.tableData,"\u51FA\u5E93\u8BB0\u5F55","\u51FA\u5E93\u8BB0\u5F55\u8BE6\u60C5")},handleExportPDF(){t.PDFHandling=!0,k(t.headersConfig,t.tableData,"\u51FA\u5E93\u8BB0\u5F55").finally(()=>{t.PDFHandling=!1})}};return j(()=>e.getters.settings,()=>{t.headersConfig=e.getters.settings[n.name]||t.headersConfig}),Q(()=>{S()}),T(b(b({state:t},E),m),{headersShown:f})}}),re={class:"date-box"},le=C("\u67E5\u8BE2"),se=C("\u5BFC\u51FAxlsx"),ue=C("\u5BFC\u51FApdf"),de={key:1};function ie(e,n,o,k,R,S){const y=d("el-date-picker"),m=d("el-input"),t=d("el-button"),p=d("styled-search"),f=d("el-tag"),E=d("el-table-column"),r=d("styled-table"),c=d("styled-pagination");return g(),h(v,null,[l(p,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":u(()=>[l("div",re,[l(y,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":n[1]||(n[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),l(m,{modelValue:e.state.searchParam.shortname,"onUpdate:modelValue":n[2]||(n[2]=a=>e.state.searchParam.shortname=a),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u540D\u79F0\u3001\u7B80\u79F0\u3001\u6216\u9662\u5185\u7801",clearable:"",onKeydown:V(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(m,{modelValue:e.state.searchParam.cloneNumber,"onUpdate:modelValue":n[3]||(n[3]=a=>e.state.searchParam.cloneNumber=a),placeholder:"\u8BF7\u8F93\u5165\u514B\u9686\u53F7",clearable:"",onKeydown:V(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(t,{type:"primary",class:"search",onClick:e.handleSearch},{default:u(()=>[le]),_:1},8,["onClick"])]),"styled-search-right":u(()=>[l(t,{type:"success",class:"export",disabled:e.state.tableData.length===0,onClick:e.handleExportXLSX},{default:u(()=>[se]),_:1},8,["disabled","onClick"]),l(t,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:e.state.tableData.length===0,onClick:e.handleExportPDF},{default:u(()=>[ue]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),l(r,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":u(()=>[(g(!0),h(v,null,J(e.headersShown,(a,i)=>(g(),h(E,{"show-overflow-tooltip":"",key:i,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,i)},{header:u(s=>[l("span",null,N(s.column.label),1)]),default:u(s=>[s.column.property==="currStage"?(g(),h(f,{key:0,class:e.currentStages[s.row[a.prop]]},{default:u(()=>[C(N(s.row[a.prop]),1)]),_:2},1032,["class"])):(g(),h("span",de,N(s.row[a.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting"]),l(c,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":n[4]||(n[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":n[5]||(n[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var me=ee(oe,[["render",ie]]);export{me as default};
