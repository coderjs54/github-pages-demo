System.register(["./index-legacy.acc39ef9.js","../vendors/element-plus-legacy-e48d1ae3.js"],(function(e){"use strict";var a,t,l,r,n,o,s,i,p,d,m,h,c,u,g,y,C,b,M,f,S,D,P;return{setters:[function(e){a=e.r,t=e.U,l=e._,r=e.b,n=e.u,o=e.d,s=e.R},function(e){i=e.d,p=e.i,d=e.r,m=e.c,h=e.Y,c=e.o,u=e.E,g=e.m,y=e.q,C=e.y,b=e.G,M=e.F,f=e.A,S=e.z,D=e.I,P=e.C}],execute:function(){const N=i({setup(){r();const e=n(),l=o(),i=[{label:"部门",prop:"departmentName"},{label:"物料名称",prop:"materialName"}],u=p("exportXLSX"),g=()=>{C.loading=!0;const e=C.subDepartments,{dateRange:l}=D(C.searchParam),[r,n]=l.map((e=>e.substring(0,7))),o=s(r,n);C.months=o,C.headersConfig=i.concat(o.map((e=>({label:`${e}采购量`,prop:e,width:90})))),function(e){return a.post(t.REPORT.queryPurchasedMaterial,e)}({BeginDate:r,EndDate:n,departments:e}).then((e=>(C.hospitalCodesOptions=e.materials.map((e=>({label:e.MaterialName,value:e.MaterialHospitalCode}))),function(e){return a.post(t.REPORT.queryReportByDepartment,e)}({BeginDate:r,EndDate:n,departments:[],hospitalCodes:C.searchParam.hospitalCodes}).then((e=>{y(e.reports)}))))).finally((()=>{C.loading=!1}))},y=e=>{C.tableData=e.map((e=>{const{MaterialName:a,HospitalCode:t,YearMonth:l,TotalAmount:r,departmentDetails:n,unit:o}=e;return{hospitalCode:t,materialName:a,unit:o,departmentName:n[0].DepartmentName,departmentId:n[0].DepartmentId,[l]:r}}))},C=d({loading:!1,MinUnitTypeMap:m((()=>l.getters.MinUnitTypeMap)),MaterialTypeMap:m((()=>l.getters.MaterialTypeMap)),searchParam:{searchWord:"",hospitalCodes:[],dateRange:JSON.parse(localStorage.getItem("dateRange"))||["2021-11-01","2022-03-01"]},months:[],hospitalCodesOptions:[],searchMoreParam:{department:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[],tableData:[],multipleSelection:[],subDepartments:[]}),b=e=>{e&&(C.pagination.currentPage=1),g()},M={calcHeaderWidth:p("calcHeaderMinWidth"),handleChangeMultiple(e){C.multipleSelection=e},handlePaginationChange(){b(!1)},handleSearch(){b(!0)},handleSearchMoreParamChange(e){C.searchMoreParam=e,b(!0)},handleShowLineChart(){const a=C.multipleSelection,t=a.every((e=>e.departmentName===a[0].departmentName)),l=a.every((e=>e.hospitalCode===a[0].hospitalCode));if(t||l)return localStorage.setItem("dateRange",JSON.stringify(C.searchParam.dateRange)),e.push({name:"reportlinechart",params:{unitName:l?a[0].unit:"",sameDepartment:t,sameMaterial:l,months:JSON.stringify(C.months),tableData:JSON.stringify(a)}});h({title:"错误提示",message:"只能选则相同部门的不同物料或者不同部门的相同物料进行查看",type:"error",duration:0})},handleExportXLSX(){u(C.headersConfig,C.tableData,"报表","报表详情")}};return c((()=>{Promise.all([a.get(t.DEPARTMENT.queryDepartment).then((e=>{C.subDepartments=e.departments.map((e=>e.id))}))]).then((()=>{g()}))})),{state:C,...M}}}),R={class:"date-box"},k=P("查询"),v=P("查看折线图"),w=P("下载报表"),E={key:0},O={key:1};e("default",l(N,[["render",function(e,a,t,l,r,n){const o=u("el-date-picker"),s=u("el-option"),i=u("el-select"),p=u("el-button"),d=u("styled-search"),m=u("el-table-column"),h=u("styled-table");return g(),y(M,null,[C(d,{"hide-search-more":"","only-department":"",onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":b((()=>[C("div",R,[C(o,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.searchParam.dateRange=a),"unlink-panels":"",type:"monthrange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),C(i,{modelValue:e.state.searchParam.hospitalCodes,"onUpdate:modelValue":a[2]||(a[2]=a=>e.state.searchParam.hospitalCodes=a),placeholder:"请选择物料院内码",clearable:"",multiple:"","collapse-tags":""},{default:b((()=>[(g(!0),y(M,null,f(e.state.hospitalCodesOptions,((e,a)=>(g(),y(s,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),C(p,{type:"primary",class:"search",onClick:e.handleSearch},{default:b((()=>[k])),_:1},8,["onClick"])])),"styled-search-right":b((()=>[C(p,{type:"primary",class:"search",disabled:e.state.multipleSelection.length<1,onClick:e.handleShowLineChart},{default:b((()=>[v])),_:1},8,["disabled","onClick"]),C(p,{type:"success",class:"export",disabled:0===e.state.tableData.length,onClick:e.handleExportXLSX},{default:b((()=>[w])),_:1},8,["disabled","onClick"])])),_:1},8,["onChooseSearchMoreParam"]),C(h,{multiple:"",loading:e.state.loading,data:e.state.tableData,onChangeMultiple:e.handleChangeMultiple},{"table-columns":b((()=>[(g(!0),y(M,null,f(e.state.headersConfig,((a,t)=>(g(),y(m,{"show-overflow-tooltip":"",key:t,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,t)},{header:b((e=>[C("span",null,S(e.column.label),1)])),default:b((e=>[["departmentName","materialName"].includes(e.column.property)?(g(),y("span",E,S(e.row[a.prop]),1)):(g(),y("span",O,S(e.row[a.prop]&&e.row[a.prop]+e.row.unit),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["loading","data","onChangeMultiple"])],64)}]]))}}}));
