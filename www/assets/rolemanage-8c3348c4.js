var q=Object.defineProperty;var S=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var U=(e,u,r)=>u in e?q(e,u,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[u]=r,E=(e,u)=>{for(var r in u||(u={}))$.call(u,r)&&U(e,r,u[r]);if(S)for(var r of S(u))K.call(u,r)&&U(e,r,u[r]);return e};import{d as N,a as w,r as O,c as H,i as j,I as C,S as L,o as z,w as T,E as F,m as D,q as B,y as l,G as o,N as P,F as W,A as G,z as k,C as m}from"../vendors/element-plus-6f9977bb.js";import{r as _,U as V,_ as J,d as Q}from"./index.1a2bb961.js";import{m as X}from"./menu-ab209e89.js";import{_ as Y}from"./tip-1b2ff95a.js";function Z(e){return _.post(V.ROLE.queryRole,{search_word:e})}function x(e){return _.post(V.ROLE.addRole,e)}function ee(e){return _.post(V.ROLE.modifyRole,e)}function le(e){return _.post(V.ROLE.deleteRole,{id:e})}const oe=N({setup(){const e=Q(),u=(d,i,n)=>{i.length?n():n("\u8BF7\u9009\u62E9\u89D2\u8272\u6743\u9650!")},r=()=>{t.loading=!0;const d=t.searchVal;Z(d).then(i=>{M(i.roles)}).finally(()=>{t.loading=!1})},M=d=>{t.tableData=d.map(i=>{let{id:n,name:R,mark:s,function_list:c}=i;return{server:i,number:n,role:R,module:s||"\u8FD9\u662F\u89D2\u8272\u6807\u8BC6",menuList:c.slice(1,-1).split(",").map(p=>Number(p))}})},y={addFormRef:w(null),modifyFormRef:w(null),addTreeRef:w(null),modifyTreeRef:w(null)},I={labelWidth:"110px",addRoleFormRules:{module:[{required:!0,message:"\u8BF7\u8F93\u5165\u6A21\u5757\u6807\u8BC6",trigger:"blur"}],role:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:"blur"}],menuList:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272\u6743\u9650\uFF01",trigger:"blur"},{validator:u,trigger:"blur"}]},modifyRoleFormRules:{module:[{required:!0,message:"\u8BF7\u8F93\u5165\u6A21\u5757\u6807\u8BC6",trigger:"blur"}],role:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:"blur"}],menuList:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272\u6743\u9650\uFF01",trigger:"blur"},{validator:u,trigger:"blur"}]}},t=O({loading:!1,RoleIds:H(()=>e.getters.RoleIds),searchVal:"",dialogAddRole:!1,dialogModifyRole:!1,dialogDeleteRole:!1,deleteRoleData:{id:"",role:""},tableData:[],headersConfig:[{label:"\u89D2\u8272\u7F16\u53F7",prop:"number"},{label:"\u89D2\u8272\u540D\u79F0",prop:"role"},{label:"\u6A21\u5757\u6807\u8BC6",prop:"module"}],addRoleForm:{role:"",module:"",dangerInspector:!1,buyAToB:!1,menuList:[]},modifyRoleForm:{id:"",role:"",module:"",dangerInspector:!1,buyAToB:!1,menuList:[],functions:[]},treeData:{data:X,defaultProps:{children:"submenus",label:"title"},defaultOpenedKeys:[]}}),f={calcHeaderMinWidth:j("calcHeaderMinWidth"),handleSearch:r,addRole(){t.dialogAddRole=!0},cancelAddRole(){t.dialogAddRole=!1},cancelModifyRole(){t.dialogModifyRole=!1},modifyRole(d){const{CanSeeBuyAToB:i,CanSeeCloneNumber:n,MenuList:R,function_list:s,id:c,isHazardousChemicalAdmin:p,mark:h,name:b}=C(d.server);t.modifyRoleForm={id:c,role:b,module:h,dangerInspector:p,buyAToB:i,menuList:R==null?void 0:R.substring(1,R.length).split(","),functions:s},t.dialogModifyRole=!0},deleteRole(d){t.dialogDeleteRole=!0;const{number:i,role:n}=C(d);t.deleteRoleData={id:i,role:n}},confirmDeleteRole(){const{id:d}=C(t.deleteRoleData);le(d).then(()=>{L.success("\u64CD\u4F5C\u6210\u529F"),r()}).finally(()=>{t.dialogDeleteRole=!1})},confirmAddRole(){t.addRoleForm.menuList=y.addTreeRef.value.getCheckedKeys().filter(d=>d!==void 0),y.addFormRef.value.validate(d=>{if(!d)return;let{role:i,module:n,dangerInspector:R,buyAToB:s,menuList:c}=C(t.addRoleForm);const p={name:i,mark:n,IsHazarousChemicalAdmin:R,CanSeeBuyAToB:s,CanSeeCloneNumber:!0,functions:`[${t.RoleIds.join(",")}]`,MenuList:`[${c.join(",")}]`};x(p).then(h=>{L.success("\u64CD\u4F5C\u6210\u529F"),r()}).finally(()=>{t.dialogAddRole=!1})})},confirmModifyRole(){t.modifyRoleForm.menuList=y.modifyTreeRef.value.getCheckedKeys().filter(d=>d!==void 0),y.modifyFormRef.value.validate(d=>{if(!d)return;let{buyAToB:i,dangerInspector:n,functions:R,id:s,menuList:c,module:p,role:h}=C(t.modifyRoleForm);const b={id:s,name:h,mark:p,functions:`[${t.RoleIds.join(",")}]`,IsHazarousChemicalAdmin:n,CanSeeBuyAToB:i,CanSeeCloneNumber:!0,MenuList:`[${c.join(",")}]`};ee(b).then(()=>{L.success("\u64CD\u4F5C\u6210\u529F"),r()}).finally(()=>{t.dialogModifyRole=!1})})}};return z(()=>{r()}),T(()=>t.dialogAddRole,d=>{d||(t.addRoleForm={role:"",module:"",dangerInspector:!1,buyAToB:!1,menuList:[]},y.addTreeRef.value.setCheckedKeys([]),y.addFormRef.value.resetFields())}),T(()=>t.dialogModifyRole,d=>{d||(t.modifyRoleForm={id:"",role:"",module:"",dangerInspector:!1,buyAToB:!1,menuList:[],functions:[]},y.modifyTreeRef.value.setCheckedKeys([]),y.modifyFormRef.value.resetFields())}),T(()=>t.dialogDeleteRole,d=>{d||(t.deleteRoleData={id:"",role:""})}),E(E(E({state:t},y),f),I)}}),ue=m("\u67E5\u8BE2"),te=m("\u65B0\u589E"),ae={key:1},de=m("\u7F16\u8F91"),se=m("\u5220\u9664"),re=l("div",{class:"title"},"\u65B0\u589E\u89D2\u8272",-1),ie={class:"center-footer"},ne=m("\u53D6\u6D88"),me=m("\u786E\u8BA4"),fe=l("div",{class:"title"},"\u7F16\u8F91\u89D2\u8272",-1),ce={class:"center-footer"},pe=m("\u53D6\u6D88"),Fe=m("\u786E\u8BA4"),Re=l("div",{class:"title"},"\u63D0\u793A",-1),ye={class:"tip-body"},he=l("img",{src:Y,alt:""},null,-1),be=m("\u786E\u8BA4\u8981\u5C06\u540D\u4E3A"),ge={class:"item-name"},Ce=m("\u7684\u89D2\u8272"),De=l("span",{class:"highlight-text"},"\u5220\u9664",-1),Be=m("\u5417?"),Ae={class:"right-footer"},Ee=m("\u53D6\u6D88"),we=m("\u786E\u5B9A");function ke(e,u,r,M,y,I){const t=F("el-input"),f=F("el-button"),d=F("styled-search"),i=F("el-tag"),n=F("el-table-column"),R=F("styled-table"),s=F("el-form-item"),c=F("el-switch"),p=F("el-tooltip"),h=F("el-tree"),b=F("el-form"),v=F("el-dialog");return D(),B(W,null,[l(d,{"hide-search-more":""},{"styled-search-left":o(()=>[l(t,{modelValue:e.state.searchVal,"onUpdate:modelValue":u[1]||(u[1]=a=>e.state.searchVal=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:"",onKeydown:P(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(f,{type:"primary",class:"search",onClick:e.handleSearch},{default:o(()=>[ue]),_:1},8,["onClick"])]),"styled-search-right":o(()=>[l(f,{type:"success",icon:"el-icon-plus",class:"export",onClick:e.addRole},{default:o(()=>[te]),_:1},8,["onClick"])]),_:1}),l(R,{loading:e.state.loading,data:e.state.tableData},{"table-columns":o(()=>[(D(!0),B(W,null,G(e.state.headersConfig,(a,A)=>(D(),B(n,{"show-overflow-tooltip":"",key:A,prop:a.prop,label:a.label,"min-width":e.calcHeaderMinWidth(a,A)},{header:o(g=>[l("span",null,k(g.column.label),1)]),default:o(g=>[a.prop==="status"?(D(),B(i,{key:0,class:g.row.status===0?"withdraw":"normal"},{default:o(()=>[m(k(g.row.status===0?"\u6CE8\u9500":"\u6B63\u5E38"),1)]),_:2},1032,["class"])):(D(),B("span",ae,k(g.row[a.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128)),l(n,{label:"\u64CD\u4F5C",fixed:"right"},{default:o(a=>[l(f,{type:"text",class:"modify",onClick:A=>e.modifyRole(a.row)},{default:o(()=>[de]),_:2},1032,["onClick"]),l(f,{type:"text",class:"delete",onClick:A=>e.deleteRole(a.row)},{default:o(()=>[se]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["loading","data"]),l(v,{width:"516px",modelValue:e.state.dialogAddRole,"onUpdate:modelValue":u[6]||(u[6]=a=>e.state.dialogAddRole=a)},{title:o(()=>[re]),footer:o(()=>[l("div",ie,[l(f,{onClick:e.cancelAddRole,class:"cancel"},{default:o(()=>[ne]),_:1},8,["onClick"]),l(f,{type:"primary",onClick:e.confirmAddRole,class:"confirm"},{default:o(()=>[me]),_:1},8,["onClick"])])]),default:o(()=>[l(b,{model:e.state.addRoleForm,rules:e.addRoleFormRules,ref:"addFormRef"},{default:o(()=>[l(s,{label:"\u89D2\u8272\u540D\u79F0","label-width":e.labelWidth,prop:"role"},{default:o(()=>[l(t,{modelValue:e.state.addRoleForm.role,"onUpdate:modelValue":u[2]||(u[2]=a=>e.state.addRoleForm.role=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(s,{label:"\u6A21\u5757\u6807\u8BC6","label-width":e.labelWidth,prop:"module"},{default:o(()=>[l(t,{modelValue:e.state.addRoleForm.module,"onUpdate:modelValue":u[3]||(u[3]=a=>e.state.addRoleForm.module=a),placeholder:"\u8BF7\u8F93\u5165\u6A21\u5757\u6807\u8BC6",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(s,{class:"switch-item",label:"\u5371\u9669\u54C1\u89C1\u8BC1\u4EBA","label-width":e.labelWidth},{default:o(()=>[l(p,{class:"item",effect:"dark",content:"\u9009\u4E2D\u540E\u8BE5\u89D2\u8272\u7684\u7528\u6237\u53EF\u4EE5\u4F5C\u4E3A\u5371\u9669\u54C1\u89C1\u8BC1\u4EBA",placement:"right-start"},{default:o(()=>[l(c,{modelValue:e.state.addRoleForm.dangerInspector,"onUpdate:modelValue":u[4]||(u[4]=a=>e.state.addRoleForm.dangerInspector=a),"active-color":"#3C92FFFF"},null,8,["modelValue"])]),_:1})]),_:1},8,["label-width"]),l(s,{class:"switch-item",label:"\u4E70A\u6362B\u8BA2\u5355","label-width":e.labelWidth},{default:o(()=>[l(p,{class:"item",effect:"dark",content:"\u9009\u4E2D\u540E\u8BE5\u89D2\u8272\u7684\u7528\u6237\u53EF\u4EE5\u770B\u5230\u4E70A\u6362B\u7684\u8BA2\u5355\u4FE1\u606F",placement:"right-start"},{default:o(()=>[l(c,{modelValue:e.state.addRoleForm.buyAToB,"onUpdate:modelValue":u[5]||(u[5]=a=>e.state.addRoleForm.buyAToB=a),"active-color":"#3C92FFFF"},null,8,["modelValue"])]),_:1})]),_:1},8,["label-width"]),l(s,{label:"\u6743\u9650\u63A7\u5236","label-width":e.labelWidth,prop:"menuList"},{default:o(()=>[l(h,{style:{"margin-top":"8px"},ref:"addTreeRef",data:e.state.treeData.data,props:e.state.treeData.defaultProps,"default-expanded-keys":e.state.treeData.defaultOpenedKeys,"node-key":"id","show-checkbox":""},null,8,["data","props","default-expanded-keys"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(v,{width:"516px",modelValue:e.state.dialogModifyRole,"onUpdate:modelValue":u[11]||(u[11]=a=>e.state.dialogModifyRole=a),"destroy-on-close":""},{title:o(()=>[fe]),footer:o(()=>[l("div",ce,[l(f,{onClick:e.cancelModifyRole,class:"cancel"},{default:o(()=>[pe]),_:1},8,["onClick"]),l(f,{type:"primary",onClick:e.confirmModifyRole,class:"confirm"},{default:o(()=>[Fe]),_:1},8,["onClick"])])]),default:o(()=>[l(b,{model:e.state.modifyRoleForm,rules:e.modifyRoleFormRules,ref:"modifyFormRef"},{default:o(()=>[l(s,{label:"\u89D2\u8272\u540D\u79F0","label-width":e.labelWidth,prop:"role"},{default:o(()=>[l(t,{modelValue:e.state.modifyRoleForm.role,"onUpdate:modelValue":u[7]||(u[7]=a=>e.state.modifyRoleForm.role=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(s,{label:"\u6A21\u5757\u6807\u8BC6","label-width":e.labelWidth,prop:"module"},{default:o(()=>[l(t,{modelValue:e.state.modifyRoleForm.module,"onUpdate:modelValue":u[8]||(u[8]=a=>e.state.modifyRoleForm.module=a),placeholder:"\u8BF7\u8F93\u5165\u6A21\u5757\u6807\u8BC6",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(s,{class:"switch-item",label:"\u5371\u9669\u54C1\u89C1\u8BC1\u4EBA","label-width":e.labelWidth},{default:o(()=>[l(p,{class:"item",effect:"dark",content:"\u9009\u4E2D\u540E\u8BE5\u89D2\u8272\u7684\u7528\u6237\u53EF\u4EE5\u4F5C\u4E3A\u5371\u9669\u54C1\u89C1\u8BC1\u4EBA",placement:"right-start"},{default:o(()=>[l(c,{modelValue:e.state.modifyRoleForm.dangerInspector,"onUpdate:modelValue":u[9]||(u[9]=a=>e.state.modifyRoleForm.dangerInspector=a),"active-color":"#3C92FFFF"},null,8,["modelValue"])]),_:1})]),_:1},8,["label-width"]),l(s,{class:"switch-item",label:"\u4E70A\u6362B\u8BA2\u5355","label-width":e.labelWidth},{default:o(()=>[l(p,{class:"item",effect:"dark",content:"\u9009\u4E2D\u540E\u8BE5\u89D2\u8272\u7684\u7528\u6237\u53EF\u4EE5\u770B\u5230\u4E70A\u6362B\u7684\u8BA2\u5355\u4FE1\u606F",placement:"right-start"},{default:o(()=>[l(c,{modelValue:e.state.modifyRoleForm.buyAToB,"onUpdate:modelValue":u[10]||(u[10]=a=>e.state.modifyRoleForm.buyAToB=a),"active-color":"#3C92FFFF"},null,8,["modelValue"])]),_:1})]),_:1},8,["label-width"]),l(s,{label:"\u6743\u9650\u63A7\u5236","label-width":e.labelWidth,prop:"menuList"},{default:o(()=>[l(h,{style:{"margin-top":"8px"},ref:"modifyTreeRef",data:e.state.treeData.data,props:e.state.treeData.defaultProps,"default-checked-keys":e.state.modifyRoleForm.menuList,"default-expanded-keys":e.state.treeData.defaultOpenedKeys,"node-key":"id","show-checkbox":""},null,8,["data","props","default-checked-keys","default-expanded-keys"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(v,{width:"466px",modelValue:e.state.dialogDeleteRole,"onUpdate:modelValue":u[13]||(u[13]=a=>e.state.dialogDeleteRole=a)},{title:o(()=>[Re]),footer:o(()=>[l("div",Ae,[l(f,{onClick:u[12]||(u[12]=a=>e.state.dialogDeleteRole=!1),class:"cancel"},{default:o(()=>[Ee]),_:1}),l(f,{type:"primary",onClick:e.confirmDeleteRole,class:"confirm"},{default:o(()=>[we]),_:1},8,["onClick"])])]),default:o(()=>[l("div",ye,[he,l("span",null,[be,l("span",ge,k(e.state.deleteRoleData.role),1),Ce,De,Be])])]),_:1},8,["modelValue"])],64)}var Me=J(oe,[["render",ke]]);export{Me as default};
