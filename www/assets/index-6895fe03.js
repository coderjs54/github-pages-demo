var O=Object.defineProperty,B=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var l=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var S=(t,e,s)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,c=(t,e)=>{for(var s in e||(e={}))g.call(e,s)&&S(t,s,e[s]);if(l)for(var s of l(e))I.call(e,s)&&S(t,s,e[s]);return t},m=(t,e)=>B(t,L(e));var _=(t,e)=>{var s={};for(var n in t)g.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&l)for(var n of l(t))e.indexOf(n)<0&&I.call(t,n)&&(s[n]=t[n]);return s};import{m as N}from"./menu-ab209e89.js";import{r as p,U as f,c as U,G as D,a as q,s as A}from"./index.1a2bb961.js";function w(t){return p.post(f.LOGIN.login,t)}function P(t=""){return p.post(f.ROLE.queryRole,{search_word:t})}function R(){return p.post(f.USER.getServerInfo,{})}const{commit:b}=A,T=t=>(t||(t="[]"),t.slice(1,-1).split(",")),C=t=>new Promise((e,s)=>{R().then(n=>{const r=n.IsProduction;b(D,r),localStorage.setItem("Is_Production",String(r))}),P().then(n=>{const r=n.roles,i=Object.fromEntries(r.map(o=>[o.id,o.CanSeeBuyAToB])),u=t.map(o=>i[o]).some(o=>Boolean(o));b(q,u),localStorage.setItem("Buy_A_To_B",String(u));const M=Object.fromEntries(r.map(o=>[o.id,T(o.MenuList)])),h=t.map(o=>M[o]),y=[...new Set(h.flat())];e(y)}).catch(()=>{s([])})}),v=(t,e)=>e.map(s=>{const i=s,{submenus:n}=i,r=_(i,["submenus"]);return m(c({},r),{submenus:n.filter(a=>t?!a.hide_on_prod:a)})}),d=(t,e,s)=>{for(let n=0;n<e.length;n++)e[n].submenus?(t.push(m(c({},e[n]),{submenus:[]})),d(t[n].submenus,e[n].submenus,s)):s.indexOf(e[n].id)>-1&&t.push(c({},e[n]))},E=(t,e)=>{for(let s=0;s<e.length;s++)e[s].submenus?e[s].submenus.length===0||(t.push(m(c({},e[s]),{submenus:[]})),E(t.at(-1).submenus,e[s].submenus)):t.push(c({},e[s]))},F=()=>{const t=localStorage.getItem("Is_Production")==="true",e=v(t,N);if(U.getEncryptItem("admin")==="admin")return e;{const n=JSON.parse(localStorage.getItem("USER_MENU_IDS")),r=[...new Set(n.map(u=>u==null?void 0:u.split("-")[0]))];let i=[],a=[];return d(i,e,n),E(a,i.filter(u=>r.indexOf(u.id)>-1)),a}};export{F as a,C as g,w as r};
