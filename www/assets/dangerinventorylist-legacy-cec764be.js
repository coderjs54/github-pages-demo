System.register(["../vendors/element-plus-legacy-e48d1ae3.js","./index-legacy.acc39ef9.js"],(function(e){"use strict";var a,t,n,r,l,o,i,s,d,p,c,h,g,u,m,b,y,C,S,f,P,D,M,T;return{setters:[function(e){a=e.d,t=e.i,n=e.r,r=e.c,l=e.I,o=e.Y,i=e.w,s=e.o,d=e.E,p=e.m,c=e.q,h=e.y,g=e.G,u=e.N,m=e.F,b=e.A,y=e.z,C=e.C},function(e){S=e.r,f=e.U,P=e._,D=e.d,M=e.b,T=e.u}],execute:function(){const k=a({setup(){const e=D(),a=M(),d=T(),p=t("exportXLSX"),c=t("exportPDF"),h=t("setTableHeaders"),g=()=>{b.loading=!0;const{pageSize:e,currentPage:a}=l(b.pagination),{searchWord:t,dateRange:n,diseaseType:r}=l(b.searchParam),{department:o,materialType:i,brand:s,instrument:d,warehouse:p}=l(b.searchMoreParam),[c,h]=n||["",""];(function(e){return S.post(f.INVENTORY.queryInventory,e)})({InStoreBeginDate:c,InStoreEndDate:h,SearchWord:t,NeedCheckHChemical:!0,isHazardousChemical:!0,DiseaseType:r,DepartmentId:o,MaterialType:i,Brand:s,Instrument:d,GoodsShelf:p,IsBelongToMe:!1,NeedPaging:!0,PageNo:a,RecordPerPage:e,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!1,InStockTaking:!1}).then((e=>{b.pagination.total=e.TotalRecordCount,u(e.StoreInfo)})).finally((()=>{b.loading=!1}))},u=e=>{b.tableData=e.map((e=>{const{material:a,store:t}=e,{id:n,MaterialId:r,Operator1Id:l,amount:o,unit:i,GoodsShelf:s,EndDate:d,CloneNumber:p,DiseaseType:c,LotNumber:h,ChangeReason:g,DeliverOrderId:u,OperateTime:m,DepartmentName:y}=t,{system_code:C,name:S,short_name:f,brand_id:P,material_type:D,spec:M}=a||{};return{id:n,hospital_code:r,system_code:C,name:S,Operator1Id:l,ChangeReason:g,shortname:f,LotNumber:h,brandName:b.brandIdMap[P],department:y,inventory:o,price:"",amount:"",standard:M,unit:i,unitName:b.MinUnitTypeMap.get(i),kind:b.MaterialTypeMap.get(D),validity:d.substring(0,10),position1:s,CloneNumber:p||"无",DiseaseType:c,DeliverOrderId:u,OperateTime:m.replace("T"," ")}}))},m=e=>{e&&(b.pagination.currentPage=1),g()},b=n({loading:!1,searchParam:{searchWord:"",dateRange:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"序号",prop:"id"},{label:"物料院内码",prop:"hospital_code"},{label:"库位",prop:"position1"},{label:"系统码",prop:"system_code"},{label:"物料名称",prop:"name"},{label:"物料规格",prop:"standard"},{label:"物料简称",prop:"shortname"},{label:"物料批号",prop:"LotNumber"},{label:"交货单ID",prop:"DeliverOrderId"},{label:"品牌",prop:"brandName"},{label:"组织名称",prop:"department"},{label:"操作员",prop:"Operator1Id"},{label:"操作时间",prop:"OperateTime"},{label:"库存量",prop:"inventory"},{label:"单位",prop:"unitName"},{label:"库存变动原因",prop:"ChangeReason"},{label:"批次单价",prop:"price"},{label:"物料类型",prop:"kind"},{label:"物料效期",prop:"validity"},{label:"克隆号",prop:"CloneNumber"},{label:"病种类型",prop:"DiseaseType"}],tableData:[],multipleSelection:[],PDFHandling:!1,brandIdMap:r((()=>e.getters.brandIdMap)),MaterialTypeMap:r((()=>e.getters.MaterialTypeMap)),MinUnitTypeMap:r((()=>e.getters.MinUnitTypeMap))}),y=r((()=>b.headersConfig.filter((e=>!e.hidden)))),C={calcHeaderWidth:t("calcHeaderMinWidth"),handleClickSetting(){h(b.headersConfig,(e=>{b.headersConfig=e}))},handlePaginationChange(){m(!1)},handleSearch(){m(!0)},handleSearchMoreParamChange(e){b.searchMoreParam=e,m(!0)},handleChangeMultiple(e){b.multipleSelection=e},handleModify(e){console.log(e)},handleExportXLSX(){p(b.headersConfig,b.tableData,"库存记录","库存记录详情")},handleExportPDF(){b.PDFHandling=!0,c(b.headersConfig,b.tableData,"测试文件").finally((()=>{b.PDFHandling=!1}))},handleGoToOutWarehouse(){const e=l(b.multipleSelection);if(1!==e.length)return o({title:"提示",message:"由于第三方系统的限制，本系统只能一次领用一种危险品，请重新选择。",type:"warning"});e.length&&d.push({name:"dangeroutwarehousing",params:{chosenTableData:JSON.stringify(e)}})}};return i((()=>e.getters.settings),(()=>{b.headersConfig=e.getters.settings[a.name]||b.headersConfig})),s((()=>{g()})),{state:b,...C,changeReasons:{"三级出库":"level-three-out","领用":"request-for-use","用剩归还":"return-back"},headersShown:y}}}),I={class:"date-box"},N=C("查询"),w=C("导出xlsx"),_=C("导出pdf"),v={key:1};e("default",P(k,[["render",function(e,a,t,n,r,l){const o=d("el-date-picker"),i=d("el-input"),s=d("el-button"),S=d("styled-search"),f=d("el-tag"),P=d("el-table-column"),D=d("styled-table"),M=d("styled-pagination");return p(),c(m,null,[h(S,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":g((()=>[h("div",I,[h(o,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),h(i,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":a[2]||(a[2]=a=>e.state.searchParam.searchWord=a),placeholder:"请输入查询关键字",clearable:"",onKeydown:u(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),h(i,{modelValue:e.state.searchParam.diseaseType,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.searchParam.diseaseType=a),placeholder:"请输入物料病种信息",clearable:"",onKeydown:u(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),h(s,{type:"primary",class:"search",onClick:e.handleSearch},{default:g((()=>[N])),_:1},8,["onClick"])])),"styled-search-right":g((()=>[h(s,{type:"success",class:"export",disabled:0===e.state.tableData.length,onClick:e.handleExportXLSX},{default:g((()=>[w])),_:1},8,["disabled","onClick"]),h(s,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:0===e.state.tableData.length,onClick:e.handleExportPDF},{default:g((()=>[_])),_:1},8,["loading","disabled","onClick"])])),_:1},8,["onChooseSearchMoreParam"]),h(D,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":g((()=>[(p(!0),c(m,null,b(e.headersShown,((a,t)=>(p(),c(P,{"show-overflow-tooltip":"",key:t,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,t)},{header:g((e=>[h("span",null,y(e.column.label),1)])),default:g((t=>["ChangeReason"===t.column.property?(p(),c(f,{key:0,class:e.changeReasons[t.row[a.prop]]},{default:g((()=>[C(y(t.row[a.prop]),1)])),_:2},1032,["class"])):(p(),c("span",v,y(t.row[a.prop]),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["loading","data","onClickSetting"]),h(M,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":a[4]||(a[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":a[5]||(a[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}]]))}}}));
