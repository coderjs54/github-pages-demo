var Q=Object.defineProperty;var U=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var N=(e,s,y)=>s in e?Q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:y}):e[s]=y,S=(e,s)=>{for(var y in s||(s={}))J.call(s,y)&&N(e,y,s[y]);if(U)for(var y of U(s))K.call(s,y)&&N(e,y,s[y]);return e};import{d as Z,i as I,r as x,c as L,Y as H,S as z,O as ee,E as _,m as i,q as r,y as l,G as n,C as k,z as f,F as w,A as V,t as te,x as ae}from"../vendors/element-plus-6f9977bb.js";import{_ as le,u as oe,b as ue,d as ne}from"./index.1a2bb961.js";import{_ as se}from"./index-608455a6.js";import{V as ie,r as re,a as de,b as pe,c as ce,d as me,e as he,f as Ce}from"./index-59b3f7ec.js";import{_ as O,a as ye}from"./failed-0ae6e7e8.js";import"./md5-3215d1da.js";const ge=Z({name:"inventorychecking",components:{"validate-acceptor-dialog":ie},setup(){const e=oe(),s=ue(),y=ne(),T=I("setTableHeaders"),A=I("openInventoryCheckPrintDialog"),M=C=>{o.tableData=C.map(d=>{const{store:m,material:h}=d,{id:p,MaterialId:D,Operator1Id:g,amount:v,GoodsShelf:F,EndDate:E,CloneNumber:t,unit:b,DiseaseType:a,LotNumber:u,DepartmentOwner:R,DepartmentName:W}=m,{system_code:q,name:P,short_name:Y,brand_id:$,material_type:G,spec:X}=h||{},j=o.brandIdMap[$];return{id:p,hospital_code:D,system_code:q,name:P,Operator1Id:g,shortname:Y,LotNumber:u,brand:j,department:W,DepartmentId:R,inventory:v,price:"",amount:"",unit:o.MinUnitTypeMap.get(b),size:X,kind:o.MaterialTypeMap.get(G),validity:E.substring(0,10),store_position:F,CloneNumber:t,DiseaseType:a}})},c={FROM_WHERE:"/inventorycheck",checkListHeadersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name",width:120},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u76D8\u70B9\u91CF(\u5165\u5E93\u5355\u4F4D)",prop:"check_inventory_in",width:120},{label:"\u76D8\u70B9\u91CF(\u51FA\u5E93\u5355\u4F4D)",prop:"check_inventory_out",width:120},{label:"\u5907\u6CE8",prop:"remark"},{label:"\u7269\u6599\u6548\u671F",prop:"validity",width:150},{label:"\u5B58\u653E\u5E93\u4F4D",prop:"store_position",width:150},{label:"\u54C1\u724C\u540D\u79F0",prop:"brand"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"}]},o=x({loading:!1,isDanger:!1,secondAcceptorList:[],acceptanceData:{acceptor1:L(()=>y.getters.username)},tableData:[],multipleSelection:[],warehouseOptions:[],headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C\u540D\u79F0",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u64CD\u4F5C\u5458",prop:"Operator1Id"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u7269\u6599\u6548\u671F",prop:"validity"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],dialog:{checkListDialog:!1,checkDangerListDialog:!1},dialogTableData:{checkListTableData:[],checkDangerListTableData:[]},dialogValidateShow:!1,validateSuccess:!1,inventoryCheckId:"",brandIdMap:L(()=>y.getters.brandIdMap),MinUnitTypeMap:L(()=>y.getters.MinUnitTypeMap),MaterialTypeMap:L(()=>y.getters.MaterialTypeMap)}),B={calcHeaderWidth:I("calcHeaderMinWidth"),handleClickSetting(){T(o.headersConfig,C=>{o.headersConfig=C})},handleChangeMultiple(C){o.multipleSelection=C},handleGoBack(){e.push(c.FROM_WHERE)},handleClickDelete(){const C=o.multipleSelection.map(d=>d.id);o.tableData=o.tableData.filter(d=>C.indexOf(d.id)<0)},handleGenerateCheckList(){const C={StoreIdList:`[${o.tableData.map(d=>d.id).join(",")}]`};re(C).then(d=>{if(o.inventoryCheckId=d.StockTakingId,o.isDanger){o.dialog.checkDangerListDialog=!0,o.dialogTableData.checkDangerListTableData=o.tableData.map(h=>{const{id:p,hospital_code:D,name:g,LotNumber:v,unit:F,inventory:E,validity:t,store_position:b,brand:a,CloneNumber:u}=h;return{id:p,hospital_code:D,name:g,LotNumber:v,unit:F,inventory:E,check_inventory_in:E,check_inventory_out:0,remark:"",last_check_inventory:"",validity:t,store_position:b,brand:a,CloneNumber:u}});const m=o.tableData.map(h=>h.DepartmentId);de(m).then(h=>{o.secondAcceptorList=h.inspectors.map(p=>({label:p.UserDisplayName,value:p.UserName})),o.secondAcceptorList.length===0&&(o.tableData.length===1?H({title:"\u63D0\u793A",message:"\u6682\u65F6\u627E\u4E0D\u5230\u53EF\u4EE5\u4F5C\u4E3A\u6B64\u5371\u9669\u54C1\u7684\u7B2C\u4E8C\u89C1\u8BC1\u4EBA\uFF0C\u8BF7\u8054\u7CFB\u90E8\u95E8\u7BA1\u7406\u5458\u8FDB\u884C\u6DFB\u52A0\u3002",type:"warning",duration:0}):H({title:"\u63D0\u793A",message:"\u6682\u65F6\u627E\u4E0D\u5230\u53EF\u4EE5\u540C\u65F6\u4F5C\u4E3A\u8FD9\u4E9B\u5371\u9669\u54C1\u7684\u7B2C\u4E8C\u89C1\u8BC1\u4EBA\uFF0C\u8BF7\u8FD4\u56DE\u91CD\u65B0\u9009\u62E9\u3002",type:"warning",duration:0}))})}else o.dialog.checkListDialog=!0,o.dialogTableData.checkListTableData=o.tableData.map(m=>{const{id:h,hospital_code:p,name:D,LotNumber:g,unit:v,inventory:F,validity:E,store_position:t,brand:b,CloneNumber:a}=m;return{id:h,hospital_code:p,name:D,LotNumber:g,unit:v,inventory:F,check_inventory_in:F,check_inventory_out:0,remark:"",last_check_inventory:"",validity:E,store_position:t,brand:b,CloneNumber:a}})})},handlePrint(){A(o.headersConfig,o.tableData,o.inventoryCheckId,"\u5E93\u5B58\u76D8\u70B9\u5355")},handleExportXLSX(C){const d=C?o.dialogTableData.checkDangerListTableData:o.dialogTableData.checkListTableData,m=c.checkListHeadersConfig;se.exportSingleSheet(m,d,"\u76D8\u70B9\u6E05\u5355\u8BE6\u60C5","\u76D8\u70B9\u6E05\u5355")},handleCompleteInventoryCheck(){const d={ModifyStructs:(o.isDanger?o.dialogTableData.checkDangerListTableData:o.dialogTableData.checkListTableData).map(m=>{const{id:h,LotNumber:p,validity:D,unit:g,store_position:v,check_inventory_in:F}=m;return{StoreId:h,LotNumber:p,EndDate:D,Amount:Number(F),Unit:o.MinUnitTypeMap.get(g),GoodsShelf:v}})};pe(d).then(()=>{z.success("\u64CD\u4F5C\u6210\u529F");const m={StockTakingId:o.inventoryCheckId};return ce(m)}).finally(()=>{o.dialog.checkListDialog=!1,o.dialog.checkDangerListDialog=!1,e.push(c.FROM_WHERE)})},handleAbandonInventoryCheck(){const C={StockTakingId:o.inventoryCheckId};me(C).then(()=>{z.success("\u64CD\u4F5C\u6210\u529F"),o.dialog.checkListDialog=!1,o.dialog.checkDangerListDialog=!1,e.push(c.FROM_WHERE)})},handleValidateSuccess(){o.validateSuccess=!0}};return ee(()=>{const C=s.query.hospital_codes.split(",");if(o.isDanger=s.query.danger==="true",!C.length)return e.push(c.FROM_WHERE);he({SearchWord:"",DepartmentId:""}).then(m=>{o.warehouseOptions=m.goodsShelves.map(h=>{const{name:p}=h;return{value:p,label:p}})}).then(()=>{o.loading=!0,Promise.all(C.map(m=>Ce({InStoreBeginDate:"",InStoreEndDate:"",SearchWord:m,NeedCheckHChemical:!1,isHazardousChemical:!0,DiseaseType:"",GoodsShelf:"",IsBelongToMe:!1,NeedPaging:!1,PageNo:1,RecordPerPage:1,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then(p=>p.StoreInfo))).then(m=>{o.loading=!1;let h=[];for(let p=0;p<m.length;p++){const D=m[p];for(let g=0;g<D.length;g++)h.push(D[g])}M(h)})})}),S(S({state:o},B),c)}}),be=k("\u751F\u6210\u76D8\u70B9\u5355"),ke=k("\u8FD4\u56DE\u9009\u62E9"),De=l("div",{class:"title"},"\u76D8\u70B9\u660E\u7EC6",-1),_e={class:"body"},fe={class:"table-area"},ve={style:{"margin-left":"4px"}},Fe={style:{"margin-left":"4px"}},we={key:6},Ee={class:"right-footer"},Be=k("\u76D8\u70B9\u5B8C\u6210"),Ve=k("\u76D8\u70B9\u4F5C\u5E9F"),Le=k("\u6253\u5370"),Se=k("\u5BFC\u51FAxlsx"),Ie=k("\u9000\u51FA"),Te=l("div",{class:"title"},"\u76D8\u70B9\u660E\u7EC6",-1),Ae={class:"body"},Me=l("img",{class:"verified-img1",src:O,alt:"\u9A8C\u8BC1\u6210\u529F"},null,-1),Ue=k("\u53CC\u4EBA\u53CC\u9501\u9A8C\u8BC1"),Ne={key:0,class:"validate-message success"},He=l("span",null,"\u53CC\u4EBA\u53CC\u9501\u5DF2\u9A8C\u8BC1",-1),ze=l("img",{src:O,alt:"\u9A8C\u8BC1\u6210\u529F"},null,-1),Oe={key:1,class:"validate-message error"},Re=l("span",null,"\u53CC\u4EBA\u53CC\u9501\u672A\u9A8C\u8BC1",-1),We=l("img",{src:ye,alt:"\u9A8C\u8BC1\u5931\u8D25"},null,-1),qe={class:"table-area"},Pe={style:{"margin-left":"4px"}},Ye={style:{"margin-left":"4px"}},$e={key:6},Ge={class:"right-footer"},Xe={style:{color:"#FA5151","font-size":"14px"}},je=k("\u76D8\u70B9\u5B8C\u6210"),Qe=k("\u76D8\u70B9\u4F5C\u5E9F"),Je=k("\u6253\u5370"),Ke=k("\u5BFC\u51FAxlsx"),Ze=k("\u9000\u51FA");function xe(e,s,y,T,A,M){const c=_("el-button"),o=_("styled-search"),B=_("el-table-column"),C=_("styled-table"),d=_("el-input"),m=_("el-date-picker"),h=_("el-option"),p=_("el-select"),D=_("dialog-table"),g=_("el-dialog"),v=_("el-form-item"),F=_("el-form"),E=_("validate-acceptor-dialog");return i(),r(w,null,[l(o,{"hide-search-more":""},{"styled-search-right":n(()=>[l(c,{type:"primary",class:"search",disabled:e.state.tableData.length===0,onClick:e.handleGenerateCheckList},{default:n(()=>[be]),_:1},8,["disabled","onClick"]),l(c,{type:"danger",class:"delete",disabled:e.state.multipleSelection.length===0,onClick:e.handleClickDelete},{default:n(()=>[k("\u5220\u9664\u9009\u62E9("+f(e.state.multipleSelection.length)+")",1)]),_:1},8,["disabled","onClick"]),l(c,{type:"primary",plain:"",onClick:e.handleGoBack},{default:n(()=>[ke]),_:1},8,["onClick"])]),_:1}),l(C,{multiple:"",setting:"",loading:e.state.loading,data:e.state.tableData,onClickSetting:e.handleClickSetting,onChangeMultiple:e.handleChangeMultiple},{"table-columns":n(()=>[(i(!0),r(w,null,V(e.state.headersConfig,(t,b)=>(i(),r(B,{"show-overflow-tooltip":"",key:b,prop:t.prop,label:t.label,"min-width":e.calcHeaderWidth(t,b)},{header:n(a=>[l("span",null,f(a.column.label),1)]),default:n(a=>[l("span",null,f(a.row[t.prop]),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting","onChangeMultiple"]),l(g,{"custom-class":"check-list-dialog",width:"1658px",modelValue:e.state.dialog.checkListDialog,"onUpdate:modelValue":s[3]||(s[3]=t=>e.state.dialog.checkListDialog=t)},{title:n(()=>[De]),footer:n(()=>[l("div",Ee,[l(c,{type:"success",class:"export",onClick:e.handleCompleteInventoryCheck},{default:n(()=>[Be]),_:1},8,["onClick"]),l(c,{type:"danger",class:"delete",onClick:e.handleAbandonInventoryCheck},{default:n(()=>[Ve]),_:1},8,["onClick"]),l(c,{type:"primary",class:"search",onClick:e.handlePrint},{default:n(()=>[Le]),_:1},8,["onClick"]),l(c,{type:"success",class:"export",onClick:s[1]||(s[1]=t=>e.handleExportXLSX(!1))},{default:n(()=>[Se]),_:1}),l(c,{type:"default",class:"exit",onClick:s[2]||(s[2]=t=>e.state.dialog.checkListDialog=!1)},{default:n(()=>[Ie]),_:1})])]),default:n(()=>[l("div",_e,[l("div",fe,[l(D,{data:e.state.dialogTableData.checkListTableData},{"table-columns":n(()=>[(i(!0),r(w,null,V(e.checkListHeadersConfig,(t,b)=>(i(),r(B,{"show-overflow-tooltip":"",key:b,prop:t.prop,label:t.label,"min-width":e.calcHeaderWidth(t,b)},{header:n(a=>[l("span",null,f(a.column.label),1)]),default:n(a=>[a.column.property==="LotNumber"?(i(),r(d,{key:0,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="check_inventory_in"?(i(),r(w,{key:1},[l(d,{size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"]),l("span",ve,f(a.row.unit),1)],64)):a.column.property==="check_inventory_out"?(i(),r(w,{key:2},[l(d,{disabled:"",size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"]),l("span",Fe,f(a.row.unit),1)],64)):a.column.property==="remark"?(i(),r(d,{key:3,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="validity"?(i(),r(m,{key:4,size:"small",style:{width:"100%"},"value-format":"YYYY-MM-DD",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u,type:"date",placeholder:"\u8BF7\u9009\u62E9\u7269\u6599\u6709\u6548\u671F"},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="store_position"?(i(),r(p,{key:5,size:"small",style:{width:"100%"},modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u,filterable:"","allow-create":"","default-first-option":"",placeholder:"\u9009\u62E9\u6216\u8005\u8F93\u5165\u5E93\u4F4D\u540D\u79F0"},{default:n(()=>[(i(!0),r(w,null,V(e.state.warehouseOptions,u=>(i(),r(h,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(i(),r("span",we,f(a.row[t.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"])])])]),_:1},8,["modelValue"]),l(g,{"custom-class":"check-list-dialog",width:"1658px",modelValue:e.state.dialog.checkDangerListDialog,"onUpdate:modelValue":s[8]||(s[8]=t=>e.state.dialog.checkDangerListDialog=t)},{title:n(()=>[Te]),footer:n(()=>[l("div",Ge,[te(l("span",Xe,"\u5371\u5316\u54C1\u7ED3\u675F\u76D8\u70B9\u524D\uFF0C\u8BF7\u5148\u8FDB\u884C\u53CC\u4EBA\u53CC\u9501\u9A8C\u8BC1",512),[[ae,!e.state.validateSuccess]]),l(c,{type:"success",class:"export",disabled:!e.state.validateSuccess,onClick:e.handleCompleteInventoryCheck},{default:n(()=>[je]),_:1},8,["disabled","onClick"]),l(c,{type:"danger",class:"delete",onClick:e.handleAbandonInventoryCheck},{default:n(()=>[Qe]),_:1},8,["onClick"]),l(c,{type:"primary",class:"search",onClick:e.handlePrint},{default:n(()=>[Je]),_:1},8,["onClick"]),l(c,{type:"success",class:"export",onClick:s[6]||(s[6]=t=>e.handleExportXLSX(!0))},{default:n(()=>[Ke]),_:1}),l(c,{type:"default",class:"exit",onClick:s[7]||(s[7]=t=>e.state.dialog.checkDangerListDialog=!1)},{default:n(()=>[Ze]),_:1})])]),default:n(()=>[l("div",Ae,[l(F,{class:"danger-checking",inline:!0,model:e.state.acceptanceData,"label-position":"right"},{default:n(()=>[l(v,{label:"\u76D8\u70B9\u4EBA"},{default:n(()=>[l(d,{disabled:"",modelValue:e.state.acceptanceData.acceptor1,"onUpdate:modelValue":s[4]||(s[4]=t=>e.state.acceptanceData.acceptor1=t),placeholder:"\u8BF7\u8F93\u5165\u76D8\u70B9\u4EBA"},null,8,["modelValue"]),Me]),_:1}),l(v,null,{default:n(()=>[l(c,{type:"primary",onClick:s[5]||(s[5]=t=>e.state.dialogValidateShow=!0)},{default:n(()=>[Ue]),_:1}),e.state.validateSuccess?(i(),r("span",Ne,[He,ze])):(i(),r("span",Oe,[Re,We]))]),_:1})]),_:1},8,["model"]),l("div",qe,[l(D,{data:e.state.dialogTableData.checkDangerListTableData},{"table-columns":n(()=>[(i(!0),r(w,null,V(e.checkListHeadersConfig,(t,b)=>(i(),r(B,{"show-overflow-tooltip":"",key:b,prop:t.prop,label:t.label,"min-width":e.calcHeaderWidth(t,b)},{header:n(a=>[l("span",null,f(a.column.label),1)]),default:n(a=>[a.column.property==="LotNumber"?(i(),r(d,{key:0,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="check_inventory_in"?(i(),r(w,{key:1},[l(d,{size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"]),l("span",Pe,f(a.row.unit),1)],64)):a.column.property==="check_inventory_out"?(i(),r(w,{key:2},[l(d,{disabled:"",size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"]),l("span",Ye,f(a.row.unit),1)],64)):a.column.property==="remark"?(i(),r(d,{key:3,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="validity"?(i(),r(m,{key:4,size:"small",style:{width:"100%"},"value-format":"YYYY-MM-DD",modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u,type:"date",placeholder:"\u8BF7\u9009\u62E9\u7269\u6599\u6709\u6548\u671F"},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="store_position"?(i(),r(p,{key:5,size:"small",style:{width:"100%"},modelValue:a.row[t.prop],"onUpdate:modelValue":u=>a.row[t.prop]=u,filterable:"","allow-create":"","default-first-option":"",placeholder:"\u9009\u62E9\u6216\u8005\u8F93\u5165\u5E93\u4F4D\u540D\u79F0"},{default:n(()=>[(i(!0),r(w,null,V(e.state.warehouseOptions,u=>(i(),r(h,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(i(),r("span",$e,f(a.row[t.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"])])])]),_:1},8,["modelValue"]),l(E,{purpose:"FinishStockTaking",param:"StockTakingId","dialog-show":e.state.dialogValidateShow,"onUpdate:dialog-show":s[9]||(s[9]=t=>e.state.dialogValidateShow=t),acceptors:e.state.secondAcceptorList,ids:e.state.inventoryCheckId,onValidateSuccess:e.handleValidateSuccess},null,8,["dialog-show","acceptors","ids","onValidateSuccess"])],64)}var st=le(ge,[["render",xe]]);export{st as default};
