!function(){var e=document.createElement("style");e.innerHTML=".warning[data-v-388ba484]{font-size:14px;color:#fa5151;margin-bottom:20px;margin-right:20px}\n",document.head.appendChild(e),System.register(["../vendors/element-plus-legacy-e48d1ae3.js","./index-legacy.acc39ef9.js"],(function(e){"use strict";var a,t,n,r,o,l,i,s,d,p,c,h,g,u,m,C,y,b,S,P,k,M,T,I,f,D,v,N;return{setters:[function(e){a=e.d,t=e.i,n=e.r,r=e.c,o=e.I,l=e.S,i=e.w,s=e.o,d=e.j,p=e.k,c=e.E,h=e.m,g=e.q,u=e.y,m=e.N,C=e.t,y=e.x,b=e.z,S=e.C,P=e.F,k=e.A,M=e.B},function(e){T=e.r,I=e.U,f=e._,D=e.d,v=e.u,N=e.b}],execute:function(){function _(e){return T.post(I.INVENTORY.queryInventory,e)}const w=a({setup(){const e=D(),a=v(),d=N(),p=t("setTableHeaders"),c=()=>{u.loading=!0;const{pageSize:e,currentPage:a}=o(u.pagination),{searchWord:t,dateRange:n,diseaseType:r,isDanger:l}=o(u.searchParam),{department:i,materialType:s,brand:d,instrument:p,warehouse:c}=o(u.searchMoreParam),[m,C]=n||["",""];_({InStoreBeginDate:m,InStoreEndDate:C,SearchWord:t,NeedCheckHChemical:!0,isHazardousChemical:l,DiseaseType:r,DepartmentId:i,MaterialType:s,Brand:d,Instrument:p,GoodsShelf:c,IsBelongToMe:!1,NeedPaging:!0,PageNo:a,RecordPerPage:e,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then((e=>{u.pagination.total=e.TotalRecordCount,g(e.StoreInfo),h()})).finally((()=>{u.loading=!1}))},h=()=>{(function(e){return T.post(I.INVENTORY.getInventoryCheckRecords,e)})({BeginDate:"",EndDate:"",SearchWord:"",StockTakingId:"",DepartmentId:"0",Status:"盘点中",IsHChemical:u.searchParam.isDanger?"1":"0",MaterialType:"",Brand:"",Instrument:"",GoodsShelf:"",NeedPaging:!1,PageNo:"",RecordPerPage:""}).then((e=>{u.unFinishedCheckAmount=e.stRecords.length}))},g=e=>{u.tableData=e.map((e=>{const{material:a,store:t}=e,{id:n,MaterialId:r,Operator1Id:o,amount:l,GoodsShelf:i,EndDate:s,CloneNumber:d,unit:p,DiseaseType:c,LotNumber:h,DepartmentName:g}=t,{system_code:m,name:C,short_name:y,brand_id:b,material_type:S,spec:P}=a||{};return{id:n,hospital_code:r,system_code:m,name:C,Operator1Id:o,position1:i,shortname:y,LotNumber:h,brand:u.brandIdMap[b],department:g,inventory:l,price:"",amount:"",unit:u.MinUnitTypeMap.get(p),size:P,kind:u.MaterialTypeMap.get(S),validity:s.substring(0,10),CloneNumber:d,DiseaseType:c}}))},u=n({loading:!1,MinUnitTypeMap:r((()=>e.getters.MinUnitTypeMap)),searchParam:{searchWord:"",dateRange:"",diseaseType:"",isDanger:!1},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},unFinishedCheckAmount:0,pagination:{currentPage:1,total:0,pageSize:300},headersConfig:[{label:"序号",prop:"id"},{label:"院内码",prop:"hospital_code"},{label:"库位",prop:"position1"},{label:"系统码",prop:"system_code"},{label:"物料名称",prop:"name"},{label:"物料简称",prop:"shortname"},{label:"物料批号",prop:"LotNumber"},{label:"品牌名称",prop:"brand"},{label:"组织名称",prop:"department"},{label:"库存量",prop:"inventory"},{label:"单位",prop:"unit"},{label:"物料规格",prop:"size"},{label:"物料类型",prop:"kind"},{label:"物料效期",prop:"validity"},{label:"克隆号",prop:"CloneNumber"},{label:"病种类型",prop:"DiseaseType"}],tableData:[],multipleSelection:[],hospitalCodeMap:new Map,brandIdMap:r((()=>e.getters.brandIdMap)),MaterialTypeMap:r((()=>e.getters.MaterialTypeMap)),chosenHospitalCodes:[]}),m=e=>{e&&(u.pagination.currentPage=1),c()},C=r((()=>u.headersConfig.filter((e=>!e.hidden)))),y={calcHeaderWidth:t("calcHeaderMinWidth"),handleClickSetting(){p(u.headersConfig,(e=>{u.headersConfig=e}))},handlePaginationChange(){m(!1)},handleSearch(){m(!0)},handleSearchMoreParamChange(e){u.searchMoreParam=e,m(!0)},handleChangeMultiple(e){u.multipleSelection=e},handleAddToCheckList(){const e=o(u.multipleSelection).map((e=>e.hospital_code));e.push(...u.chosenHospitalCodes),u.chosenHospitalCodes=[...new Set(e)]},handleGoToCheckInventory(){o(u.multipleSelection).length&&a.push(`/inventorychecking?danger=${u.searchParam.isDanger}&hospital_codes=${u.chosenHospitalCodes.join(",")}`)},handleGoToCheckAllInventory(){(()=>{const{pageSize:e,currentPage:a}=o(u.pagination),{searchWord:t,dateRange:n,diseaseType:r,isDanger:l}=o(u.searchParam),{department:i,materialType:s,brand:d,instrument:p,warehouse:c}=o(u.searchMoreParam),[h,g]=n||["",""];return _({InStoreBeginDate:h,InStoreEndDate:g,SearchWord:t,NeedCheckHChemical:!0,isHazardousChemical:l,DiseaseType:r,DepartmentId:i,MaterialType:s,Brand:d,Instrument:p,GoodsShelf:c,IsBelongToMe:!1,NeedPaging:!1,PageNo:a,RecordPerPage:e,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then((e=>e.StoreInfo))})().then((e=>{const t=[...new Set(e.map((e=>{var a;return null===(a=e.material)||void 0===a?void 0:a.hospital_code})).filter(Boolean))];if(!t.length)return l.error("目前没有可供盘库的库存");a.push(`/inventorychecking?danger=${u.searchParam.isDanger}&hospital_codes=${t.join(",")}`)}))},handleToggleIsDanger(){u.chosenHospitalCodes=[],y.handleSearch()}};return i((()=>e.getters.settings),(()=>{u.headersConfig=e.getters.settings[d.name]||u.headersConfig})),s((()=>{c()})),{state:u,...y,headersShown:C}}}),H=M();d("data-v-388ba484");const z={class:"date-box"},R=S("查询"),B=S("加入盘点清单");p();e("default",f(w,[["render",H(((e,a,t,n,r,o)=>{const l=c("el-date-picker"),i=c("el-input"),s=c("el-button"),d=c("el-switch"),p=c("styled-search"),M=c("el-table-column"),T=c("styled-table"),I=c("styled-pagination");return h(),g(P,null,[u(p,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":H((()=>[u("div",z,[u(l,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),u(i,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":a[2]||(a[2]=a=>e.state.searchParam.searchWord=a),placeholder:"请输入查询关键字",clearable:"",onKeydown:m(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),u(s,{type:"primary",class:"search",onClick:e.handleSearch},{default:H((()=>[R])),_:1},8,["onClick"]),u(d,{modelValue:e.state.searchParam.isDanger,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.searchParam.isDanger=a),"active-text":"危险品","inactive-text":"非危险品",onChange:e.handleToggleIsDanger},null,8,["modelValue","onChange"])])),"styled-search-right":H((()=>[C(u("span",{class:"warning"},"当前存在 "+b(e.state.unFinishedCheckAmount)+" 条未完成的盘点，请到盘点记录中完成",513),[[y,e.state.unFinishedCheckAmount]]),u(s,{type:"success",class:"export",disabled:0===e.state.multipleSelection.length,onClick:e.handleAddToCheckList},{default:H((()=>[B])),_:1},8,["disabled","onClick"]),u(s,{type:"success",class:"export",disabled:0===e.state.chosenHospitalCodes.length,onClick:e.handleGoToCheckInventory},{default:H((()=>[S("去盘点("+b(e.state.chosenHospitalCodes.length)+")",1)])),_:1},8,["disabled","onClick"])])),_:1},8,["onChooseSearchMoreParam"]),u(T,{loading:e.state.loading,multiple:"",setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting,onChangeMultiple:e.handleChangeMultiple},{"table-columns":H((()=>[(h(!0),g(P,null,k(e.headersShown,((a,t)=>(h(),g(M,{"show-overflow-tooltip":"",key:t,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,t)},{header:H((e=>[u("span",null,b(e.column.label),1)])),default:H((e=>[u("span",null,b(e.row[a.prop]),1)])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["loading","data","onClickSetting","onChangeMultiple"]),u(I,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":a[4]||(a[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":a[5]||(a[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}))],["__scopeId","data-v-388ba484"]]))}}}))}();
