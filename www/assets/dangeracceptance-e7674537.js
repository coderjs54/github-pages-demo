var ie=Object.defineProperty,ue=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var R=(e,t,o)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,M=(e,t)=>{for(var o in t||(t={}))de.call(t,o)&&R(e,o,t[o]);if(B)for(var o of B(t))ce.call(t,o)&&R(e,o,t[o]);return e},U=(e,t)=>ue(e,le(t));import{d as me,a as ge,i as k,r as he,c as s,I as _,w as Ce,o as be,E as d,m as f,q as D,y as p,G as i,N as ye,C as q,z as F,F as I,A as Me}from"../vendors/element-plus-6f9977bb.js";import{r as S,U as T,_ as _e,u as fe,d as De,b as Fe}from"./index.1a2bb961.js";import{d as Se}from"./department-c80e70e8.js";import{i as Te}from"./instrument-9ec20200.js";function Ee(e){return S.post(T.MATERIAL.queryMaterial,e)}function Pe(e=""){return S.post(T.VENDOR.queryVendor,{search_word:e})}function we(){return S.get(T.DEPARTMENT.queryDepartment)}const Be=me({name:"dangeracceptance",setup(){const e=fe(),t=De(),o=Fe(),E={scanCodeRef:ge(null)},P=k("setTableHeaders"),g=()=>{a.loading=!0;const{pageSize:r,currentPage:n}=_(a.pagination),{searchWord:u}=_(a.searchParam);Ee({searchWord:u,DepartmentId:"",MaterialType:"",BrandId:"",InstrumentId:"",NeedPaging:!0,PageNo:n,RecordPerPage:r,CheckHChemical:!0,IsHChemical:!0}).then(m=>{a.pagination.total=m.TotalRecordCount,h(m.materials)}).finally(()=>{a.loading=!1})},h=r=>{a.tableData=r.map(n=>{const{brand_id:u,departmentOwners:l,hospital_code:m,id:v,instrumentOwners:A,invoiceCorp:z,isGift:H,isMinUnitPurchase:O,isPublicReagent:L,material_type:N,minimumUnit:V,name:W,needPurchase:$,onBoardInfo:j,onBoardType:G,openValidDays:K,printOpenLabel:J,purchasePrice:Q,purchaseUnit:X,shippingCorp:Y,short_name:Z,spec:x,stopUseReason:ee,storeCondition:ae,storePos:w,supplier:te,system_code:ne,tempratureScope:re,uniqueCodeManage:oe}=n,pe=Se(l).map(y=>a.departmentMaps[y]).join(","),se=Te(A).map(y=>a.instrumentMaps[y]).join(",");return{serverObj:n,short_name:Z,storePos:w,id:v,hospital_code:m,material_name:W,brand:a.brandMaps[u]||"\u672A\u77E5\u54C1\u724C",system_code:ne,type:a.MaterialTypeMap.get(N),size:x,restore_condition:a.StoreTypeMap.get(ae),temperature:re,arrived_scope:a.OnboardTypeMap.get(G),arrived_date:j,purchase_price:Q,print_label:J?"\u662F":"\u5426",department:pe,instrument:se,open_expire:`${K} \u5929`,purchase_unit:a.MinUnitTypeMap.get(X),min_unit:a.MinUnitTypeMap.get(V),unique_code:oe?"\u662F":"\u5426",is_gift:H?"\u662F":"\u5426",store_position:w,purchase_status:$?"\u91C7\u8D2D":"\u505C\u8D2D",stop_reason:ee,public:L?"\u662F":"\u5426",min_unit_purchase:O?"\u662F":"\u5426",supplier:a.companyMaps[te],invoice_company:a.companyMaps[z],ship_company:a.companyMaps[Y]}})},a=he({loading:!1,searchParam:{searchWord:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"short_name"},{label:"\u54C1\u724C",prop:"brand"},{label:"\u89C4\u683C",prop:"size"},{label:"\u50A8\u5B58\u6761\u4EF6",prop:"restore_condition"},{label:"\u6E29\u5EA6\u8303\u56F4",prop:"temperature"},{label:"\u5230\u8D27\u65E5\u671F",prop:"arrived_date"},{label:"\u91C7\u8D2D\u5355\u4EF7",prop:"purchase_price"},{label:"\u6240\u5C5E\u90E8\u95E8",prop:"department"},{label:"\u6240\u5C5E\u4EEA\u5668",prop:"instrument"},{label:"\u5F00\u5C01\u6548\u671F",prop:"open_expire"},{label:"\u5E93\u4F4D",prop:"store_position"},{label:"\u91C7\u8D2D\u5355\u4F4D",prop:"purchase_unit"},{label:"\u6700\u5C0F\u5355\u4F4D",prop:"min_unit"},{label:"\u6700\u5C0F\u5355\u4F4D\u91C7\u8D2D",prop:"min_unit_purchase"},{label:"\u4F9B\u5E94\u5546",prop:"supplier"},{label:"\u5F00\u7968\u516C\u53F8",prop:"invoice_company"},{label:"\u53D1\u8D27\u516C\u53F8",prop:"ship_company"}],tableData:[],multipleSelection:[],brandMaps:s(()=>t.getters.brandIdMap),instrumentMaps:s(()=>t.getters.instrumentIdMap),companyMaps:{},departmentMaps:{},MaterialTypeMap:s(()=>t.getters.MaterialTypeMap),StoreTypeMap:s(()=>t.getters.StoreTypeMap),MinUnitTypeMap:s(()=>t.getters.MinUnitTypeMap),OnboardTypeMap:s(()=>t.getters.OnboardTypeMap)}),c=r=>{r&&(a.pagination.currentPage=1),g()},C=s(()=>a.headersConfig.filter(r=>!r.hidden)),b={calcHeaderWidth:k("calcHeaderMinWidth"),handleClickSetting(){P(a.headersConfig,r=>{a.headersConfig=r})},handlePaginationChange(){c(!1)},handleSearch(){c(!0)},handleChangeMultiple(r){a.multipleSelection=r},handleGoToAccept(){const r=_(a.multipleSelection);!r.length||e.push({name:"dangeraccepting",params:{chosenTableData:JSON.stringify(r)}})}};return Ce(()=>t.getters.settings,()=>{a.headersConfig=t.getters.settings[o.name]||a.headersConfig}),be(()=>{Promise.all([Pe().then(r=>{r.companies.forEach(n=>{a.companyMaps[n.id]=n.name})}),we().then(r=>{r.departments.forEach(n=>{a.departmentMaps[n.id]=n.name})})]).then(g)}),U(M(M({state:a},E),b),{headersShown:C})}}),Re=q("\u67E5\u8BE2");function Ue(e,t,o,E,P,g){const h=d("el-input"),a=d("el-button"),c=d("styled-search"),C=d("el-table-column"),b=d("styled-table"),r=d("styled-pagination");return f(),D(I,null,[p(c,{"hide-search-more":""},{"styled-search-left":i(()=>[p(h,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[1]||(t[1]=n=>e.state.searchParam.searchWord=n),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u540D\u79F0\u3001\u7B80\u79F0\u3001\u6216\u9662\u5185\u7801",clearable:"",onKeydown:ye(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),p(a,{type:"primary",class:"search",onClick:e.handleSearch},{default:i(()=>[Re]),_:1},8,["onClick"])]),"styled-search-right":i(()=>[p(a,{type:"primary",disabled:e.state.multipleSelection.length===0,class:"search",onClick:e.handleGoToAccept},{default:i(()=>[q("\u53BB\u9A8C\u6536("+F(e.state.multipleSelection.length)+")",1)]),_:1},8,["disabled","onClick"])]),_:1}),p(b,{loading:e.state.loading,multiple:"",setting:"",data:e.state.tableData,onChangeMultiple:e.handleChangeMultiple,onClickSetting:e.handleClickSetting},{"table-columns":i(()=>[(f(!0),D(I,null,Me(e.headersShown,(n,u)=>(f(),D(C,{"show-overflow-tooltip":"",key:u,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,u)},{header:i(l=>[p("span",null,F(l.column.label),1)]),default:i(l=>[p("span",null,F(l.row[n.prop]),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onChangeMultiple","onClickSetting"]),p(r,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[2]||(t[2]=n=>e.state.pagination.currentPage=n),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[3]||(t[3]=n=>e.state.pagination.pageSize=n),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var ze=_e(Be,[["render",Ue]]);export{ze as default};
