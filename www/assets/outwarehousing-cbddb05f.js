var U=Object.defineProperty,W=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var M=(e,t,a)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t)=>{for(var a in t||(t={}))R.call(t,a)&&M(e,a,t[a]);if(B)for(var a of B(t))v.call(t,a)&&M(e,a,t[a]);return e},O=(e,t)=>W(e,A(t));import{r as S,U as H,_ as T,u as V,b as N,d as $}from"./index.1a2bb961.js";import{d as q,r as G,c as L,i as z,S as k,w as I,O as j,E as p,m as _,q as h,y as u,G as l,F as g,A as J,z as F,C as c}from"../vendors/element-plus-6f9977bb.js";import{_ as P}from"./tip-1b2ff95a.js";function K(e){return S.post(H.OUTWAREHOUSE.batchOutWarehouse,e)}const Q=q({setup(){const e=V(),t=N(),a=$(),b={FROM_WHERE:"/outwarehouse"},o=G({searchParam:{invoiceTogether:!0},totalMoney:0,tableData:[],headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C\u540D\u79F0",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u9886\u7528\u6570\u91CF",prop:"use_number"},{label:"\u6279\u6B21\u5355\u4EF7",prop:"price"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u7269\u6599\u6548\u671F",prop:"validity"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],acceptDialog:!1,accepting:!1,MinUnitTypeMap:L(()=>a.getters.MinUnitTypeMap)}),E={calcHeaderWidth:z("calcHeaderMinWidth"),handleOutWarehouse(){o.acceptDialog=!0},handleGoBack(){e.go(-1)},confirmOutWarehouse(){if(o.tableData.some(r=>Number(r.use_number)===0))return k.error("\u4E0D\u5141\u8BB8\u5C06\u51FA\u5E93\u91CF\u8BBE\u7F6E\u4E3A0\uFF0C\u8BF7\u60A8\u8BBE\u7F6E\u6B63\u786E\u7684\u51FA\u5E93\u91CF\uFF01");const s={UseHChemicals:o.tableData.map(r=>{const{id:d,use_unit:m,use_number:C}=r;return{StoreId:d,amount:Number(C),unit:o.MinUnitTypeMap.get(m)}})};o.accepting=!0,K(s).then(r=>{k.success("\u64CD\u4F5C\u6210\u529F"),e.push(b.FROM_WHERE)}).finally(()=>{o.accepting=!1,o.acceptDialog=!1})}};return I(()=>a.getters.settings,()=>{o.headersConfig=a.getters.settings[t.name]||o.headersConfig}),j(()=>{let s=t.params.chosenTableData;if(!s||(s=JSON.parse(s),!s.length))return e.push(b.FROM_WHERE);o.tableData=s.map(r=>{const{material:d}=r,{inOutStoreUnits:m,unitMultiples:C}=d,n=m.slice(1,-1).split(",").at(-1);return O(f({},r),{use_number:0,use_unit:o.MinUnitTypeMap.get(n)})})}),f({state:o},E)}}),X=c("\u786E\u5B9A\u9886\u7528"),Y=c("\u8FD4\u56DE\u9009\u62E9"),Z={style:{"margin-left":"8px"}},x={key:1},ee=u("div",{class:"title"},"\u63D0\u793A",-1),te={class:"tip-body"},ue=u("img",{src:P,alt:""},null,-1),ae=c("\u786E\u8BA4\u8981\u5BF9\u9009\u4E2D\u7684"),oe={class:"item-name"},se=c("\u4E2A\u7269\u6599\u8FDB\u884C\u9886\u7528\u5417?"),ne={class:"right-footer"},le=c("\u53D6\u6D88"),re=c("\u786E\u5B9A");function ie(e,t,a,b,o,E){const s=p("el-button"),r=p("styled-search"),d=p("el-input"),m=p("el-table-column"),C=p("styled-table"),y=p("el-dialog");return _(),h(g,null,[u(r,{"hide-search-more":""},{"styled-search-right":l(()=>[u(s,{type:"primary",class:"search",onClick:e.handleOutWarehouse},{default:l(()=>[X]),_:1},8,["onClick"]),u(s,{type:"primary",plain:"",onClick:e.handleGoBack},{default:l(()=>[Y]),_:1},8,["onClick"])]),_:1}),u(C,{setting:"",data:e.state.tableData},{"table-columns":l(()=>[(_(!0),h(g,null,J(e.state.headersConfig,(n,D)=>(_(),h(m,{"show-overflow-tooltip":"",key:D,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,D)},{header:l(i=>[u("span",null,F(i.column.label),1)]),default:l(i=>[i.column.property==="use_number"?(_(),h(g,{key:0},[u(d,{style:{width:"calc(100% - 25px)"},type:"text",modelValue:i.row[n.prop],"onUpdate:modelValue":w=>i.row[n.prop]=w},null,8,["modelValue","onUpdate:modelValue"]),u("span",Z,F(i.row.use_unit),1)],64)):(_(),h("span",x,F(i.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"]),u(y,{width:"466px",modelValue:e.state.acceptDialog,"onUpdate:modelValue":t[2]||(t[2]=n=>e.state.acceptDialog=n)},{title:l(()=>[ee]),footer:l(()=>[u("div",ne,[u(s,{onClick:t[1]||(t[1]=n=>e.state.acceptDialog=!1),class:"cancel"},{default:l(()=>[le]),_:1}),u(s,{type:"primary",loading:e.state.accepting,onClick:e.confirmOutWarehouse,class:"confirm"},{default:l(()=>[re]),_:1},8,["loading","onClick"])])]),default:l(()=>[u("div",te,[ue,u("span",null,[ae,u("span",oe,F(e.state.tableData.length),1),se])])]),_:1},8,["modelValue"])],64)}var _e=T(Q,[["render",ie]]);export{_e as default};
