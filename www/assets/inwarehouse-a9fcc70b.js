var Z=Object.defineProperty,x=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var W=(e,t,r)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))ae.call(t,r)&&W(e,r,t[r]);if(U)for(var r of U(t))te.call(t,r)&&W(e,r,t[r]);return e},V=(e,t)=>x(e,ee(t));import{d as ne,i as y,r as oe,c as F,I as D,w as re,o as le,E as i,m as h,q as g,y as s,G as u,N as se,F as X,A as ue,z as f,C as m}from"../vendors/element-plus-6f9977bb.js";import{r as ie,U as pe,_ as de,d as ce,u as he,b as ge}from"./index.1a2bb961.js";function me(e){return ie.post(pe.INWAREHOUSE.queryReturnable,e)}const be=ne({setup(){const e=ce(),t=he(),r=ge(),N=y("exportXLSX"),z=y("exportPDF"),H=y("setTableHeaders"),b=()=>{a.loading=!0;const{pageSize:o,currentPage:n}=D(a.pagination),{dateRange:c,searchWord:l}=D(a.searchParam),{department:M,materialType:P,brand:k,instrument:B,warehouse:w}=D(a.searchMoreParam),[T,R]=c||["",""];me({BeginDate:T,EndDate:R,SearchWord:l,DepartmentId:M,MaterialType:P,Brand:k,Instrument:B,GoodsShelf:w,isHazardousChemical:0,NeedPaging:!0,PageNum:n,RecordPerPage:o}).then(C=>{a.pagination.total=C.TotalRecordCount,S(C.Stores)}).finally(()=>{a.loading=!1})},S=o=>{a.tableData=o.map(n=>{const{material:c,store:l}=n,{id:M,MaterialId:P,Operator1Id:k,amount:B,GoodsShelf:w,EndDate:T,CloneNumber:R,LotNumber:I,DiseaseType:C,DepartmentName:q,ChangeReason:A,OperateTime:O,unit:L}=l,{system_code:Y,name:$,short_name:G,brand_id:K,material_type:j,spec:J}=c||{},Q=a.brandIdMap[K];return{id:M,inventory_check_status:n.InStockStaking?"\u76D8\u5E93\u4E2D":"\u53EF\u5F52\u8FD8",hospital_code:P,system_code:Y,name:$,Operator1Id:k,ChangeReason:A,shortname:G,LotNumber:I,brand:Q,department:q,use_amount:B,use_unit:a.MinUnitTypeMap.get(L),price:"",amount:"",size:J,kind:a.MaterialTypeMap.get(j),validity:T.substring(0,10),position1:w,CloneNumber:R,DiseaseType:C,OperateTime:O.replace("T"," "),unit:L}})},p={changeReasons:{\u4E09\u7EA7\u51FA\u5E93:"level-three-out",\u9886\u7528:"request-for-use",\u7528\u5269\u5F52\u8FD8:"return-back"},inventoryCheckStatus:{\u53EF\u5F52\u8FD8:"default",\u76D8\u5E93\u4E2D:"danger"}},a=oe({loading:!1,searchParam:{dateRange:"",searchWord:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u76D8\u70B9\u72B6\u6001",prop:"inventory_check_status"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u64CD\u4F5C\u65F6\u95F4",prop:"OperateTime"},{label:"\u9886\u7528\u91CF",prop:"use_amount"},{label:"\u9886\u7528\u5355\u4F4D",prop:"use_unit"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:160},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],multipleSelection:[],PDFHandling:!1,brandIdMap:F(()=>e.getters.brandIdMap),MaterialTypeMap:F(()=>e.getters.MaterialTypeMap),MinUnitTypeMap:F(()=>e.getters.MinUnitTypeMap)}),d=o=>{o&&(a.pagination.currentPage=1),b()},_=F(()=>a.headersConfig.filter(o=>!o.hidden)),E={calcHeaderWidth:y("calcHeaderMinWidth"),handleClickSetting(){H(a.headersConfig,o=>{a.headersConfig=o})},handlePaginationChange(){d(!1)},handleSearch(){d(!0)},handleSearchMoreParamChange(o){a.searchMoreParam=o,d(!0)},handleChangeMultiple(o){a.multipleSelection=o},handleExportXLSX(){N(a.headersConfig,a.tableData,"\u5E93\u5B58\u8BB0\u5F55","\u5E93\u5B58\u8BB0\u5F55\u8BE6\u60C5")},handleExportPDF(){a.PDFHandling=!0,z(a.headersConfig,a.tableData,"\u5E93\u5B58\u8BB0\u5F55").finally(()=>{a.PDFHandling=!1})},handleReturnMaterial(){const o=D(a.multipleSelection);!o.length||t.push({name:"inwarehousing",params:{chosenTableData:JSON.stringify(o)}})}};return re(()=>e.getters.settings,()=>{a.headersConfig=e.getters.settings[r.name]||a.headersConfig}),le(()=>{b()}),V(v(v({state:a},E),p),{headersShown:_})}}),Ce={class:"date-box"},ye=m("\u67E5\u8BE2"),Fe=m("\u5F52\u8FD8\u7269\u6599"),De=m("\u5BFC\u51FAxlsx"),fe=m("\u5BFC\u51FApdf "),Se={key:2};function _e(e,t,r,N,z,H){const b=i("el-date-picker"),S=i("el-input"),p=i("el-button"),a=i("styled-search"),d=i("el-tag"),_=i("el-table-column"),E=i("styled-table"),o=i("styled-pagination");return h(),g(X,null,[s(a,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":u(()=>[s("div",Ce,[s(b,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=n=>e.state.searchParam.dateRange=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),s(S,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[2]||(t[2]=n=>e.state.searchParam.searchWord=n),placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57",clearable:"",onKeydown:se(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),s(p,{type:"primary",class:"search",onClick:e.handleSearch},{default:u(()=>[ye]),_:1},8,["onClick"])]),"styled-search-right":u(()=>[s(p,{type:"success",class:"export",disabled:e.state.multipleSelection.length===0,onClick:e.handleReturnMaterial},{default:u(()=>[Fe]),_:1},8,["disabled","onClick"]),s(p,{type:"success",class:"export",disabled:e.state.tableData.length===0,onClick:e.handleExportXLSX},{default:u(()=>[De]),_:1},8,["disabled","onClick"]),s(p,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:e.state.tableData.length===0,onClick:e.handleExportPDF},{default:u(()=>[fe]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),s(E,{loading:e.state.loading,multiple:"",setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting,onChangeMultiple:e.handleChangeMultiple},{"table-columns":u(()=>[(h(!0),g(X,null,ue(e.headersShown,(n,c)=>(h(),g(_,{"show-overflow-tooltip":"",key:c,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,c)},{header:u(l=>[s("span",null,f(l.column.label),1)]),default:u(l=>[l.column.property==="ChangeReason"?(h(),g(d,{key:0,class:e.changeReasons[l.row[n.prop]]},{default:u(()=>[m(f(l.row[n.prop]),1)]),_:2},1032,["class"])):l.column.property==="inventory_check_status"?(h(),g(d,{key:1,type:e.inventoryCheckStatus[l.row[n.prop]]},{default:u(()=>[m(f(l.row[n.prop]),1)]),_:2},1032,["type"])):(h(),g("span",Se,f(l.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting","onChangeMultiple"]),s(o,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[3]||(t[3]=n=>e.state.pagination.currentPage=n),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[4]||(t[4]=n=>e.state.pagination.pageSize=n),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var ke=de(be,[["render",_e]]);export{ke as default};
