var J=Object.defineProperty,Z=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var L=(e,a,o)=>a in e?J(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,I=(e,a)=>{for(var o in a||(a={}))ee.call(a,o)&&L(e,o,a[o]);if(H)for(var o of H(a))ae.call(a,o)&&L(e,o,a[o]);return e},U=(e,a)=>Z(e,x(a));import{d as te,i as y,r as ne,c as F,w as oe,o as re,E as i,m as g,q as h,y as l,G as u,N as A,F as W,A as le,z as N,C as f,I as v}from"../vendors/element-plus-6f9977bb.js";import{r as se,U as ue,_ as ie,b as de,d as pe}from"./index.1a2bb961.js";function ce(e){return se.post(ue.INVENTORY.queryInventory,e)}const ge=te({setup(){const e=de(),a=pe(),o=y("exportXLSX"),R=y("exportPDF"),V=y("setTableHeaders"),D=()=>{t.loading=!0;const{pageSize:r,currentPage:c}=v(t.pagination),{searchWord:n,dateRange:d,diseaseType:s}=v(t.searchParam),{department:E,materialType:M,brand:T,instrument:k,warehouse:_}=v(t.searchMoreParam),[b,w]=d||["",""];ce({InStoreBeginDate:b,InStoreEndDate:w,SearchWord:n,NeedCheckHChemical:!0,isHazardousChemical:!1,DiseaseType:s,DepartmentId:E,MaterialType:M,Brand:T,Instrument:k,GoodsShelf:_,IsBelongToMe:!1,NeedPaging:!0,PageNo:c,RecordPerPage:r,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!1,InStockTaking:!1}).then(C=>{t.pagination.total=C.TotalRecordCount,S(C.StoreInfo)}).finally(()=>{t.loading=!1})},S=r=>{t.tableData=r.map(c=>{const{material:n,store:d}=c,{id:s,MaterialId:E,Operator1Id:M,amount:T,GoodsShelf:k,EndDate:_,CloneNumber:b,unit:w,LotNumber:z,DiseaseType:C,ChangeReason:X,OperateTime:q,DepartmentName:O}=d,{system_code:K,name:Y,short_name:G,brand_id:$,material_type:j,spec:Q}=n||{};return{id:s,hospital_code:E,system_code:K,name:Y,Operator1Id:M,ChangeReason:X,shortname:G,LotNumber:z,brandName:t.brandIdMap[$],department:O,inventory:T,price:"",amount:"",unit:t.MinUnitTypeMap.get(w),size:Q,kind:t.MaterialTypeMap.get(j),validity:_.substring(0,10),position1:k,CloneNumber:b||"\u65E0",DiseaseType:C,OperateTime:q.replace("T"," ")}})},m={changeReasons:{\u4E09\u7EA7\u51FA\u5E93:"level-three-out",\u9886\u7528:"request-for-use",\u7528\u5269\u5F52\u8FD8:"return-back"}},t=ne({loading:!1,MinUnitTypeMap:F(()=>a.getters.MinUnitTypeMap),MaterialTypeMap:F(()=>a.getters.MaterialTypeMap),searchParam:{searchWord:"",dateRange:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u7269\u6599\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u64CD\u4F5C\u65F6\u95F4",prop:"OperateTime"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u5E93\u5B58\u53D8\u52A8\u539F\u56E0",prop:"ChangeReason"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:160},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u4E70A\u6362B",prop:"buy_a_to_b",hidden:!a.getters.buyAToB},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],PDFHandling:!1,hospitalCodeMap:new Map,brandIdMap:F(()=>a.getters.brandIdMap)}),p=r=>{r&&(t.pagination.currentPage=1),D()},P=F(()=>t.headersConfig.filter(r=>!r.hidden)),B={calcHeaderWidth:y("calcHeaderMinWidth"),handleClickSetting(){V(t.headersConfig,r=>{t.headersConfig=r})},handlePaginationChange(){p(!1)},handleSearch(){p(!0)},handleSearchMoreParamChange(r){t.searchMoreParam=r,p(!0)},handleExportXLSX(){o(t.headersConfig,t.tableData,"\u5E93\u5B58\u8BB0\u5F55","\u5E93\u5B58\u8BB0\u5F55\u8BE6\u60C5")},handleExportPDF(){t.PDFHandling=!0,R(t.headersConfig,t.tableData,"\u5E93\u5B58\u8BB0\u5F55").finally(()=>{t.PDFHandling=!1})}};return oe(()=>a.getters.settings,()=>{t.headersConfig=a.getters.settings[e.name]||t.headersConfig}),re(()=>{D()}),U(I(I({state:t},B),m),{headersShown:P})}}),he={class:"date-box"},me=f("\u67E5\u8BE2"),be=f("\u5BFC\u51FAxlsx"),Ce=f("\u5BFC\u51FApdf"),ye={key:1};function Fe(e,a,o,R,V,D){const S=i("el-date-picker"),m=i("el-input"),t=i("el-button"),p=i("styled-search"),P=i("el-tag"),B=i("el-table-column"),r=i("styled-table"),c=i("styled-pagination");return g(),h(W,null,[l(p,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":u(()=>[l("div",he,[l(S,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":a[1]||(a[1]=n=>e.state.searchParam.dateRange=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),l(m,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":a[2]||(a[2]=n=>e.state.searchParam.searchWord=n),placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57",clearable:"",onKeydown:A(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(m,{modelValue:e.state.searchParam.diseaseType,"onUpdate:modelValue":a[3]||(a[3]=n=>e.state.searchParam.diseaseType=n),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u75C5\u79CD\u4FE1\u606F",clearable:"",onKeydown:A(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(t,{type:"primary",class:"search",onClick:e.handleSearch},{default:u(()=>[me]),_:1},8,["onClick"])]),"styled-search-right":u(()=>[l(t,{type:"success",class:"export",disabled:e.state.tableData.length===0,onClick:e.handleExportXLSX},{default:u(()=>[be]),_:1},8,["disabled","onClick"]),l(t,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:e.state.tableData.length===0,onClick:e.handleExportPDF},{default:u(()=>[Ce]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),l(r,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":u(()=>[(g(!0),h(W,null,le(e.headersShown,(n,d)=>(g(),h(B,{"show-overflow-tooltip":"",key:d,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,d)},{header:u(s=>[l("span",null,N(s.column.label),1)]),default:u(s=>[s.column.property==="ChangeReason"?(g(),h(P,{key:0,class:e.changeReasons[s.row[n.prop]]},{default:u(()=>[f(N(s.row[n.prop]),1)]),_:2},1032,["class"])):(g(),h("span",ye,N(s.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting"]),l(c,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":a[4]||(a[4]=n=>e.state.pagination.currentPage=n),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":a[5]||(a[5]=n=>e.state.pagination.pageSize=n),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var Pe=ie(ge,[["render",Fe]]);export{Pe as default};
