var U=Object.defineProperty,H=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var A=(e,t,s)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,F=(e,t)=>{for(var s in t||(t={}))L.call(t,s)&&A(e,s,t[s]);if(y)for(var s of y(t))O.call(t,s)&&A(e,s,t[s]);return e},w=(e,t)=>H(e,W(t));import{_ as $,u as T,b as q,d as z}from"./index.1a2bb961.js";import{d as j,r as G,c as R,i as Y,S as b,w as J,O as K,Y as v,j as P,k as Q,E as d,m as c,q as m,y as u,F as E,A as X,z as h,B as Z,C as _}from"../vendors/element-plus-6f9977bb.js";import{V as x,g as ee,h as ue}from"./index-59b3f7ec.js";import{_ as S,a as te}from"./failed-0ae6e7e8.js";import{_ as ae}from"./tip-1b2ff95a.js";import"./md5-3215d1da.js";const oe=j({name:"dangerinwarehousing",components:{"validate-acceptor-dialog":x},setup(){const e=T(),t=q(),s=z(),C={labelWidth:"90px",FROM_WHERE:"/dangerinwarehouse"},a=G({MinUnitTypeMap:R(()=>s.getters.MinUnitTypeMap),acceptanceData:{acceptor1:R(()=>s.getters.username)},secondAcceptorList:[],tableData:[],headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u64CD\u4F5C\u5458",prop:"Operator1Id"},{label:"\u9886\u7528\u91CF",prop:"use_amount"},{label:"\u5F52\u8FD8\u6570\u91CF",prop:"return_number"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:160},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],dangerReturnDialog:!1,dangerReturning:!1,dialogValidateShow:!1,validateSuccess:!1}),f={calcHeaderWidth:Y("calcHeaderMinWidth"),handleDangerReturn(){a.dangerReturnDialog=!0},handleGoBack(){e.go(-1)},confirmDangerReturn(){if(a.tableData.some(r=>Number(r.return_number)<=0))return b.error("\u4E0D\u5141\u8BB8\u5C06\u5F52\u8FD8\u91CF\u8BBE\u7F6E\u4E3A\u975E\u6B63\u6570\uFF01\uFF01\uFF01");if(a.tableData.some(r=>Number(r.return_number)>Number(r.use_amount)))return b.error("\u5F52\u8FD8\u91CF\u4E0D\u5141\u8BB8\u5927\u4E8E\u4E0A\u6B21\u7684\u9886\u7528\u91CF\uFF01\uFF01\uFF01");const i={ReturnHChemicals:a.tableData.map(r=>{const{id:l,unit:g,return_number:D}=r;return{StoreId:l,amount:Number(D),unit:a.MinUnitTypeMap.get(g)}})};a.dangerReturning=!0,ee(i).then(()=>{b.success("\u64CD\u4F5C\u6210\u529F"),e.push(C.FROM_WHERE)}).finally(()=>{a.dangerReturning=!1,a.dangerReturnDialog=!1})},handleValidateSuccess(){a.validateSuccess=!0}};return J(()=>s.getters.settings,()=>{a.headersConfig=s.getters.settings[t.name]||a.headersConfig}),K(()=>{let i=t.params.chosenTableData;if(!i||(i=JSON.parse(i),!i.length))return e.push(C.FROM_WHERE);a.tableData=i.map(l=>w(F({},l),{return_number:0}));const r=a.tableData.map(l=>l.DepartmentId);ue(r).then(l=>{a.secondAcceptorList=l.inspectors.map(g=>({label:g.UserDisplayName,value:g.UserName})),a.secondAcceptorList.length===0&&(a.tableData.length===1?v({title:"\u63D0\u793A",message:"\u6682\u65F6\u627E\u4E0D\u5230\u53EF\u4EE5\u4F5C\u4E3A\u6B64\u5371\u9669\u54C1\u7684\u7B2C\u4E8C\u89C1\u8BC1\u4EBA\uFF0C\u8BF7\u8054\u7CFB\u90E8\u95E8\u7BA1\u7406\u5458\u8FDB\u884C\u6DFB\u52A0\u3002",type:"warning",duration:0}):v({title:"\u63D0\u793A",message:"\u6682\u65F6\u627E\u4E0D\u5230\u53EF\u4EE5\u540C\u65F6\u4F5C\u4E3A\u8FD9\u4E9B\u5371\u9669\u54C1\u7684\u7B2C\u4E8C\u89C1\u8BC1\u4EBA\uFF0C\u8BF7\u8FD4\u56DE\u91CD\u65B0\u9009\u62E9\u3002",type:"warning",duration:0}))})}),F(F({state:a},f),C)}}),o=Z();P("data-v-4e86df3d");const se=u("img",{class:"verified-img1",src:S,alt:"\u9A8C\u8BC1\u6210\u529F"},null,-1),ne=_("\u53CC\u4EBA\u53CC\u9501\u9A8C\u8BC1"),le={key:0,class:"validate-message success"},re=u("span",null,"\u53CC\u4EBA\u53CC\u9501\u5DF2\u9A8C\u8BC1",-1),ie=u("img",{src:S,alt:"\u9A8C\u8BC1\u6210\u529F"},null,-1),de={key:1,class:"validate-message error"},pe=u("span",null,"\u53CC\u4EBA\u53CC\u9501\u672A\u9A8C\u8BC1",-1),ce=u("img",{src:te,alt:"\u9A8C\u8BC1\u5931\u8D25"},null,-1),me=_("\u786E\u5B9A\u5F52\u8FD8"),_e=_("\u8FD4\u56DE\u9009\u62E9"),ge={style:{"margin-left":"4px"}},Ce={key:1},Fe=u("div",{class:"title"},"\u63D0\u793A",-1),he={class:"tip-body"},De=u("img",{src:ae,alt:""},null,-1),be=_("\u786E\u8BA4\u8981\u5BF9\u9009\u4E2D\u7684"),Ee={class:"item-name"},fe=_("\u4E2A\u5371\u9669\u54C1\u8FDB\u884C\u5F52\u8FD8\u5417?"),Be={class:"right-footer"},ye=_("\u53D6\u6D88"),Ae=_("\u786E\u5B9A");Q();const we=o((e,t,s,C,a,f)=>{const i=d("el-input"),r=d("el-form-item"),l=d("el-button"),g=d("el-form"),D=d("styled-search"),V=d("el-table-column"),k=d("styled-table"),M=d("validate-acceptor-dialog"),N=d("el-dialog");return c(),m(E,null,[u(D,{"hide-search-more":""},{"styled-search-left":o(()=>[u(g,{class:"danger-accepting",inline:!0,model:e.state.acceptanceData,"label-position":"right"},{default:o(()=>[u(r,{label:"\u5F52\u8FD8\u4EBA"},{default:o(()=>[u(i,{disabled:"",modelValue:e.state.acceptanceData.acceptor1,"onUpdate:modelValue":t[1]||(t[1]=n=>e.state.acceptanceData.acceptor1=n),placeholder:"\u8BF7\u8F93\u5165\u5F52\u8FD8\u4EBA"},null,8,["modelValue"]),se]),_:1}),u(r,null,{default:o(()=>[u(l,{type:"primary",onClick:t[2]||(t[2]=n=>e.state.dialogValidateShow=!0)},{default:o(()=>[ne]),_:1}),e.state.validateSuccess?(c(),m("span",le,[re,ie])):(c(),m("span",de,[pe,ce]))]),_:1})]),_:1},8,["model"])]),"styled-search-right":o(()=>[u(l,{type:"primary",class:"search",onClick:e.handleDangerReturn,disabled:!e.state.validateSuccess},{default:o(()=>[me]),_:1},8,["onClick","disabled"]),u(l,{type:"primary",plain:"",onClick:e.handleGoBack},{default:o(()=>[_e]),_:1},8,["onClick"])]),_:1}),u(k,{setting:"",data:e.state.tableData},{"table-columns":o(()=>[(c(!0),m(E,null,X(e.state.headersConfig,(n,B)=>(c(),m(V,{"show-overflow-tooltip":"",key:B,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,B)},{header:o(p=>[u("span",null,h(p.column.label),1)]),default:o(p=>[p.column.property==="return_number"?(c(),m(E,{key:0},[u(i,{size:"small",style:{width:"calc(100% - 35px)"},type:"text",modelValue:p.row[n.prop],"onUpdate:modelValue":I=>p.row[n.prop]=I},null,8,["modelValue","onUpdate:modelValue"]),u("span",ge,h(p.row.unit),1)],64)):(c(),m("span",Ce,h(p.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"]),u(M,{purpose:"Return",param:"StoreIds","dialog-show":e.state.dialogValidateShow,"onUpdate:dialog-show":t[3]||(t[3]=n=>e.state.dialogValidateShow=n),acceptors:e.state.secondAcceptorList,ids:e.state.tableData.map(n=>n.id),onValidateSuccess:e.handleValidateSuccess},null,8,["dialog-show","acceptors","ids","onValidateSuccess"]),u(N,{width:"466px",modelValue:e.state.dangerReturnDialog,"onUpdate:modelValue":t[5]||(t[5]=n=>e.state.dangerReturnDialog=n)},{title:o(()=>[Fe]),footer:o(()=>[u("div",Be,[u(l,{onClick:t[4]||(t[4]=n=>e.state.dangerReturnDialog=!1),class:"cancel"},{default:o(()=>[ye]),_:1}),u(l,{type:"primary",loading:e.state.dangerReturning,onClick:e.confirmDangerReturn,class:"confirm"},{default:o(()=>[Ae]),_:1},8,["loading","onClick"])])]),default:o(()=>[u("div",he,[De,u("span",null,[be,u("span",Ee,h(e.state.tableData.length),1),fe])])]),_:1},8,["modelValue"])],64)});var Ie=$(oe,[["render",we],["__scopeId","data-v-4e86df3d"]]);export{Ie as default};
