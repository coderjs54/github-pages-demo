System.register(["../vendors/element-plus-legacy-e48d1ae3.js","./index-legacy.acc39ef9.js"],(function(e){"use strict";var a,t,n,r,l,o,s,d,i,p,c,h,g,u,m,b,y,C,P,f,S,M;return{setters:[function(e){a=e.d,t=e.i,n=e.r,r=e.c,l=e.w,o=e.o,s=e.E,d=e.m,i=e.q,p=e.y,c=e.G,h=e.N,g=e.F,u=e.A,m=e.z,b=e.C,y=e.I},function(e){C=e.r,P=e.U,f=e._,S=e.b,M=e.d}],execute:function(){const T=a({setup(){const e=S(),a=M(),s=t("exportXLSX"),d=t("exportPDF"),i=t("setTableHeaders"),p=()=>{h.loading=!0;const{pageSize:e,currentPage:a}=y(h.pagination),{searchWord:t,dateRange:n,diseaseType:r}=y(h.searchParam),{department:l,materialType:o,brand:s,instrument:d,warehouse:i}=y(h.searchMoreParam),[p,g]=n||["",""];(function(e){return C.post(P.INVENTORY.queryInventory,e)})({InStoreBeginDate:p,InStoreEndDate:g,SearchWord:t,NeedCheckHChemical:!0,isHazardousChemical:!1,DiseaseType:r,DepartmentId:l,MaterialType:o,Brand:s,Instrument:d,GoodsShelf:i,IsBelongToMe:!1,NeedPaging:!0,PageNo:a,RecordPerPage:e,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!1,InStockTaking:!1}).then((e=>{h.pagination.total=e.TotalRecordCount,c(e.StoreInfo)})).finally((()=>{h.loading=!1}))},c=e=>{h.tableData=e.map((e=>{const{material:a,store:t}=e,{id:n,MaterialId:r,Operator1Id:l,amount:o,GoodsShelf:s,EndDate:d,CloneNumber:i,unit:p,LotNumber:c,DiseaseType:g,ChangeReason:u,OperateTime:m,DepartmentName:b}=t,{system_code:y,name:C,short_name:P,brand_id:f,material_type:S,spec:M}=a||{};return{id:n,hospital_code:r,system_code:y,name:C,Operator1Id:l,ChangeReason:u,shortname:P,LotNumber:c,brandName:h.brandIdMap[f],department:b,inventory:o,price:"",amount:"",unit:h.MinUnitTypeMap.get(p),size:M,kind:h.MaterialTypeMap.get(S),validity:d.substring(0,10),position1:s,CloneNumber:i||"无",DiseaseType:g,OperateTime:m.replace("T"," ")}}))},h=n({loading:!1,MinUnitTypeMap:r((()=>a.getters.MinUnitTypeMap)),MaterialTypeMap:r((()=>a.getters.MaterialTypeMap)),searchParam:{searchWord:"",dateRange:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"序号",prop:"id"},{label:"物料院内码",prop:"hospital_code"},{label:"库位",prop:"position1"},{label:"系统码",prop:"system_code"},{label:"物料名称",prop:"name"},{label:"物料简称",prop:"shortname"},{label:"物料批号",prop:"LotNumber"},{label:"品牌",prop:"brandName"},{label:"组织名称",prop:"department"},{label:"操作时间",prop:"OperateTime"},{label:"库存量",prop:"inventory"},{label:"单位",prop:"unit"},{label:"库存变动原因",prop:"ChangeReason"},{label:"物料规格",prop:"size"},{label:"物料类型",prop:"kind"},{label:"效期",prop:"validity",width:160},{label:"克隆号",prop:"CloneNumber"},{label:"买A换B",prop:"buy_a_to_b",hidden:!a.getters.buyAToB},{label:"病种类型",prop:"DiseaseType"}],tableData:[],PDFHandling:!1,hospitalCodeMap:new Map,brandIdMap:r((()=>a.getters.brandIdMap))}),g=e=>{e&&(h.pagination.currentPage=1),p()},u=r((()=>h.headersConfig.filter((e=>!e.hidden)))),m={calcHeaderWidth:t("calcHeaderMinWidth"),handleClickSetting(){i(h.headersConfig,(e=>{h.headersConfig=e}))},handlePaginationChange(){g(!1)},handleSearch(){g(!0)},handleSearchMoreParamChange(e){h.searchMoreParam=e,g(!0)},handleExportXLSX(){s(h.headersConfig,h.tableData,"库存记录","库存记录详情")},handleExportPDF(){h.PDFHandling=!0,d(h.headersConfig,h.tableData,"库存记录").finally((()=>{h.PDFHandling=!1}))}};return l((()=>a.getters.settings),(()=>{h.headersConfig=a.getters.settings[e.name]||h.headersConfig})),o((()=>{p()})),{state:h,...m,changeReasons:{"三级出库":"level-three-out","领用":"request-for-use","用剩归还":"return-back"},headersShown:u}}}),D={class:"date-box"},k=b("查询"),_=b("导出xlsx"),w=b("导出pdf"),I={key:1};e("default",f(T,[["render",function(e,a,t,n,r,l){const o=s("el-date-picker"),y=s("el-input"),C=s("el-button"),P=s("styled-search"),f=s("el-tag"),S=s("el-table-column"),M=s("styled-table"),T=s("styled-pagination");return d(),i(g,null,[p(P,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":c((()=>[p("div",D,[p(o,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":a[1]||(a[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),p(y,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":a[2]||(a[2]=a=>e.state.searchParam.searchWord=a),placeholder:"请输入查询关键字",clearable:"",onKeydown:h(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),p(y,{modelValue:e.state.searchParam.diseaseType,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.searchParam.diseaseType=a),placeholder:"请输入物料病种信息",clearable:"",onKeydown:h(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),p(C,{type:"primary",class:"search",onClick:e.handleSearch},{default:c((()=>[k])),_:1},8,["onClick"])])),"styled-search-right":c((()=>[p(C,{type:"success",class:"export",disabled:0===e.state.tableData.length,onClick:e.handleExportXLSX},{default:c((()=>[_])),_:1},8,["disabled","onClick"]),p(C,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:0===e.state.tableData.length,onClick:e.handleExportPDF},{default:c((()=>[w])),_:1},8,["loading","disabled","onClick"])])),_:1},8,["onChooseSearchMoreParam"]),p(M,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":c((()=>[(d(!0),i(g,null,u(e.headersShown,((a,t)=>(d(),i(S,{"show-overflow-tooltip":"",key:t,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,t)},{header:c((e=>[p("span",null,m(e.column.label),1)])),default:c((t=>["ChangeReason"===t.column.property?(d(),i(f,{key:0,class:e.changeReasons[t.row[a.prop]]},{default:c((()=>[b(m(t.row[a.prop]),1)])),_:2},1032,["class"])):(d(),i("span",I,m(t.row[a.prop]),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["loading","data","onClickSetting"]),p(T,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":a[4]||(a[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":a[5]||(a[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}]]))}}}));
