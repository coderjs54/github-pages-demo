var se=Object.defineProperty;var w=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var k=(e,t,n)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))pe.call(t,n)&&k(e,n,t[n]);if(w)for(var n of w(t))ie.call(t,n)&&k(e,n,t[n]);return e};import{d as le,i as U,r as de,c,I as F,w as ce,o as me,E as s,m as b,q as C,y as p,G as i,N as ge,C as S,z as _,F as I,A as he}from"../vendors/element-plus-6f9977bb.js";import{r as E,U as P,_ as be,u as Ce,b as _e,d as ye}from"./index.1a2bb961.js";import{d as Me}from"./department-c80e70e8.js";import{i as De}from"./instrument-9ec20200.js";function fe(e){return E.post(P.MATERIAL.queryMaterial,e)}function Fe(e=""){return E.post(P.VENDOR.queryVendor,{search_word:e})}function Se(){return E.get(P.DEPARTMENT.queryDepartment)}const Ee=le({setup(){const e=Ce(),t=_e(),n=ye(),T=U("setTableHeaders"),y=()=>{a.loading=!0;const{pageSize:r,currentPage:u}=F(a.pagination),{shortname:g,isDanger:h}=F(a.searchParam);fe({searchWord:g,DepartmentId:"",MaterialType:"",BrandId:"",InstrumentId:"",NeedPaging:!0,PageNo:u,RecordPerPage:r,CheckHChemical:!0,IsHChemical:h}).then(l=>{a.pagination.total=l.TotalRecordCount,B(l.materials)}).finally(()=>{a.loading=!1})},B=r=>{a.tableData=r.map(u=>{const{brand_id:g,departmentOwners:h,hospital_code:o,id:l,instrumentOwners:d,invoiceCorp:q,isGift:z,IsHazardousChemical:A,isMinUnitPurchase:O,isPublicReagent:R,material_type:V,minimumUnit:H,name:L,needPurchase:N,onBoardInfo:$,onBoardType:j,openValidDays:W,printOpenLabel:K,purchasePrice:G,purchaseUnit:J,shippingCorp:Q,short_name:X,spec:Y,stopUseReason:Z,storeCondition:x,storePos:ee,supplier:ae,system_code:te,tempratureScope:ne,uniqueCodeManage:re}=u,oe=Me(h).map(f=>a.departmentMaps[f]).join(","),ue=De(d).map(f=>a.instrumentMaps[f]).join(",");return{serverObj:u,short_name:X,id:l,hospital_code:o,material_name:L,brand:a.brandMaps[g]||"\u672A\u77E5\u54C1\u724C",system_code:te,is_danger:A?"\u662F":"\u5426",type:a.MaterialTypeMap.get(V),size:Y,restore_condition:a.StoreTypeMap.get(x),temperature:ne,arrived_scope:a.OnboardTypeMap.get(j),arrived_date:$,purchase_price:G,print_label:K?"\u662F":"\u5426",department:oe,instrument:ue,open_expire:`${W} \u5929`,purchase_unit:a.MinUnitTypeMap.get(J),min_unit:a.MinUnitTypeMap.get(H),unique_code:re?"\u662F":"\u5426",is_gift:z?"\u662F":"\u5426",store_position:ee,purchase_status:N?"\u91C7\u8D2D":"\u505C\u8D2D",stop_reason:Z,public:R?"\u662F":"\u5426",min_unit_purchase:O?"\u662F":"\u5426",supplier:a.companyMaps[ae],invoice_company:a.companyMaps[q],ship_company:a.companyMaps[Q]}})},a=de({loading:!1,MaterialTypeMap:c(()=>n.getters.MaterialTypeMap),StoreTypeMap:c(()=>n.getters.StoreTypeMap),MinUnitTypeMap:c(()=>n.getters.MinUnitTypeMap),OnboardTypeMap:c(()=>n.getters.OnboardTypeMap),searchParam:{shortname:"",isDanger:!1},pagination:{currentPage:1,total:0,pageSize:30},tableData:[],brandMaps:c(()=>n.getters.brandIdMap),instrumentMaps:c(()=>n.getters.instrumentIdMap),companyMaps:{},departmentMaps:{},headersConfig:[{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"short_name"},{label:"\u662F\u5426\u5371\u9669\u54C1",prop:"is_danger"},{label:"\u54C1\u724C",prop:"brand"},{label:"\u7C7B\u578B",prop:"type"},{label:"\u89C4\u683C",prop:"size"},{label:"\u50A8\u5B58\u6761\u4EF6",prop:"restore_condition"},{label:"\u6E29\u5EA6\u8303\u56F4",prop:"temperature"},{label:"\u5230\u8D27\u8303\u56F4",prop:"arrived_scope"},{label:"\u5230\u8D27\u65E5\u671F",prop:"arrived_date"},{label:"\u91C7\u8D2D\u5355\u4EF7",prop:"purchase_price"},{label:"\u6253\u5370\u5F00\u74F6\u6807\u8D34",prop:"print_label"},{label:"\u6240\u5C5E\u90E8\u95E8",prop:"department"},{label:"\u6240\u5C5E\u4EEA\u5668",prop:"instrument"},{label:"\u5F00\u5C01\u6548\u671F",prop:"open_expire"},{label:"\u5E93\u5B58\u4F4D\u7F6E",prop:"store_position"},{label:"\u91C7\u8D2D\u5355\u4F4D",prop:"purchase_unit"},{label:"\u6700\u5C0F\u5355\u4F4D",prop:"min_unit"},{label:"\u552F\u4E00\u7BA1\u7406\u7801",prop:"unique_code"},{label:"\u662F\u5426\u8D60\u54C1",prop:"is_gift"},{label:"\u91C7\u8D2D\u72B6\u6001",prop:"purchase_status"},{label:"\u516C\u5171\u8BD5\u5242",prop:"public"},{label:"\u6700\u5C0F\u5355\u4F4D\u91C7\u8D2D",prop:"min_unit_purchase"},{label:"\u4F9B\u5E94\u5546",prop:"supplier"},{label:"\u5F00\u7968\u516C\u53F8",prop:"invoice_company"},{label:"\u53D1\u8D27\u516C\u53F8",prop:"ship_company"}],multipleSelection:[]}),m=r=>{r&&(a.pagination.currentPage=1),y()},M=c(()=>a.headersConfig.filter(r=>!r.hidden)),D={calcHeaderWidth:U("calcHeaderMinWidth"),handleClickSetting(){T(a.headersConfig,r=>{a.headersConfig=r})},handlePaginationChange(){m(!1)},handleSearch(){m(!0)},handleAddOrder(){const r=F(a.multipleSelection);!r.length||e.push({name:"orderadding",params:{tableData:JSON.stringify(r)}})},handleChangeMultiple(r){a.multipleSelection=r}};return ce(()=>n.getters.settings,()=>{a.headersConfig=n.getters.settings[t.name]||a.headersConfig}),me(()=>{Promise.all([Fe().then(r=>{r.companies.forEach(u=>{a.companyMaps[u.id]=u.name})}),Se().then(r=>{r.departments.forEach(u=>{a.departmentMaps[u.id]=u.name})})]).then(()=>{y()})}),v({state:a,headersShown:M},D)}}),Pe=S("\u67E5\u8BE2"),Te={key:1};function Be(e,t,n,T,y,B){const a=s("el-input"),m=s("el-button"),M=s("el-switch"),D=s("styled-search"),r=s("el-tag"),u=s("el-table-column"),g=s("styled-table"),h=s("styled-pagination");return b(),C(I,null,[p(D,{"hide-search-more":""},{"styled-search-left":i(()=>[p(a,{modelValue:e.state.searchParam.shortname,"onUpdate:modelValue":t[1]||(t[1]=o=>e.state.searchParam.shortname=o),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u540D\u79F0\u3001\u7B80\u79F0\u3001\u6216\u9662\u5185\u7801",clearable:"",onKeydown:ge(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),p(m,{type:"primary",class:"search",onClick:e.handleSearch},{default:i(()=>[Pe]),_:1},8,["onClick"]),p(M,{modelValue:e.state.searchParam.isDanger,"onUpdate:modelValue":t[2]||(t[2]=o=>e.state.searchParam.isDanger=o),"active-text":"\u5371\u9669\u54C1","inactive-text":"\u975E\u5371\u9669\u54C1",onChange:e.handleSearch},null,8,["modelValue","onChange"])]),"styled-search-right":i(()=>[p(m,{type:"primary",disabled:e.state.multipleSelection.length===0,class:"search",onClick:e.handleAddOrder},{default:i(()=>[S("\u53BB\u8BF7\u8D2D("+_(e.state.multipleSelection.length)+")",1)]),_:1},8,["disabled","onClick"])]),_:1}),p(g,{setting:"",loading:e.state.loading,multiple:"",data:e.state.tableData,onChangeMultiple:e.handleChangeMultiple,onClickSetting:e.handleClickSetting},{"table-columns":i(()=>[(b(!0),C(I,null,he(e.headersShown,(o,l)=>(b(),C(u,{"show-overflow-tooltip":"",key:l,prop:o.prop,label:o.label,"min-width":e.calcHeaderWidth(o,l)},{header:i(d=>[p("span",null,_(d.column.label),1)]),default:i(d=>[o.prop==="is_danger"?(b(),C(r,{key:0,class:d.row.is_danger==="\u662F"?"danger-material":"normal-material"},{default:i(()=>[S(_(d.row.is_danger),1)]),_:2},1032,["class"])):(b(),C("span",Te,_(d.row[o.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onChangeMultiple","onClickSetting"]),p(h,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[3]||(t[3]=o=>e.state.pagination.currentPage=o),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[4]||(t[4]=o=>e.state.pagination.pageSize=o),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var qe=be(Ee,[["render",Be]]);export{qe as default};
