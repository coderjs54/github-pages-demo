var K=Object.defineProperty,O=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var A=(e,n,o)=>n in e?K(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,b=(e,n)=>{for(var o in n||(n={}))Y.call(n,o)&&A(e,o,n[o]);if(v)for(var o of v(n))$.call(n,o)&&A(e,o,n[o]);return e},T=(e,n)=>O(e,W(n));import{d as q,i as C,r as G,c as N,w as j,o as Q,E as d,m as g,q as h,y as l,G as u,N as H,F as z,A as J,z as _,C as F,I as k}from"../vendors/element-plus-6f9977bb.js";import{_ as Z,d as x,b as ee}from"./index.1a2bb961.js";import{r as ae}from"./inwarehouserecords-cb91842f.js";const te=q({setup(){const e=x(),n=ee(),o=C("exportXLSX"),I=C("exportPDF"),R=C("setTableHeaders"),y=()=>{t.loading=!0;const{pageSize:r,currentPage:c}=k(t.pagination),{dateRange:a,shortname:i,cloneNumber:s,diseaseType:E}=k(t.searchParam),{department:D,materialType:M,brand:w,instrument:B,warehouse:U}=k(t.searchMoreParam),[X,L]=a||["",""];ae({search_word:i,QueryHChemical:0,departmentId:"",InStoreBeginTime:X,InStoreEndTime:L,CloneNumber:s,DiseaseType:E,DepartmentId:D,MaterialType:M,Brand:w,Instrument:B,GoodsShelf:U,NeedPaging:!0,PageNo:c,RecordPerPage:r}).then(V=>{t.pagination.total=V.TotalRecordCount,S(V.stores)}).finally(()=>{t.loading=!1})},S=r=>{t.tableData=r.map(c=>{const{material:a,store:i}=c,{CloneNumber:s,unit:E,OperateTime:D,MaterialinThisStage:M,ChangeReason:w,departmentName:B}=i;return T(b({},i),{currStage:w,MaterialinThisStage:M?"\u662F":"\u5426",OperateTime:D.substr(0,19).replace("T"," "),departmentName:B,unit:t.MinUnitTypeMap.get(E),material_name:a==null?void 0:a.name,shortname:a==null?void 0:a.short_name,standard:a==null?void 0:a.spec,brandName:t.brandIdMap[a==null?void 0:a.brand_id],cloneNumber:s})})},m={currentStages:{\u4E00\u7EA7\u5165\u5E93:"level-one-in",\u4E8C\u7EA7\u5165\u5E93:"level-two-in",\u4E09\u7EA7\u5165\u5E93:"level-three-in"}},t=G({loading:!1,MinUnitTypeMap:N(()=>e.getters.MinUnitTypeMap),brandIdMap:N(()=>e.getters.brandIdMap),searchParam:{shortname:"",dateRange:"",cloneNumber:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},tableData:[],headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u8BA2\u5355\u53F7",prop:"DeliverOrderId"},{label:"\u9662\u5185\u7801",prop:"MaterialId"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u89C4\u683C",prop:"standard"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u6548\u671F",prop:"EndDate",width:160},{label:"\u6570\u91CF",prop:"amount"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u5165\u5E93\u4EBA",prop:"Operator1Id"},{label:"\u5165\u5E93\u65F6\u95F4",prop:"OperateTime"},{label:"\u5165\u5E93\u7B49\u7EA7",prop:"currStage"},{label:"\u6240\u5C5E\u90E8\u95E8",prop:"departmentName"},{label:"\u514B\u9686\u53F7",prop:"cloneNumber"}],pagination:{currentPage:1,total:0,pageSize:30},PDFHandling:!1}),p=r=>{r&&(t.pagination.currentPage=1),y()},f=N(()=>t.headersConfig.filter(r=>!r.hidden)),P={calcHeaderWidth:C("calcHeaderMinWidth"),handleClickSetting(){R(t.headersConfig,r=>{t.headersConfig=r})},handlePaginationChange(){p(!1)},handleSearch(){p(!0)},handleSearchMoreParamChange(r){t.searchMoreParam=r,p(!0)},handleExportXLSX(){o(t.headersConfig,t.tableData,"\u5165\u5E93\u8BB0\u5F55","\u5165\u5E93\u8BB0\u5F55\u8BE6\u60C5")},handleExportPDF(){t.PDFHandling=!0,I(t.headersConfig,t.tableData,"\u9A8C\u6536\u8BB0\u5F55").finally(()=>{t.PDFHandling=!1})}};return j(()=>e.getters.settings,()=>{t.headersConfig=e.getters.settings[n.name]||t.headersConfig}),Q(()=>{y()}),T(b(b({state:t},P),m),{headersShown:f})}}),ne={class:"date-box"},oe=F("\u67E5\u8BE2"),re=F("\u5BFC\u51FAxlsx"),le=F("\u5BFC\u51FApdf"),se={key:1};function ue(e,n,o,I,R,y){const S=d("el-date-picker"),m=d("el-input"),t=d("el-button"),p=d("styled-search"),f=d("el-tag"),P=d("el-table-column"),r=d("styled-table"),c=d("styled-pagination");return g(),h(z,null,[l(p,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":u(()=>[l("div",ne,[l(S,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":n[1]||(n[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),l(m,{modelValue:e.state.searchParam.shortname,"onUpdate:modelValue":n[2]||(n[2]=a=>e.state.searchParam.shortname=a),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u540D\u79F0\u3001\u7B80\u79F0\u3001\u6216\u9662\u5185\u7801",clearable:"",onKeydown:H(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(m,{modelValue:e.state.searchParam.cloneNumber,"onUpdate:modelValue":n[3]||(n[3]=a=>e.state.searchParam.cloneNumber=a),placeholder:"\u8BF7\u8F93\u5165\u514B\u9686\u53F7",clearable:"",onKeydown:H(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(t,{type:"primary",class:"search",onClick:e.handleSearch},{default:u(()=>[oe]),_:1},8,["onClick"])]),"styled-search-right":u(()=>[l(t,{type:"success",class:"export",disabled:e.state.tableData.length===0,onClick:e.handleExportXLSX},{default:u(()=>[re]),_:1},8,["disabled","onClick"]),l(t,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:e.state.tableData.length===0,onClick:e.handleExportPDF},{default:u(()=>[le]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),l(r,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":u(()=>[(g(!0),h(z,null,J(e.headersShown,(a,i)=>(g(),h(P,{"show-overflow-tooltip":"",key:i,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,i)},{header:u(s=>[l("span",null,_(s.column.label),1)]),default:u(s=>[s.column.property==="currStage"?(g(),h(f,{key:0,class:e.currentStages[s.row[a.prop]]},{default:u(()=>[F(_(s.row[a.prop]),1)]),_:2},1032,["class"])):(g(),h("span",se,_(s.row[a.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting"]),l(c,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":n[4]||(n[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":n[5]||(n[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var he=Z(te,[["render",ue]]);export{he as default};
