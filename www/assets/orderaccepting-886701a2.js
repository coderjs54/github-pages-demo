var L=Object.defineProperty,q=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var O=(e,l,i)=>l in e?L(e,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[l]=i,f=(e,l)=>{for(var i in l||(l={}))$.call(l,i)&&O(e,i,l[i]);if(U)for(var i of U(l))X.call(l,i)&&O(e,i,l[i]);return e},B=(e,l)=>q(e,H(l));import{r as W,U as Y,_ as G,u as Q,d as j,b as J}from"./index.1a2bb961.js";import{d as K,i as R,a as Z,r as x,I as ee,S as P,w as M,O as te,E as d,m as c,q as m,y as o,G as r,z as g,F as A,A as z,C as b}from"../vendors/element-plus-6f9977bb.js";import{a as le}from"./index-77742ce3.js";import{_ as ae}from"./tip-1b2ff95a.js";function oe(e){return W.post(Y.ACCEPTANCE.batchAcceptDelivery,e)}function ue(e){return W.post(Y.WAREHOUSE.queryWarehouse,e)}const re=K({setup(){const e=Q(),l=j(),i=J(),v=R("setTableHeaders"),N={labelWidth:"80px",batchSetTempFormRules:{temp:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u6536\u6E29\u5EA6",trigger:"blur"},{validator:le,trigger:"blur"}]}},T={batchSetTempFormRef:Z(null)},u=x({searchParam:{invoiceTogether:!0},totalMoney:0,tableData:[],headersConfig:[{label:"\u4EA4\u8D27\u5355ID",prop:"SOID"},{label:"\u4EA4\u8D27\u5355\u53F7",prop:"SONO"},{label:"\u7269\u6599\u540D\u79F0",prop:"material_name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u89C4\u683C",prop:"standard"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u4EA4\u8D27\u65E5\u671F",prop:"SODATE"},{label:"\u91C7\u8D2D\u5355\u53F7",prop:"PONO"},{label:"\u4E70A\u6362B",prop:"delivery_remarks",hidden:!l.getters.buyAToB},{label:"\u514B\u9686\u53F7",prop:"clone_number"},{label:"\u91C7\u8D2D\u5355\u660E\u7EC6\u53F7",prop:"PODETNO"},{label:"\u9662\u5185\u7801",prop:"DITEMCODE"},{label:"\u5355\u4F4D",prop:"DPACKUNIT"},{label:"\u5E94\u5230\u6570\u91CF",prop:"due_number"},{label:"\u5230\u8D27\u6570\u91CF",prop:"DQTY"},{label:"\u5B58\u653E\u5E93\u4F4D",prop:"store_position",width:150},{label:"\u6E29\u5EA6",prop:"accept_temperature",width:80},{label:"\u542B\u7A0E\u5355\u4EF7",prop:"DTAXPRC"},{label:"\u9A8C\u6536\u5355\u4EF7",prop:"accept_price"},{label:"\u542B\u7A0E\u91D1\u989D",prop:"TAXAMT"},{label:"\u6279\u53F7",prop:"LOTNO",width:150},{label:"\u6548\u671F",prop:"ENDDATE",width:160},{label:"\u7A0E\u7387",prop:"TAXRATE"}],acceptDialog:!1,accepting:!1,warehouseOptions:[],batchSetTempDialog:!1,batchSetTempForm:{temp:""}}),h={calcHeaderWidth:R("calcHeaderMinWidth"),handleClickSetting(){v(u.headersConfig,p=>{u.headersConfig=p})},handleBatchSetTemp(){u.batchSetTempDialog=!0},confirmBatchSetTemp(){T.batchSetTempFormRef.value.validate(p=>{if(!p)return;const{temp:n}=ee(u.batchSetTempForm);u.tableData=u.tableData.map(_=>B(f({},_),{accept_temperature:Number(n)})),u.batchSetTempDialog=!1})},handleAccept(){u.acceptDialog=!0},handleGoBack(){e.go(-1)},confirmAccept(){u.accepting=!0;let p=!0;const n={AcceptDeliverOrders:u.tableData.map(_=>{const{SOID:F,store_position:V,DQTY:E,due_number:w,accept_price:D,DTAXPRC:S,delivery_remarks:k,LOTNO:t,accept_temperature:y,ENDDATE:a,clone_number:s}=_;(isNaN(Number(E))||Number(E)>Number(w))&&(p=!1),y===""&&(p=!1);const C=Number(y);(isNaN(C)||C>=50||C<=-50)&&(p=!1);const I=Number(D)!==S;return{SOID:F,GoodsShelf:V,NeedChangePrice:I,Price:Number(D),BuyAToB:k,CloneNumber:s,LotNo:t,EndDate:a,ActualTemperature:C}})};p?oe(n).then(_=>{P.success("\u64CD\u4F5C\u6210\u529F"),e.push("/orderacceptance")}).finally(()=>{u.accepting=!1,u.acceptDialog=!1}):(P.error("\u8BF7\u786E\u4FDD\u586B\u5199\u6B63\u786E\u7684\u6E29\u5EA6\u4EE5\u53CA\u5230\u8D27\u6570\u91CF"),u.accepting=!1,u.acceptDialog=!1)}};return M(()=>l.getters.settings,()=>{u.headersConfig=l.getters.settings[i.name]||u.headersConfig}),M(()=>u.batchSetTempDialog,p=>{p||(u.batchSetTempForm={temp:""})}),te(()=>{Promise.all([ue({SearchWord:"",DepartmentId:""}).then(p=>{u.warehouseOptions=p.goodsShelves.map(n=>{const{name:_}=n;return{value:_,label:_}})})]).then(()=>{let p=i.params.chosenTableData;if(!p||(p=JSON.parse(p),!p.length))return e.push("/orderacceptance");u.tableData=p.map(n=>B(f({},n),{accept_price:n.DTAXPRC,store_position:n.store_pos,delivery_remarks:"",accept_temperature:"",clone_number:"",due_number:n.DQTY})),u.totalMoney=u.tableData.reduce((n,_)=>(n+=Number(_.accept_price),n),0)})}),f(f(f({state:u},N),T),h)}}),ne={class:"total-money"},se=b("\u672C\u6B21\u9A8C\u6536\u540E\u603B\u91D1\u989D\uFF1A"),pe={class:"money"},ie=b("\u662F\u5426\u8D27\u7968\u540C\u884C"),ce=b("\u6279\u91CF\u8BBE\u7F6E\u6E29\u5EA6"),me=b("\u786E\u5B9A\u9A8C\u6536"),de=b("\u8FD4\u56DE\u9009\u62E9"),_e=o("span",{style:{"margin-left":"4px"}},"\u5143",-1),be={key:8},he=o("div",{class:"title"},"\u63D0\u793A",-1),fe={class:"tip-body"},De=o("img",{src:ae,alt:""},null,-1),ye=b("\u786E\u8BA4\u8981\u5BF9\u9009\u4E2D\u7684"),Ee={class:"item-name"},Ce=b("\u4E2A\u4EA4\u8D27\u5355\u8FDB\u884C\u9A8C\u6536\u5417?"),ge={class:"right-footer"},Ae=b("\u53D6\u6D88"),Te=b("\u786E\u5B9A"),Fe=o("div",{class:"title"},"\u6279\u91CF\u8BBE\u7F6E\u6E29\u5EA6",-1),Ve={class:"center-footer"},we=b("\u53D6\u6D88"),Se=b("\u786E\u8BA4");function ke(e,l,i,v,N,T){const u=d("el-checkbox"),h=d("el-button"),p=d("styled-search"),n=d("el-input"),_=d("el-option"),F=d("el-select"),V=d("el-date-picker"),E=d("el-table-column"),w=d("styled-table"),D=d("el-dialog"),S=d("el-form-item"),k=d("el-form");return c(),m(A,null,[o(p,{"hide-search-more":""},{"styled-search-left":r(()=>[o("span",ne,[se,o("span",pe,"\uFFE5"+g(e.state.totalMoney),1)])]),"styled-search-right":r(()=>[o(u,{modelValue:e.state.searchParam.invoiceTogether,"onUpdate:modelValue":l[1]||(l[1]=t=>e.state.searchParam.invoiceTogether=t)},{default:r(()=>[ie]),_:1},8,["modelValue"]),o(h,{type:"primary",class:"search",onClick:e.handleBatchSetTemp},{default:r(()=>[ce]),_:1},8,["onClick"]),o(h,{type:"primary",class:"search",onClick:e.handleAccept},{default:r(()=>[me]),_:1},8,["onClick"]),o(h,{type:"primary",plain:"",onClick:e.handleGoBack},{default:r(()=>[de]),_:1},8,["onClick"])]),_:1}),o(w,{setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":r(()=>[(c(!0),m(A,null,z(e.state.headersConfig,(t,y)=>(c(),m(E,{"show-overflow-tooltip":"",key:y,prop:t.prop,label:t.label,"min-width":e.calcHeaderWidth(t,y)},{header:r(a=>[o("span",null,g(a.column.label),1)]),default:r(a=>[a.column.property==="accept_price"?(c(),m(A,{key:0},[o(n,{size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s},null,8,["modelValue","onUpdate:modelValue"]),_e],64)):a.column.property==="store_position"?(c(),m(F,{key:1,size:"small",style:{width:"100%"},modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s,filterable:"","allow-create":"","default-first-option":"",placeholder:"\u9009\u62E9\u6216\u8005\u8F93\u5165\u5E93\u4F4D\u540D\u79F0"},{default:r(()=>[(c(!0),m(A,null,z(e.state.warehouseOptions,s=>(c(),m(_,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.column.property==="clone_number"?(c(),m(n,{key:2,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="delivery_remarks"?(c(),m(n,{key:3,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="LOTNO"?(c(),m(n,{key:4,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="DQTY"?(c(),m(n,{key:5,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="ENDDATE"?(c(),m(V,{key:6,size:"small",style:{width:"100%"},"value-format":"YYYY-MM-DD",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s,type:"date",placeholder:"\u8BF7\u9009\u62E9\u7269\u6599\u6709\u6548\u671F"},null,8,["modelValue","onUpdate:modelValue"])):a.column.property==="accept_temperature"?(c(),m(n,{key:7,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[t.prop],"onUpdate:modelValue":s=>a.row[t.prop]=s},null,8,["modelValue","onUpdate:modelValue"])):(c(),m("span",be,g(a.row[t.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data","onClickSetting"]),o(D,{width:"466px",modelValue:e.state.acceptDialog,"onUpdate:modelValue":l[3]||(l[3]=t=>e.state.acceptDialog=t)},{title:r(()=>[he]),footer:r(()=>[o("div",ge,[o(h,{onClick:l[2]||(l[2]=t=>e.state.acceptDialog=!1),class:"cancel"},{default:r(()=>[Ae]),_:1}),o(h,{type:"primary",loading:e.state.accepting,onClick:e.confirmAccept,class:"confirm"},{default:r(()=>[Te]),_:1},8,["loading","onClick"])])]),default:r(()=>[o("div",fe,[De,o("span",null,[ye,o("span",Ee,g(e.state.tableData.length),1),Ce])])]),_:1},8,["modelValue"]),o(D,{width:"516px",modelValue:e.state.batchSetTempDialog,"onUpdate:modelValue":l[6]||(l[6]=t=>e.state.batchSetTempDialog=t)},{title:r(()=>[Fe]),footer:r(()=>[o("div",Ve,[o(h,{onClick:l[5]||(l[5]=t=>e.state.batchSetTempDialog=!1),class:"cancel"},{default:r(()=>[we]),_:1}),o(h,{type:"primary",onClick:e.confirmBatchSetTemp,class:"confirm"},{default:r(()=>[Se]),_:1},8,["onClick"])])]),default:r(()=>[o(k,{model:e.state.batchSetTempForm,rules:e.batchSetTempFormRules,ref:"batchSetTempFormRef"},{default:r(()=>[o(S,{label:"\u9A8C\u6536\u6E29\u5EA6","label-width":e.labelWidth,prop:"temp"},{default:r(()=>[o(n,{modelValue:e.state.batchSetTempForm.temp,"onUpdate:modelValue":l[4]||(l[4]=t=>e.state.batchSetTempForm.temp=t),placeholder:"\u8BF7\u8F93\u5165\u9A8C\u6536\u6E29\u5EA6",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}var Re=G(re,[["render",ke]]);export{Re as default};
