var L=Object.defineProperty;var O=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var S=(e,a,n)=>a in e?L(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,F=(e,a)=>{for(var n in a||(a={}))W.call(a,n)&&S(e,n,a[n]);if(O)for(var n of O(a))q.call(a,n)&&S(e,n,a[n]);return e};import{r as P,U as V,_ as z,b as H,u as Y}from"./index.1a2bb961.js";import{d as $,r as G,i as j,S as J,O as K,E as c,m as v,q as y,y as t,G as r,F as E,A as T,z as C,I as B,C as N}from"../vendors/element-plus-6f9977bb.js";function Q(e){return P.post(V.INVOICE.queryInvoiceDetail,e)}function X(e){return P.post(V.INVOICE.verifyInvoice,e)}function Z(e){return P.post(V.INVOICE.queryInvoiceDelivery,e)}const x=$({setup(){const e=H(),a=Y(),n={FROM_WHERE:"/invoiceverify",headersConfig:[{label:"\u53D1\u7968\u5355\u53F7",prop:"invoiceNo"},{label:"\u9A8C\u6536\u660E\u7EC6\u7F16\u53F7",prop:"acceptNo"},{label:"\u7269\u6599\u540D\u79F0",prop:"materialName"},{label:"\u91C7\u8D2D\u5355\u4EF7",prop:"purchasePrice"},{label:"\u4EA4\u8D27\u91CF",prop:"deliveryAmount"},{label:"\u8BF7\u8D2D\u5355\u4F4D",prop:"purchaseUnit"},{label:"\u91C7\u8D2D\u91D1\u989D",prop:"totalMoney"},{label:"\u4EA4\u8D27\u65E5\u671F",prop:"deliveryDate"},{label:"\u5F00\u7968\u516C\u53F8\u540D\u79F0",prop:"invoiceCompany"},{label:"\u6279\u6B21\u53F7",prop:"batchNo"},{label:"\u6548\u671F",prop:"validity",width:100}]},f=()=>{i.dialogLoading=!0;const{materialName:l,deliveryNo:u}=B(i.dialogSearchParam),{pageSize:m,currentPage:s}=B(i.dialogPagination);Z({SearchWord:l,DeliverOrderId:u,PageNo:s,RecordPerPage:m}).then(g=>{i.dialogPagination.total=g.TotalRecordCount,_(g.DeliverOrders)}).finally(()=>{i.dialogLoading=!1})},I=l=>{i.tableData=l.map(u=>{const{INVOICEDATE:m,INVOICEAMT:s,INVOICENO:D,INVOICECODE:g,VerifyStatus:o,ProviderName:d}=u;return{invoiceNumber:D,invoiceSerialNumber:g,invoiceMoney:s,status:o?"\u5DF2\u6838\u9500":"\u5F85\u6838\u9500",provider:d,invoiceCreateTime:m.substr(0,10)}})},_=l=>{console.log(l),i.dialogTableData=l.map(u=>{const{dOrder:m,material:s}=u,{name:D}=s,{INVOICENO:g,DPACKUNIT:o,INVOICETITLE:d,PONO:p,SODATE:A,ENDDATE:k,SONO:M,DQTY:R,INVOICEAMT:w,DTAXPRC:U}=m;return{invoiceNo:g,acceptNo:M,materialName:D,purchasePrice:U,deliveryAmount:R,totalMoney:w,deliveryDate:A.replace("T"," "),deliveryNo:"",purchaseUnit:o,invoiceCompany:d,deliveryCompany:"",batchNo:p,validity:k.substr(0,10)}})},b=l=>{l&&(i.pagination.currentPage=1),f()},i=G({searchParam:{invoiceNumber:"",date:""},tableData:[],headersConfig:[{label:"\u53D1\u7968\u53F7",prop:"invoiceNumber"},{label:"\u53D1\u7968\u7F16\u53F7",prop:"invoiceSerialNumber"},{label:"\u53D1\u7968\u91D1\u989D",prop:"invoiceMoney"},{label:"\u72B6\u6001",prop:"status"},{label:"\u4F9B\u5E94\u5546",prop:"provider"},{label:"\u5F00\u7968\u65F6\u95F4",prop:"invoiceCreateTime"}],blendDataDialog:!1,dialogSearchParam:{materialName:"",deliveryNo:""},dialogPagination:{currentPage:1,total:0,pageSize:30},dialogTableData:[],dialogLoading:!1}),h={calcHeaderWidth:j("calcHeaderMinWidth"),handleBlendData(){i.blendDataDialog=!0,f()},handleConfirmVerify(){const l={InvoiceNo:i.searchParam.invoiceNumber,VerifyDate:i.searchParam.date};X(l).then(u=>{J.success("\u64CD\u4F5C\u6210\u529F"),a.push(n.FROM_WHERE)})},handleGoBack(){a.go(-1)},handlePaginationChange(){b(!1)},handleDialogSearch(){b(!0)}};return K(()=>{let l=e.params.chosenTableData;if(!l||(l=JSON.parse(l),!l.length))return a.push(n.FROM_WHERE);const u=l[0].invoiceNumber;i.searchParam.invoiceNumber=u,Q({InvoiceNo:u}).then(s=>{I(s.invoices)})}),F(F({state:i},n),h)}}),ee={class:"date-box"},ae=N("\u52FE\u5151\u6570\u636E"),oe=N("\u786E\u5B9A\u6838\u9500"),te=N("\u8FD4\u56DE\u9009\u62E9"),le=t("div",{class:"title"},"\u9009\u62E9\u9A8C\u6536\u5355",-1),ne={class:"body"},ie={class:"dialog-search-area"},re=N("\u67E5\u8BE2"),ue={class:"right-footer"};function se(e,a,n,f,I,_){const b=c("el-input"),i=c("el-date-picker"),h=c("el-button"),l=c("styled-search"),u=c("el-table-column"),m=c("styled-table"),s=c("dialog-table"),D=c("styled-pagination"),g=c("el-dialog");return v(),y(E,null,[t(l,{"hide-search-more":""},{"styled-search-left":r(()=>[t(b,{modelValue:e.state.searchParam.invoiceNumber,"onUpdate:modelValue":a[1]||(a[1]=o=>e.state.searchParam.invoiceNumber=o),placeholder:"\u8BF7\u8F93\u5165\u53D1\u7968\u53F7",clearable:"",disabled:""},null,8,["modelValue"]),t("div",ee,[t(i,{modelValue:e.state.searchParam.date,"onUpdate:modelValue":a[2]||(a[2]=o=>e.state.searchParam.date=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F"},null,8,["modelValue"])])]),"styled-search-right":r(()=>[t(h,{type:"primary",class:"search",onClick:e.handleBlendData},{default:r(()=>[ae]),_:1},8,["onClick"]),t(h,{type:"success",class:"export",disabled:!e.state.searchParam.date,onClick:e.handleConfirmVerify},{default:r(()=>[oe]),_:1},8,["disabled","onClick"]),t(h,{type:"primary",plain:"",onClick:e.handleGoBack},{default:r(()=>[te]),_:1},8,["onClick"])]),_:1}),t(m,{data:e.state.tableData},{"table-columns":r(()=>[(v(!0),y(E,null,T(e.state.headersConfig,(o,d)=>(v(),y(u,{"show-overflow-tooltip":"",key:d,prop:o.prop,label:o.label,"min-width":e.calcHeaderWidth(o,d)},{header:r(p=>[t("span",null,C(p.column.label),1)]),default:r(p=>[t("span",null,C(p.row[o.prop]),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"]),t(g,{"custom-class":"blend-data",width:"90%",modelValue:e.state.blendDataDialog,"onUpdate:modelValue":a[7]||(a[7]=o=>e.state.blendDataDialog=o)},{title:r(()=>[le]),footer:r(()=>[t("div",ue,[t(D,{total:e.state.dialogPagination.total,"current-page":e.state.dialogPagination.currentPage,"onUpdate:current-page":a[5]||(a[5]=o=>e.state.dialogPagination.currentPage=o),"page-size":e.state.dialogPagination.pageSize,"onUpdate:page-size":a[6]||(a[6]=o=>e.state.dialogPagination.pageSize=o),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])])]),default:r(()=>[t("div",ne,[t("div",ie,[t(b,{modelValue:e.state.dialogSearchParam.materialName,"onUpdate:modelValue":a[3]||(a[3]=o=>e.state.dialogSearchParam.materialName=o),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u540D\u79F0\u3001\u7B80\u79F0\u3001\u6216\u9662\u5185\u7801",clearable:""},null,8,["modelValue"]),t(b,{modelValue:e.state.dialogSearchParam.deliveryNo,"onUpdate:modelValue":a[4]||(a[4]=o=>e.state.dialogSearchParam.deliveryNo=o),placeholder:"\u8BF7\u8F93\u5165SAP\u4EA4\u8D27\u5355\u53F7",clearable:""},null,8,["modelValue"]),t(h,{type:"primary",class:"search",onClick:e.handleDialogSearch},{default:r(()=>[re]),_:1},8,["onClick"])]),t(s,{loading:e.state.dialogLoading,data:e.state.dialogTableData,height:600},{"table-columns":r(()=>[(v(!0),y(E,null,T(e.headersConfig,(o,d)=>(v(),y(u,{"show-overflow-tooltip":"",key:d,prop:o.prop,label:o.label,"min-width":e.calcHeaderWidth(o,d)},{header:r(p=>[t("span",null,C(p.column.label),1)]),default:r(p=>[t("span",null,C(p.row[o.prop]),1)]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data"])])]),_:1},8,["modelValue"])],64)}var me=z(x,[["render",se]]);export{me as default};
