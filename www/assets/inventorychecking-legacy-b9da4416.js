System.register(["../vendors/element-plus-legacy-e48d1ae3.js","./index-legacy.acc39ef9.js","./index-legacy-ede514ae.js","./index-legacy-4769daac.js","./failed-legacy-8aadbc20.js","./md5-legacy-47b02aeb.js"],(function(e){"use strict";var a,l,t,o,n,i,r,d,s,p,c,u,m,h,y,g,b,k,D,_,f,v,w,C,V,L,S,x,T,I,U,M,N;return{setters:[function(e){a=e.d,l=e.i,t=e.r,o=e.c,n=e.Y,i=e.S,r=e.O,d=e.E,s=e.m,p=e.q,c=e.y,u=e.G,m=e.C,h=e.z,y=e.F,g=e.A,b=e.t,k=e.x},function(e){D=e._,_=e.u,f=e.b,v=e.d},function(e){w=e._},function(e){C=e.V,V=e.r,L=e.a,S=e.b,x=e.c,T=e.d,I=e.e,U=e.f},function(e){M=e._,N=e.a},function(){}],execute:function(){const z=a({name:"inventorychecking",components:{"validate-acceptor-dialog":C},setup(){const e=_(),a=f(),d=v(),s=l("setTableHeaders"),p=l("openInventoryCheckPrintDialog"),c={FROM_WHERE:"/inventorycheck",checkListHeadersConfig:[{label:"序号",prop:"id"},{label:"院内码",prop:"hospital_code"},{label:"物料名称",prop:"name",width:120},{label:"物料批号",prop:"LotNumber"},{label:"库存量",prop:"inventory"},{label:"单位",prop:"unit"},{label:"盘点量(入库单位)",prop:"check_inventory_in",width:120},{label:"盘点量(出库单位)",prop:"check_inventory_out",width:120},{label:"备注",prop:"remark"},{label:"物料效期",prop:"validity",width:150},{label:"存放库位",prop:"store_position",width:150},{label:"品牌名称",prop:"brand"},{label:"克隆号",prop:"CloneNumber"}]},u=t({loading:!1,isDanger:!1,secondAcceptorList:[],acceptanceData:{acceptor1:o((()=>d.getters.username))},tableData:[],multipleSelection:[],warehouseOptions:[],headersConfig:[{label:"序号",prop:"id"},{label:"院内码",prop:"hospital_code"},{label:"库位",prop:"position1"},{label:"系统码",prop:"system_code"},{label:"物料名称",prop:"name"},{label:"物料简称",prop:"shortname"},{label:"物料批号",prop:"LotNumber"},{label:"品牌名称",prop:"brand"},{label:"组织名称",prop:"department"},{label:"操作员",prop:"Operator1Id"},{label:"库存量",prop:"inventory"},{label:"单位",prop:"unit"},{label:"物料规格",prop:"size"},{label:"物料类型",prop:"kind"},{label:"物料效期",prop:"validity"},{label:"克隆号",prop:"CloneNumber"},{label:"病种类型",prop:"DiseaseType"}],dialog:{checkListDialog:!1,checkDangerListDialog:!1},dialogTableData:{checkListTableData:[],checkDangerListTableData:[]},dialogValidateShow:!1,validateSuccess:!1,inventoryCheckId:"",brandIdMap:o((()=>d.getters.brandIdMap)),MinUnitTypeMap:o((()=>d.getters.MinUnitTypeMap)),MaterialTypeMap:o((()=>d.getters.MaterialTypeMap))}),m={calcHeaderWidth:l("calcHeaderMinWidth"),handleClickSetting(){s(u.headersConfig,(e=>{u.headersConfig=e}))},handleChangeMultiple(e){u.multipleSelection=e},handleGoBack(){e.push(c.FROM_WHERE)},handleClickDelete(){const e=u.multipleSelection.map((e=>e.id));u.tableData=u.tableData.filter((a=>e.indexOf(a.id)<0))},handleGenerateCheckList(){const e={StoreIdList:`[${u.tableData.map((e=>e.id)).join(",")}]`};V(e).then((e=>{if(u.inventoryCheckId=e.StockTakingId,u.isDanger){u.dialog.checkDangerListDialog=!0,u.dialogTableData.checkDangerListTableData=u.tableData.map((e=>{const{id:a,hospital_code:l,name:t,LotNumber:o,unit:n,inventory:i,validity:r,store_position:d,brand:s,CloneNumber:p}=e;return{id:a,hospital_code:l,name:t,LotNumber:o,unit:n,inventory:i,check_inventory_in:i,check_inventory_out:0,remark:"",last_check_inventory:"",validity:r,store_position:d,brand:s,CloneNumber:p}}));const e=u.tableData.map((e=>e.DepartmentId));L(e).then((e=>{u.secondAcceptorList=e.inspectors.map((e=>({label:e.UserDisplayName,value:e.UserName}))),0===u.secondAcceptorList.length&&(1===u.tableData.length?n({title:"提示",message:"暂时找不到可以作为此危险品的第二见证人，请联系部门管理员进行添加。",type:"warning",duration:0}):n({title:"提示",message:"暂时找不到可以同时作为这些危险品的第二见证人，请返回重新选择。",type:"warning",duration:0}))}))}else u.dialog.checkListDialog=!0,u.dialogTableData.checkListTableData=u.tableData.map((e=>{const{id:a,hospital_code:l,name:t,LotNumber:o,unit:n,inventory:i,validity:r,store_position:d,brand:s,CloneNumber:p}=e;return{id:a,hospital_code:l,name:t,LotNumber:o,unit:n,inventory:i,check_inventory_in:i,check_inventory_out:0,remark:"",last_check_inventory:"",validity:r,store_position:d,brand:s,CloneNumber:p}}))}))},handlePrint(){p(u.headersConfig,u.tableData,u.inventoryCheckId,"库存盘点单")},handleExportXLSX(e){const a=e?u.dialogTableData.checkDangerListTableData:u.dialogTableData.checkListTableData,l=c.checkListHeadersConfig;w.exportSingleSheet(l,a,"盘点清单详情","盘点清单")},handleCompleteInventoryCheck(){const a={ModifyStructs:(u.isDanger?u.dialogTableData.checkDangerListTableData:u.dialogTableData.checkListTableData).map((e=>{const{id:a,LotNumber:l,validity:t,unit:o,store_position:n,check_inventory_in:i}=e;return{StoreId:a,LotNumber:l,EndDate:t,Amount:Number(i),Unit:u.MinUnitTypeMap.get(o),GoodsShelf:n}}))};S(a).then((()=>{i.success("操作成功");const e={StockTakingId:u.inventoryCheckId};return x(e)})).finally((()=>{u.dialog.checkListDialog=!1,u.dialog.checkDangerListDialog=!1,e.push(c.FROM_WHERE)}))},handleAbandonInventoryCheck(){const a={StockTakingId:u.inventoryCheckId};T(a).then((()=>{i.success("操作成功"),u.dialog.checkListDialog=!1,u.dialog.checkDangerListDialog=!1,e.push(c.FROM_WHERE)}))},handleValidateSuccess(){u.validateSuccess=!0}};return r((()=>{const l=a.query.hospital_codes.split(",");if(u.isDanger="true"===a.query.danger,!l.length)return e.push(c.FROM_WHERE);I({SearchWord:"",DepartmentId:""}).then((e=>{u.warehouseOptions=e.goodsShelves.map((e=>{const{name:a}=e;return{value:a,label:a}}))})).then((()=>{u.loading=!0,Promise.all(l.map((e=>U({InStoreBeginDate:"",InStoreEndDate:"",SearchWord:e,NeedCheckHChemical:!1,isHazardousChemical:!0,DiseaseType:"",GoodsShelf:"",IsBelongToMe:!1,NeedPaging:!1,PageNo:1,RecordPerPage:1,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then((e=>e.StoreInfo))))).then((e=>{u.loading=!1;let a=[];for(let l=0;l<e.length;l++){const t=e[l];for(let e=0;e<t.length;e++)a.push(t[e])}(e=>{u.tableData=e.map((e=>{const{store:a,material:l}=e,{id:t,MaterialId:o,Operator1Id:n,amount:i,GoodsShelf:r,EndDate:d,CloneNumber:s,unit:p,DiseaseType:c,LotNumber:m,DepartmentOwner:h,DepartmentName:y}=a,{system_code:g,name:b,short_name:k,brand_id:D,material_type:_,spec:f}=l||{};return{id:t,hospital_code:o,system_code:g,name:b,Operator1Id:n,shortname:k,LotNumber:m,brand:u.brandIdMap[D],department:y,DepartmentId:h,inventory:i,price:"",amount:"",unit:u.MinUnitTypeMap.get(p),size:f,kind:u.MaterialTypeMap.get(_),validity:d.substring(0,10),store_position:r,CloneNumber:s,DiseaseType:c}}))})(a)}))}))})),{state:u,...m,...c}}}),E=m("生成盘点单"),H=m("返回选择"),O=c("div",{class:"title"},"盘点明细",-1),W={class:"body"},R={class:"table-area"},A={style:{"margin-left":"4px"}},G={style:{"margin-left":"4px"}},P={key:6},Y={class:"right-footer"},F=m("盘点完成"),j=m("盘点作废"),X=m("打印"),B=m("导出xlsx"),q=m("退出"),Q=c("div",{class:"title"},"盘点明细",-1),$={class:"body"},J=c("img",{class:"verified-img1",src:M,alt:"验证成功"},null,-1),K=m("双人双锁验证"),Z={key:0,class:"validate-message success"},ee=c("span",null,"双人双锁已验证",-1),ae=c("img",{src:M,alt:"验证成功"},null,-1),le={key:1,class:"validate-message error"},te=c("span",null,"双人双锁未验证",-1),oe=c("img",{src:N,alt:"验证失败"},null,-1),ne={class:"table-area"},ie={style:{"margin-left":"4px"}},re={style:{"margin-left":"4px"}},de={key:6},se={class:"right-footer"},pe={style:{color:"#FA5151","font-size":"14px"}},ce=m("盘点完成"),ue=m("盘点作废"),me=m("打印"),he=m("导出xlsx"),ye=m("退出");e("default",D(z,[["render",function(e,a,l,t,o,n){const i=d("el-button"),r=d("styled-search"),D=d("el-table-column"),_=d("styled-table"),f=d("el-input"),v=d("el-date-picker"),w=d("el-option"),C=d("el-select"),V=d("dialog-table"),L=d("el-dialog"),S=d("el-form-item"),x=d("el-form"),T=d("validate-acceptor-dialog");return s(),p(y,null,[c(r,{"hide-search-more":""},{"styled-search-right":u((()=>[c(i,{type:"primary",class:"search",disabled:0===e.state.tableData.length,onClick:e.handleGenerateCheckList},{default:u((()=>[E])),_:1},8,["disabled","onClick"]),c(i,{type:"danger",class:"delete",disabled:0===e.state.multipleSelection.length,onClick:e.handleClickDelete},{default:u((()=>[m("删除选择("+h(e.state.multipleSelection.length)+")",1)])),_:1},8,["disabled","onClick"]),c(i,{type:"primary",plain:"",onClick:e.handleGoBack},{default:u((()=>[H])),_:1},8,["onClick"])])),_:1}),c(_,{multiple:"",setting:"",loading:e.state.loading,data:e.state.tableData,onClickSetting:e.handleClickSetting,onChangeMultiple:e.handleChangeMultiple},{"table-columns":u((()=>[(s(!0),p(y,null,g(e.state.headersConfig,((a,l)=>(s(),p(D,{"show-overflow-tooltip":"",key:l,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,l)},{header:u((e=>[c("span",null,h(e.column.label),1)])),default:u((e=>[c("span",null,h(e.row[a.prop]),1)])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["loading","data","onClickSetting","onChangeMultiple"]),c(L,{"custom-class":"check-list-dialog",width:"1658px",modelValue:e.state.dialog.checkListDialog,"onUpdate:modelValue":a[3]||(a[3]=a=>e.state.dialog.checkListDialog=a)},{title:u((()=>[O])),footer:u((()=>[c("div",Y,[c(i,{type:"success",class:"export",onClick:e.handleCompleteInventoryCheck},{default:u((()=>[F])),_:1},8,["onClick"]),c(i,{type:"danger",class:"delete",onClick:e.handleAbandonInventoryCheck},{default:u((()=>[j])),_:1},8,["onClick"]),c(i,{type:"primary",class:"search",onClick:e.handlePrint},{default:u((()=>[X])),_:1},8,["onClick"]),c(i,{type:"success",class:"export",onClick:a[1]||(a[1]=a=>e.handleExportXLSX(!1))},{default:u((()=>[B])),_:1}),c(i,{type:"default",class:"exit",onClick:a[2]||(a[2]=a=>e.state.dialog.checkListDialog=!1)},{default:u((()=>[q])),_:1})])])),default:u((()=>[c("div",W,[c("div",R,[c(V,{data:e.state.dialogTableData.checkListTableData},{"table-columns":u((()=>[(s(!0),p(y,null,g(e.checkListHeadersConfig,((a,l)=>(s(),p(D,{"show-overflow-tooltip":"",key:l,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,l)},{header:u((e=>[c("span",null,h(e.column.label),1)])),default:u((l=>["LotNumber"===l.column.property?(s(),p(f,{key:0,size:"small",style:{width:"100%"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"check_inventory_in"===l.column.property?(s(),p(y,{key:1},[c(f,{size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"]),c("span",A,h(l.row.unit),1)],64)):"check_inventory_out"===l.column.property?(s(),p(y,{key:2},[c(f,{disabled:"",size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"]),c("span",G,h(l.row.unit),1)],64)):"remark"===l.column.property?(s(),p(f,{key:3,size:"small",style:{width:"100%"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"validity"===l.column.property?(s(),p(v,{key:4,size:"small",style:{width:"100%"},"value-format":"YYYY-MM-DD",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e,type:"date",placeholder:"请选择物料有效期"},null,8,["modelValue","onUpdate:modelValue"])):"store_position"===l.column.property?(s(),p(C,{key:5,size:"small",style:{width:"100%"},modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e,filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或者输入库位名称"},{default:u((()=>[(s(!0),p(y,null,g(e.state.warehouseOptions,(e=>(s(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(s(),p("span",P,h(l.row[a.prop]),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["data"])])])])),_:1},8,["modelValue"]),c(L,{"custom-class":"check-list-dialog",width:"1658px",modelValue:e.state.dialog.checkDangerListDialog,"onUpdate:modelValue":a[8]||(a[8]=a=>e.state.dialog.checkDangerListDialog=a)},{title:u((()=>[Q])),footer:u((()=>[c("div",se,[b(c("span",pe,"危化品结束盘点前，请先进行双人双锁验证",512),[[k,!e.state.validateSuccess]]),c(i,{type:"success",class:"export",disabled:!e.state.validateSuccess,onClick:e.handleCompleteInventoryCheck},{default:u((()=>[ce])),_:1},8,["disabled","onClick"]),c(i,{type:"danger",class:"delete",onClick:e.handleAbandonInventoryCheck},{default:u((()=>[ue])),_:1},8,["onClick"]),c(i,{type:"primary",class:"search",onClick:e.handlePrint},{default:u((()=>[me])),_:1},8,["onClick"]),c(i,{type:"success",class:"export",onClick:a[6]||(a[6]=a=>e.handleExportXLSX(!0))},{default:u((()=>[he])),_:1}),c(i,{type:"default",class:"exit",onClick:a[7]||(a[7]=a=>e.state.dialog.checkDangerListDialog=!1)},{default:u((()=>[ye])),_:1})])])),default:u((()=>[c("div",$,[c(x,{class:"danger-checking",inline:!0,model:e.state.acceptanceData,"label-position":"right"},{default:u((()=>[c(S,{label:"盘点人"},{default:u((()=>[c(f,{disabled:"",modelValue:e.state.acceptanceData.acceptor1,"onUpdate:modelValue":a[4]||(a[4]=a=>e.state.acceptanceData.acceptor1=a),placeholder:"请输入盘点人"},null,8,["modelValue"]),J])),_:1}),c(S,null,{default:u((()=>[c(i,{type:"primary",onClick:a[5]||(a[5]=a=>e.state.dialogValidateShow=!0)},{default:u((()=>[K])),_:1}),e.state.validateSuccess?(s(),p("span",Z,[ee,ae])):(s(),p("span",le,[te,oe]))])),_:1})])),_:1},8,["model"]),c("div",ne,[c(V,{data:e.state.dialogTableData.checkDangerListTableData},{"table-columns":u((()=>[(s(!0),p(y,null,g(e.checkListHeadersConfig,((a,l)=>(s(),p(D,{"show-overflow-tooltip":"",key:l,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,l)},{header:u((e=>[c("span",null,h(e.column.label),1)])),default:u((l=>["LotNumber"===l.column.property?(s(),p(f,{key:0,size:"small",style:{width:"100%"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"check_inventory_in"===l.column.property?(s(),p(y,{key:1},[c(f,{size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"]),c("span",ie,h(l.row.unit),1)],64)):"check_inventory_out"===l.column.property?(s(),p(y,{key:2},[c(f,{disabled:"",size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"]),c("span",re,h(l.row.unit),1)],64)):"remark"===l.column.property?(s(),p(f,{key:3,size:"small",style:{width:"100%"},type:"text",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"validity"===l.column.property?(s(),p(v,{key:4,size:"small",style:{width:"100%"},"value-format":"YYYY-MM-DD",modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e,type:"date",placeholder:"请选择物料有效期"},null,8,["modelValue","onUpdate:modelValue"])):"store_position"===l.column.property?(s(),p(C,{key:5,size:"small",style:{width:"100%"},modelValue:l.row[a.prop],"onUpdate:modelValue":e=>l.row[a.prop]=e,filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或者输入库位名称"},{default:u((()=>[(s(!0),p(y,null,g(e.state.warehouseOptions,(e=>(s(),p(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(s(),p("span",de,h(l.row[a.prop]),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["data"])])])])),_:1},8,["modelValue"]),c(T,{purpose:"FinishStockTaking",param:"StockTakingId","dialog-show":e.state.dialogValidateShow,"onUpdate:dialog-show":a[9]||(a[9]=a=>e.state.dialogValidateShow=a),acceptors:e.state.secondAcceptorList,ids:e.state.inventoryCheckId,onValidateSuccess:e.handleValidateSuccess},null,8,["dialog-show","acceptors","ids","onValidateSuccess"])],64)}]]))}}}));
