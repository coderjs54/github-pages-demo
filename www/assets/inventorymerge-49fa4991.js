var oe=Object.defineProperty,ue=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var Y=(e,t,h)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[t]=h,S=(e,t)=>{for(var h in t||(t={}))re.call(t,h)&&Y(e,h,t[h]);if($)for(var h of $(t))ie.call(t,h)&&Y(e,h,t[h]);return e},R=(e,t)=>ue(e,ne(t));import{d as se,i as L,a as de,r as pe,c as E,S as T,I as v,w as W,o as me,E as g,m as p,q as m,y as l,G as u,N as K,C as i,z as F,F as N,A as O}from"../vendors/element-plus-6f9977bb.js";import{r as I,U as P,_ as ge,b as he,d as fe}from"./index.1a2bb961.js";import{b as ce}from"./index-77742ce3.js";import{_ as G}from"./tip-1b2ff95a.js";function be(e){return I.post(P.INVENTORY.queryInventory,e)}function Ce(e){return I.post(P.INVENTORY.mergeDiffInventory,e)}function Fe(e){return I.post(P.INVENTORY.mergeInventory,e)}function Me(e){return I.post(P.INVENTORY.useOutInventory,e)}const ye=se({setup(){const e=he(),t=fe(),h=L("setTableHeaders"),B=()=>{o.loading=!0;const{pageSize:n,currentPage:d}=v(o.pagination),{searchWord:M,dateRange:c,diseaseType:y}=v(o.searchParam),{department:D,materialType:w,brand:b,instrument:_,warehouse:a}=v(o.searchMoreParam),[f,r]=c||["",""];be({InStoreBeginDate:f,InStoreEndDate:r,SearchWord:M,NeedCheckHChemical:!0,isHazardousChemical:!1,DiseaseType:y,DepartmentId:D,MaterialType:w,Brand:b,Instrument:_,GoodsShelf:a,IsBelongToMe:!0,NeedPaging:!0,PageNo:d,RecordPerPage:n,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!0,InStockTaking:!1}).then(U=>{o.pagination.total=U.TotalRecordCount,q(U.StoreInfo)}).finally(()=>{o.loading=!1})},q=n=>{o.tableData=n.map(d=>{const{material:M,store:c}=d,{id:y,MaterialId:D,Operator1Id:w,amount:b,GoodsShelf:_,EndDate:a,CloneNumber:f,unit:r,LotNumber:C,DiseaseType:U,ChangeReason:j,OperateTime:Q,DepartmentName:J,MaterialName:X,IsMixMaterial:H}=c,{system_code:Z,name:x,short_name:ee,brand_id:ae,material_type:te,spec:le}=M||{};return{mixMaterial:H?"\u662F":"\u5426",id:y,hospital_code:D,system_code:Z,name:H?X:x,Operator1Id:w,ChangeReason:j,shortname:ee,LotNumber:C,brandName:o.brandIdMap[ae],department:J,inventory:b,price:"",amount:"",unit:o.MinUnitTypeMap.get(r),size:le,kind:o.MaterialTypeMap.get(te),validity:a.substring(0,10),position1:_,CloneNumber:f||"\u65E0",DiseaseType:U,OperateTime:Q.replace("T"," ")}})},z={labelWidth:"110px",changeReasons:{\u4E09\u7EA7\u51FA\u5E93:"level-three-out",\u9886\u7528:"request-for-use",\u7528\u5269\u5F52\u8FD8:"return-back"},newMaterialFormRules:{materialName:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u7269\u6599\u540D\u79F0",trigger:"blur"}],materialAmount:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u7269\u6599\u6570\u91CF",trigger:"blur"},{validator:ce,trigger:"blur"}],materialUnit:[{required:!0,message:"\u8BF7\u9009\u62E9\u65B0\u7269\u6599\u5355\u4F4D",trigger:"blur"}]},headersConfigMerge:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u7269\u6599\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u6570\u91CF",prop:"amount",width:90},{label:"\u5355\u4F4D",prop:"unit",width:120},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:160},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u4E70A\u6362B",prop:"buy_a_to_b",hidden:!t.getters.buyAToB},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}]},k={newMaterialFormRef:de(null)},o=pe({loading:!1,MinUnitTypeMap:E(()=>t.getters.MinUnitTypeMap),MinUnitTypeOptions:E(()=>t.getters.MinUnitTypeOptions),MaterialTypeMap:E(()=>t.getters.MaterialTypeMap),brandIdMap:E(()=>t.getters.brandIdMap),searchParam:{searchWord:"",dateRange:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u7269\u6599\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u5408\u6210\u7269\u6599",prop:"mixMaterial"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u5408\u5E76\u4EBA",prop:"Operator1Id"},{label:"\u64CD\u4F5C\u65F6\u95F4",prop:"OperateTime"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u5E93\u5B58\u53D8\u52A8\u539F\u56E0",prop:"ChangeReason"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:160},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u4E70A\u6362B",prop:"buy_a_to_b",hidden:!t.getters.buyAToB},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],multipleSelection:[],PDFHandling:!1,dialogMergeSame:!1,dialogMergeDiff:!1,dialogUseOut:!1,tableDateMergeDiff:[],dialogNewMaterial:!1,newMaterialForm:{hospitalCode:"",materialName:"",materialAmount:"",materialUnit:""},useOutData:{id:"",name:""}}),s=n=>{n&&(o.pagination.currentPage=1),B()},A=E(()=>o.headersConfig.filter(n=>!n.hidden)),V={calcHeaderWidth:L("calcHeaderMinWidth"),handleClickSetting(){h(o.headersConfig,n=>{o.headersConfig=n})},handlePaginationChange(){s(!1)},handleSearch(){s(!0)},handleSearchMoreParamChange(n){o.searchMoreParam=n,s(!0)},handleChangeMultiple(n){o.multipleSelection=n},handleMergeSame(){o.dialogMergeSame=!0},handleMergeDiff(){o.dialogMergeDiff=!0,o.tableDateMergeDiff=o.multipleSelection.map(n=>R(S({},n),{unit:o.MinUnitTypeMap.get(n.unit),amount:0}))},handleClickMerge(){if(o.tableDateMergeDiff.some(d=>isNaN(d.amount)||Number(d.amount)>Number(d.inventory)||Number(d.amount)===0))return T.error("\u8BF7\u8F93\u5165\u5408\u6CD5\u7684\u6570\u91CF");o.dialogNewMaterial=!0},handleConfirmMerge(){k.newMaterialFormRef.value.validate(n=>{if(!n)return;const{hospitalCode:d,materialName:M,materialAmount:c,materialUnit:y}=v(o.newMaterialForm),D={FromMaterial:o.tableDateMergeDiff.map(w=>{const{id:b,amount:_,unit:a}=w;return{StoreId:b,amount:Number(_),unit:a}}),ToMaterial:{HospitalCode:d,MaterialName:M,amount:Number(c),unit:y}};Ce(D).then(()=>{T.success("\u64CD\u4F5C\u6210\u529F"),B()}).finally(()=>{o.dialogNewMaterial=!1,o.dialogMergeDiff=!1})})},handleConfirmMergeSame(){const n={StoreIds:o.multipleSelection.map(d=>d.id)};Fe(n).then(()=>{T.success("\u64CD\u4F5C\u6210\u529F"),B()}).finally(()=>{o.dialogMergeSame=!1})},handleUseOut(n){const{id:d,name:M}=v(n);o.useOutData={id:d,name:M},o.dialogUseOut=!0},handleConfirmUseOut(){console.log(o.useOutData);const n={StoreId:o.useOutData.id};Me(n).then(()=>{T.success("\u64CD\u4F5C\u6210\u529F"),B()}).finally(()=>{o.dialogUseOut=!1})}};return W(()=>t.getters.settings,()=>{o.headersConfig=t.getters.settings[e.name]||o.headersConfig}),W(()=>o.dialogNewMaterial,n=>{n||(o.newMaterialForm={hospitalCode:"",materialName:"",materialAmount:"",materialUnit:""})}),W(()=>o.dialogUseOut,n=>{n||(o.useOutData={id:"",name:""})}),me(()=>{B()}),R(S(S(S({state:o},V),z),k),{headersShown:A})}}),De={class:"date-box"},we=i("\u67E5\u8BE2"),_e={key:2},Be=i("\u7528\u5B8C"),Se=l("div",{class:"title"},"\u63D0\u793A",-1),Ee={class:"tip-body"},ve=l("img",{src:G,alt:""},null,-1),Ne=i("\u786E\u8BA4\u8981\u5C06\u9009\u4E2D\u7684"),ke={class:"item-name"},Ve=l("span",{class:"highlight-text"},"\u540C\u79CD",-1),Ue=i("\u7269\u6599\u8FDB\u884C\u5408\u5E76\u5417?"),Te={class:"right-footer"},Oe=i("\u53D6\u6D88"),Ie=i("\u786E\u5B9A"),Pe=l("div",{class:"title"},"\u9009\u62E9\u9A8C\u6536\u5355",-1),Ae={class:"body"},Re={key:2},We={class:"right-footer"},qe=i("\u5F00\u59CB\u5408\u5E76"),ze=i("\u53D6\u6D88\u5408\u5E76"),He=l("div",{class:"title"},"\u65B0\u7269\u6599\u4FE1\u606F",-1),$e={class:"center-footer"},Ye=i("\u53D6\u6D88"),Le=i("\u786E\u8BA4"),Ke=l("div",{class:"title"},"\u63D0\u793A",-1),Ge={class:"tip-body"},je=l("img",{src:G,alt:""},null,-1),Qe=i("\u786E\u8BA4\u8981\u5C06\u8BE5\u540D\u79F0\u4E3A"),Je={class:"item-name"},Xe=i("\u7684\u7269\u6599"),Ze=l("span",{class:"highlight-text"},"\u5220\u9664",-1),xe=i("\u5417?"),ea={class:"right-footer"},aa=i("\u53D6\u6D88"),ta=i("\u786E\u5B9A");function la(e,t,h,B,q,z){const k=g("el-date-picker"),o=g("el-input"),s=g("el-button"),A=g("styled-search"),V=g("el-tag"),n=g("el-table-column"),d=g("styled-table"),M=g("styled-pagination"),c=g("el-dialog"),y=g("el-option"),D=g("el-select"),w=g("dialog-table"),b=g("el-form-item"),_=g("el-form");return p(),m(N,null,[l(A,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":u(()=>[l("div",De,[l(k,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=a=>e.state.searchParam.dateRange=a),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),l(o,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[2]||(t[2]=a=>e.state.searchParam.searchWord=a),placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57",clearable:"",onKeydown:K(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(o,{modelValue:e.state.searchParam.diseaseType,"onUpdate:modelValue":t[3]||(t[3]=a=>e.state.searchParam.diseaseType=a),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u75C5\u79CD\u4FE1\u606F",clearable:"",onKeydown:K(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),l(s,{type:"primary",class:"search",onClick:e.handleSearch},{default:u(()=>[we]),_:1},8,["onClick"])]),"styled-search-right":u(()=>[l(s,{type:"success",class:"export",disabled:e.state.multipleSelection.length<2,onClick:e.handleMergeSame},{default:u(()=>[i("\u5408\u5E76\u540C\u79CD\u7269\u6599("+F(e.state.multipleSelection.length)+")",1)]),_:1},8,["disabled","onClick"]),l(s,{type:"success",class:"export",disabled:e.state.multipleSelection.length<2,onClick:e.handleMergeDiff},{default:u(()=>[i("\u5408\u5E76\u4E0D\u540C\u7269\u6599("+F(e.state.multipleSelection.length)+")",1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),l(d,{loading:e.state.loading,data:e.state.tableData,onClickSetting:e.handleClickSetting,onChangeMultiple:e.handleChangeMultiple,setting:"",multiple:""},{"table-columns":u(()=>[(p(!0),m(N,null,O(e.headersShown,(a,f)=>(p(),m(n,{"show-overflow-tooltip":"",key:f,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,f)},{header:u(r=>[l("span",null,F(r.column.label),1)]),default:u(r=>[r.column.property==="ChangeReason"?(p(),m(V,{key:0,class:e.changeReasons[r.row[a.prop]]},{default:u(()=>[i(F(r.row[a.prop]),1)]),_:2},1032,["class"])):r.column.property==="mixMaterial"?(p(),m(V,{key:1,class:r.row.mixMaterial==="\u662F"?"danger-material":"normal-material"},{default:u(()=>[i(F(r.row.mixMaterial),1)]),_:2},1032,["class"])):(p(),m("span",_e,F(r.row[a.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128)),l(n,{label:"\u64CD\u4F5C",fixed:"right",width:"55"},{default:u(a=>[l(s,{type:"text",class:"delete",onClick:f=>e.handleUseOut(a.row)},{default:u(()=>[Be]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["loading","data","onClickSetting","onChangeMultiple"]),l(M,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[4]||(t[4]=a=>e.state.pagination.currentPage=a),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[5]||(t[5]=a=>e.state.pagination.pageSize=a),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"]),l(c,{width:"466px",modelValue:e.state.dialogMergeSame,"onUpdate:modelValue":t[7]||(t[7]=a=>e.state.dialogMergeSame=a)},{title:u(()=>[Se]),footer:u(()=>[l("div",Te,[l(s,{onClick:t[6]||(t[6]=a=>e.state.dialogMergeSame=!1),class:"cancel"},{default:u(()=>[Oe]),_:1}),l(s,{type:"primary",onClick:e.handleConfirmMergeSame,class:"confirm"},{default:u(()=>[Ie]),_:1},8,["onClick"])])]),default:u(()=>[l("div",Ee,[ve,l("span",null,[Ne,l("span",ke,F(e.state.multipleSelection.length)+"\u4EFD",1),Ve,Ue])])]),_:1},8,["modelValue"]),l(c,{"custom-class":"merge-diff-inventory",width:"95%",modelValue:e.state.dialogMergeDiff,"onUpdate:modelValue":t[9]||(t[9]=a=>e.state.dialogMergeDiff=a)},{title:u(()=>[Pe]),footer:u(()=>[l("div",We,[l(s,{type:"success",class:"export",onClick:e.handleClickMerge},{default:u(()=>[qe]),_:1},8,["onClick"]),l(s,{type:"default",class:"exit",onClick:t[8]||(t[8]=a=>e.state.dialogMergeDiff=!1)},{default:u(()=>[ze]),_:1})])]),default:u(()=>[l("div",Ae,[l(w,{data:e.state.tableDateMergeDiff},{"table-columns":u(()=>[(p(!0),m(N,null,O(e.headersConfigMerge,(a,f)=>(p(),m(n,{"show-overflow-tooltip":"",key:f,prop:a.prop,label:a.label,"min-width":e.calcHeaderWidth(a,f)},{header:u(r=>[l("span",null,F(r.column.label),1)]),default:u(r=>[r.column.property==="amount"?(p(),m(o,{key:0,type:"text",placeholder:"\u8BF7\u8F93\u5165\u6570\u91CF",modelValue:r.row[a.prop],"onUpdate:modelValue":C=>r.row[a.prop]=C},null,8,["modelValue","onUpdate:modelValue"])):r.column.property==="unit"?(p(),m(D,{key:1,modelValue:r.row[a.prop],"onUpdate:modelValue":C=>r.row[a.prop]=C,placeholder:"\u8BF7\u9009\u62E9\u5355\u4F4D"},{default:u(()=>[(p(!0),m(N,null,O(e.state.MinUnitTypeOptions,C=>(p(),m(y,{label:C.label,value:C.value,key:C.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),m("span",Re,F(r.row[a.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"])])]),_:1},8,["modelValue"]),l(c,{width:"516px",modelValue:e.state.dialogNewMaterial,"onUpdate:modelValue":t[15]||(t[15]=a=>e.state.dialogNewMaterial=a)},{title:u(()=>[He]),footer:u(()=>[l("div",$e,[l(s,{class:"cancel",onClick:t[14]||(t[14]=a=>e.state.dialogNewMaterial=!1)},{default:u(()=>[Ye]),_:1}),l(s,{type:"primary",class:"confirm",onClick:e.handleConfirmMerge},{default:u(()=>[Le]),_:1},8,["onClick"])])]),default:u(()=>[l(_,{model:e.state.newMaterialForm,rules:e.newMaterialFormRules,ref:"newMaterialFormRef"},{default:u(()=>[l(b,{label:"\u65B0\u7269\u6599\u9662\u5185\u7801","label-width":e.labelWidth},{default:u(()=>[l(o,{modelValue:e.state.newMaterialForm.hospitalCode,"onUpdate:modelValue":t[10]||(t[10]=a=>e.state.newMaterialForm.hospitalCode=a),placeholder:"\u8BF7\u8F93\u5165\u65B0\u7269\u6599\u9662\u5185\u7801",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(b,{label:"\u65B0\u7269\u6599\u540D\u79F0","label-width":e.labelWidth,prop:"materialName"},{default:u(()=>[l(o,{modelValue:e.state.newMaterialForm.materialName,"onUpdate:modelValue":t[11]||(t[11]=a=>e.state.newMaterialForm.materialName=a),placeholder:"\u8BF7\u8F93\u5165\u65B0\u7269\u6599\u540D\u79F0",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(b,{label:"\u65B0\u7269\u6599\u6570\u91CF","label-width":e.labelWidth,prop:"materialAmount"},{default:u(()=>[l(o,{modelValue:e.state.newMaterialForm.materialAmount,"onUpdate:modelValue":t[12]||(t[12]=a=>e.state.newMaterialForm.materialAmount=a),placeholder:"\u8BF7\u8F93\u5165\u65B0\u7269\u6599\u6570\u91CF",autocomplete:"off",clearable:""},null,8,["modelValue"])]),_:1},8,["label-width"]),l(b,{label:"\u65B0\u7269\u6599\u5355\u4F4D","label-width":e.labelWidth,prop:"materialUnit"},{default:u(()=>[l(D,{modelValue:e.state.newMaterialForm.materialUnit,"onUpdate:modelValue":t[13]||(t[13]=a=>e.state.newMaterialForm.materialUnit=a),placeholder:"\u8BF7\u9009\u62E9\u65B0\u7269\u6599\u5355\u4F4D"},{default:u(()=>[(p(!0),m(N,null,O(e.state.MinUnitTypeOptions,a=>(p(),m(y,{label:a.label,value:a.value,key:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(c,{width:"466px",modelValue:e.state.dialogUseOut,"onUpdate:modelValue":t[17]||(t[17]=a=>e.state.dialogUseOut=a)},{title:u(()=>[Ke]),footer:u(()=>[l("div",ea,[l(s,{onClick:t[16]||(t[16]=a=>e.state.dialogUseOut=!1),class:"cancel"},{default:u(()=>[aa]),_:1}),l(s,{type:"primary",onClick:e.handleConfirmUseOut,class:"confirm"},{default:u(()=>[ta]),_:1},8,["onClick"])])]),default:u(()=>[l("div",Ge,[je,l("span",null,[Qe,l("span",Je,F(e.state.useOutData.name),1),Xe,Ze,xe])])]),_:1},8,["modelValue"])],64)}var sa=ge(ye,[["render",la]]);export{sa as default};
