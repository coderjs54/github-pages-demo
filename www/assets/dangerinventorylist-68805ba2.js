var x=Object.defineProperty,ee=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var U=(e,t,r)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_=(e,t)=>{for(var r in t||(t={}))te.call(t,r)&&U(e,r,t[r]);if(L)for(var r of L(t))ne.call(t,r)&&U(e,r,t[r]);return e},z=(e,t)=>ee(e,ae(t));import{d as oe,i as F,r as re,c as D,I as f,Y as ue,w as le,o as se,E as i,m as c,q as g,y as u,G as s,N as A,F as W,A as ie,z as v,C as E}from"../vendors/element-plus-6f9977bb.js";import{r as de,U as pe,_ as ce,d as ge,b as he,u as me}from"./index.1a2bb961.js";function Ce(e){return de.post(pe.INVENTORY.queryInventory,e)}const be=oe({setup(){const e=ge(),t=he(),r=me(),R=F("exportXLSX"),V=F("exportPDF"),H=F("setTableHeaders"),h=()=>{a.loading=!0;const{pageSize:n,currentPage:o}=f(a.pagination),{searchWord:p,dateRange:l,diseaseType:M}=f(a.searchParam),{department:T,materialType:k,brand:w,instrument:C,warehouse:I}=f(a.searchMoreParam),[N,b]=l||["",""];Ce({InStoreBeginDate:N,InStoreEndDate:b,SearchWord:p,NeedCheckHChemical:!0,isHazardousChemical:!0,DiseaseType:M,DepartmentId:T,MaterialType:k,Brand:w,Instrument:C,GoodsShelf:I,IsBelongToMe:!1,NeedPaging:!0,PageNo:o,RecordPerPage:n,OrderBy:"GoodsShelf",NeedQueryInStockTaking:!1,InStockTaking:!1}).then(y=>{a.pagination.total=y.TotalRecordCount,m(y.StoreInfo)}).finally(()=>{a.loading=!1})},m=n=>{a.tableData=n.map(o=>{const{material:p,store:l}=o,{id:M,MaterialId:T,Operator1Id:k,amount:w,unit:C,GoodsShelf:I,EndDate:N,CloneNumber:b,DiseaseType:O,LotNumber:y,ChangeReason:X,DeliverOrderId:Y,OperateTime:q,DepartmentName:G}=l,{system_code:K,name:$,short_name:j,brand_id:J,material_type:Q,spec:Z}=p||{};return{id:M,hospital_code:T,system_code:K,name:$,Operator1Id:k,ChangeReason:X,shortname:j,LotNumber:y,brandName:a.brandIdMap[J],department:G,inventory:w,price:"",amount:"",standard:Z,unit:C,unitName:a.MinUnitTypeMap.get(C),kind:a.MaterialTypeMap.get(Q),validity:N.substring(0,10),position1:I,CloneNumber:b||"\u65E0",DiseaseType:O,DeliverOrderId:Y,OperateTime:q.replace("T"," ")}})},d=n=>{n&&(a.pagination.currentPage=1),h()},S={changeReasons:{\u4E09\u7EA7\u51FA\u5E93:"level-three-out",\u9886\u7528:"request-for-use",\u7528\u5269\u5F52\u8FD8:"return-back"}},a=re({loading:!1,searchParam:{searchWord:"",dateRange:"",diseaseType:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u7269\u6599\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u89C4\u683C",prop:"standard"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u4EA4\u8D27\u5355ID",prop:"DeliverOrderId"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u64CD\u4F5C\u5458",prop:"Operator1Id"},{label:"\u64CD\u4F5C\u65F6\u95F4",prop:"OperateTime"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unitName"},{label:"\u5E93\u5B58\u53D8\u52A8\u539F\u56E0",prop:"ChangeReason"},{label:"\u6279\u6B21\u5355\u4EF7",prop:"price"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u7269\u6599\u6548\u671F",prop:"validity"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],multipleSelection:[],PDFHandling:!1,brandIdMap:D(()=>e.getters.brandIdMap),MaterialTypeMap:D(()=>e.getters.MaterialTypeMap),MinUnitTypeMap:D(()=>e.getters.MinUnitTypeMap)}),B=D(()=>a.headersConfig.filter(n=>!n.hidden)),P={calcHeaderWidth:F("calcHeaderMinWidth"),handleClickSetting(){H(a.headersConfig,n=>{a.headersConfig=n})},handlePaginationChange(){d(!1)},handleSearch(){d(!0)},handleSearchMoreParamChange(n){a.searchMoreParam=n,d(!0)},handleChangeMultiple(n){a.multipleSelection=n},handleModify(n){console.log(n)},handleExportXLSX(){R(a.headersConfig,a.tableData,"\u5E93\u5B58\u8BB0\u5F55","\u5E93\u5B58\u8BB0\u5F55\u8BE6\u60C5")},handleExportPDF(){a.PDFHandling=!0,V(a.headersConfig,a.tableData,"\u6D4B\u8BD5\u6587\u4EF6").finally(()=>{a.PDFHandling=!1})},handleGoToOutWarehouse(){const n=f(a.multipleSelection);if(n.length!==1)return ue({title:"\u63D0\u793A",message:"\u7531\u4E8E\u7B2C\u4E09\u65B9\u7CFB\u7EDF\u7684\u9650\u5236\uFF0C\u672C\u7CFB\u7EDF\u53EA\u80FD\u4E00\u6B21\u9886\u7528\u4E00\u79CD\u5371\u9669\u54C1\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9\u3002",type:"warning"});!n.length||r.push({name:"dangeroutwarehousing",params:{chosenTableData:JSON.stringify(n)}})}};return le(()=>e.getters.settings,()=>{a.headersConfig=e.getters.settings[t.name]||a.headersConfig}),se(()=>{h()}),z(_(_({state:a},P),S),{headersShown:B})}}),ye={class:"date-box"},Fe=E("\u67E5\u8BE2"),De=E("\u5BFC\u51FAxlsx"),fe=E("\u5BFC\u51FApdf"),Ee={key:1};function Se(e,t,r,R,V,H){const h=i("el-date-picker"),m=i("el-input"),d=i("el-button"),S=i("styled-search"),a=i("el-tag"),B=i("el-table-column"),P=i("styled-table"),n=i("styled-pagination");return c(),g(W,null,[u(S,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":s(()=>[u("div",ye,[u(h,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=o=>e.state.searchParam.dateRange=o),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),u(m,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[2]||(t[2]=o=>e.state.searchParam.searchWord=o),placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57",clearable:"",onKeydown:A(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),u(m,{modelValue:e.state.searchParam.diseaseType,"onUpdate:modelValue":t[3]||(t[3]=o=>e.state.searchParam.diseaseType=o),placeholder:"\u8BF7\u8F93\u5165\u7269\u6599\u75C5\u79CD\u4FE1\u606F",clearable:"",onKeydown:A(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),u(d,{type:"primary",class:"search",onClick:e.handleSearch},{default:s(()=>[Fe]),_:1},8,["onClick"])]),"styled-search-right":s(()=>[u(d,{type:"success",class:"export",disabled:e.state.tableData.length===0,onClick:e.handleExportXLSX},{default:s(()=>[De]),_:1},8,["disabled","onClick"]),u(d,{type:"success",class:"export",loading:e.state.PDFHandling,disabled:e.state.tableData.length===0,onClick:e.handleExportPDF},{default:s(()=>[fe]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),u(P,{loading:e.state.loading,setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":s(()=>[(c(!0),g(W,null,ie(e.headersShown,(o,p)=>(c(),g(B,{"show-overflow-tooltip":"",key:p,prop:o.prop,label:o.label,"min-width":e.calcHeaderWidth(o,p)},{header:s(l=>[u("span",null,v(l.column.label),1)]),default:s(l=>[l.column.property==="ChangeReason"?(c(),g(a,{key:0,class:e.changeReasons[l.row[o.prop]]},{default:s(()=>[E(v(l.row[o.prop]),1)]),_:2},1032,["class"])):(c(),g("span",Ee,v(l.row[o.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onClickSetting"]),u(n,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[4]||(t[4]=o=>e.state.pagination.currentPage=o),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[5]||(t[5]=o=>e.state.pagination.pageSize=o),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var Te=ce(be,[["render",Se]]);export{Te as default};
