System.register(["./index-legacy.acc39ef9.js","../vendors/element-plus-legacy-e48d1ae3.js","./index-legacy-8aafeb95.js","./tip-legacy-d18ff986.js"],(function(e){"use strict";var l,a,t,o,r,p,c,n,d,s,i,m,u,h,b,y,f,g,T,D,_,V,w,S,k;return{setters:[function(e){l=e.r,a=e.U,t=e._,o=e.u,r=e.d,p=e.b},function(e){c=e.d,n=e.i,d=e.a,s=e.r,i=e.I,m=e.S,u=e.w,h=e.O,b=e.E,y=e.m,f=e.q,g=e.y,T=e.G,D=e.z,_=e.F,V=e.A,w=e.C},function(e){S=e.a},function(e){k=e._}],execute:function(){const C=c({setup(){const e=o(),t=r(),c=p(),b=n("setTableHeaders"),y={labelWidth:"80px",batchSetTempFormRules:{temp:[{required:!0,message:"请输入验收温度",trigger:"blur"},{validator:S,trigger:"blur"}]}},f={batchSetTempFormRef:d(null)},g=s({searchParam:{invoiceTogether:!0},totalMoney:0,tableData:[],headersConfig:[{label:"交货单ID",prop:"SOID"},{label:"交货单号",prop:"SONO"},{label:"物料名称",prop:"material_name"},{label:"物料简称",prop:"shortname"},{label:"物料规格",prop:"standard"},{label:"品牌",prop:"brandName"},{label:"交货日期",prop:"SODATE"},{label:"采购单号",prop:"PONO"},{label:"买A换B",prop:"delivery_remarks",hidden:!t.getters.buyAToB},{label:"克隆号",prop:"clone_number"},{label:"采购单明细号",prop:"PODETNO"},{label:"院内码",prop:"DITEMCODE"},{label:"单位",prop:"DPACKUNIT"},{label:"应到数量",prop:"due_number"},{label:"到货数量",prop:"DQTY"},{label:"存放库位",prop:"store_position",width:150},{label:"温度",prop:"accept_temperature",width:80},{label:"含税单价",prop:"DTAXPRC"},{label:"验收单价",prop:"accept_price"},{label:"含税金额",prop:"TAXAMT"},{label:"批号",prop:"LOTNO",width:150},{label:"效期",prop:"ENDDATE",width:160},{label:"税率",prop:"TAXRATE"}],acceptDialog:!1,accepting:!1,warehouseOptions:[],batchSetTempDialog:!1,batchSetTempForm:{temp:""}}),T={calcHeaderWidth:n("calcHeaderMinWidth"),handleClickSetting(){b(g.headersConfig,(e=>{g.headersConfig=e}))},handleBatchSetTemp(){g.batchSetTempDialog=!0},confirmBatchSetTemp(){f.batchSetTempFormRef.value.validate((e=>{if(!e)return;const{temp:l}=i(g.batchSetTempForm);g.tableData=g.tableData.map((e=>({...e,accept_temperature:Number(l)}))),g.batchSetTempDialog=!1}))},handleAccept(){g.acceptDialog=!0},handleGoBack(){e.go(-1)},confirmAccept(){g.accepting=!0;let t=!0;const o={AcceptDeliverOrders:g.tableData.map((e=>{const{SOID:l,store_position:a,DQTY:o,due_number:r,accept_price:p,DTAXPRC:c,delivery_remarks:n,LOTNO:d,accept_temperature:s,ENDDATE:i,clone_number:m}=e;(isNaN(Number(o))||Number(o)>Number(r))&&(t=!1),""===s&&(t=!1);const u=Number(s);return(isNaN(u)||u>=50||u<=-50)&&(t=!1),{SOID:l,GoodsShelf:a,NeedChangePrice:Number(p)!==c,Price:Number(p),BuyAToB:n,CloneNumber:m,LotNo:d,EndDate:i,ActualTemperature:u}}))};t?function(e){return l.post(a.ACCEPTANCE.batchAcceptDelivery,e)}(o).then((l=>{m.success("操作成功"),e.push("/orderacceptance")})).finally((()=>{g.accepting=!1,g.acceptDialog=!1})):(m.error("请确保填写正确的温度以及到货数量"),g.accepting=!1,g.acceptDialog=!1)}};return u((()=>t.getters.settings),(()=>{g.headersConfig=t.getters.settings[c.name]||g.headersConfig})),u((()=>g.batchSetTempDialog),(e=>{e||(g.batchSetTempForm={temp:""})})),h((()=>{var t;Promise.all([(t={SearchWord:"",DepartmentId:""},l.post(a.WAREHOUSE.queryWarehouse,t)).then((e=>{g.warehouseOptions=e.goodsShelves.map((e=>{const{name:l}=e;return{value:l,label:l}}))}))]).then((()=>{let l=c.params.chosenTableData;return l?(l=JSON.parse(l),l.length?(g.tableData=l.map((e=>({...e,accept_price:e.DTAXPRC,store_position:e.store_pos,delivery_remarks:"",accept_temperature:"",clone_number:"",due_number:e.DQTY}))),void(g.totalMoney=g.tableData.reduce(((e,l)=>e+=Number(l.accept_price)),0))):e.push("/orderacceptance")):e.push("/orderacceptance")}))})),{state:g,...y,...f,...T}}}),v={class:"total-money"},N=w("本次验收后总金额："),A={class:"money"},O=w("是否货票同行"),U=w("批量设置温度"),E=w("确定验收"),x=w("返回选择"),P=g("span",{style:{"margin-left":"4px"}},"元",-1),F={key:8},B=g("div",{class:"title"},"提示",-1),R={class:"tip-body"},z=g("img",{src:k,alt:""},null,-1),I=w("确认要对选中的"),M={class:"item-name"},W=w("个交货单进行验收吗?"),Y={class:"right-footer"},H=w("取消"),X=w("确定"),j=g("div",{class:"title"},"批量设置温度",-1),G={class:"center-footer"},L=w("取消"),Q=w("确认");e("default",t(C,[["render",function(e,l,a,t,o,r){const p=b("el-checkbox"),c=b("el-button"),n=b("styled-search"),d=b("el-input"),s=b("el-option"),i=b("el-select"),m=b("el-date-picker"),u=b("el-table-column"),h=b("styled-table"),w=b("el-dialog"),S=b("el-form-item"),k=b("el-form");return y(),f(_,null,[g(n,{"hide-search-more":""},{"styled-search-left":T((()=>[g("span",v,[N,g("span",A,"￥"+D(e.state.totalMoney),1)])])),"styled-search-right":T((()=>[g(p,{modelValue:e.state.searchParam.invoiceTogether,"onUpdate:modelValue":l[1]||(l[1]=l=>e.state.searchParam.invoiceTogether=l)},{default:T((()=>[O])),_:1},8,["modelValue"]),g(c,{type:"primary",class:"search",onClick:e.handleBatchSetTemp},{default:T((()=>[U])),_:1},8,["onClick"]),g(c,{type:"primary",class:"search",onClick:e.handleAccept},{default:T((()=>[E])),_:1},8,["onClick"]),g(c,{type:"primary",plain:"",onClick:e.handleGoBack},{default:T((()=>[x])),_:1},8,["onClick"])])),_:1}),g(h,{setting:"",data:e.state.tableData,onClickSetting:e.handleClickSetting},{"table-columns":T((()=>[(y(!0),f(_,null,V(e.state.headersConfig,((l,a)=>(y(),f(u,{"show-overflow-tooltip":"",key:a,prop:l.prop,label:l.label,"min-width":e.calcHeaderWidth(l,a)},{header:T((e=>[g("span",null,D(e.column.label),1)])),default:T((a=>["accept_price"===a.column.property?(y(),f(_,{key:0},[g(d,{size:"small",style:{width:"calc(100% - 25px)"},type:"text",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e},null,8,["modelValue","onUpdate:modelValue"]),P],64)):"store_position"===a.column.property?(y(),f(i,{key:1,size:"small",style:{width:"100%"},modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e,filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或者输入库位名称"},{default:T((()=>[(y(!0),f(_,null,V(e.state.warehouseOptions,(e=>(y(),f(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):"clone_number"===a.column.property?(y(),f(d,{key:2,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"delivery_remarks"===a.column.property?(y(),f(d,{key:3,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"LOTNO"===a.column.property?(y(),f(d,{key:4,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"DQTY"===a.column.property?(y(),f(d,{key:5,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):"ENDDATE"===a.column.property?(y(),f(m,{key:6,size:"small",style:{width:"100%"},"value-format":"YYYY-MM-DD",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e,type:"date",placeholder:"请选择物料有效期"},null,8,["modelValue","onUpdate:modelValue"])):"accept_temperature"===a.column.property?(y(),f(d,{key:7,size:"small",style:{width:"100%"},type:"text",modelValue:a.row[l.prop],"onUpdate:modelValue":e=>a.row[l.prop]=e},null,8,["modelValue","onUpdate:modelValue"])):(y(),f("span",F,D(a.row[l.prop]),1))])),_:2},1032,["prop","label","min-width"])))),128))])),_:1},8,["data","onClickSetting"]),g(w,{width:"466px",modelValue:e.state.acceptDialog,"onUpdate:modelValue":l[3]||(l[3]=l=>e.state.acceptDialog=l)},{title:T((()=>[B])),footer:T((()=>[g("div",Y,[g(c,{onClick:l[2]||(l[2]=l=>e.state.acceptDialog=!1),class:"cancel"},{default:T((()=>[H])),_:1}),g(c,{type:"primary",loading:e.state.accepting,onClick:e.confirmAccept,class:"confirm"},{default:T((()=>[X])),_:1},8,["loading","onClick"])])])),default:T((()=>[g("div",R,[z,g("span",null,[I,g("span",M,D(e.state.tableData.length),1),W])])])),_:1},8,["modelValue"]),g(w,{width:"516px",modelValue:e.state.batchSetTempDialog,"onUpdate:modelValue":l[6]||(l[6]=l=>e.state.batchSetTempDialog=l)},{title:T((()=>[j])),footer:T((()=>[g("div",G,[g(c,{onClick:l[5]||(l[5]=l=>e.state.batchSetTempDialog=!1),class:"cancel"},{default:T((()=>[L])),_:1}),g(c,{type:"primary",onClick:e.confirmBatchSetTemp,class:"confirm"},{default:T((()=>[Q])),_:1},8,["onClick"])])])),default:T((()=>[g(k,{model:e.state.batchSetTempForm,rules:e.batchSetTempFormRules,ref:"batchSetTempFormRef"},{default:T((()=>[g(S,{label:"验收温度","label-width":e.labelWidth,prop:"temp"},{default:T((()=>[g(d,{modelValue:e.state.batchSetTempForm.temp,"onUpdate:modelValue":l[4]||(l[4]=l=>e.state.batchSetTempForm.temp=l),placeholder:"请输入验收温度",autocomplete:"off",clearable:""},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}]]))}}}));
