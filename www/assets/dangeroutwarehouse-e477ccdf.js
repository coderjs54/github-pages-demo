var x=Object.defineProperty,ee=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var W=(e,t,r)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))te.call(t,r)&&W(e,r,t[r]);if(O)for(var r of O(t))ne.call(t,r)&&W(e,r,t[r]);return e},H=(e,t)=>ee(e,ae(t));import{d as oe,i as R,r as re,c as y,I as D,w as le,o as ue,E as i,m as d,q as c,y as u,G as s,N as se,C as f,z as b,F as z,A as ie}from"../vendors/element-plus-6f9977bb.js";import{r as pe,U as de,_ as ce,d as ge,u as he,b as me}from"./index.1a2bb961.js";function be(e){return pe.post(de.OUTWAREHOUSE.queryUsable,e)}const Ce=oe({setup(){const e=ge(),t=he(),r=me(),I=R("exportPDF"),N=R("setTableHeaders"),F=()=>{a.loading=!0;const{pageSize:o,currentPage:h}=D(a.pagination),{dateRange:n,searchWord:p}=D(a.searchParam),{department:l,materialType:P,brand:_,instrument:k,warehouse:w}=D(a.searchMoreParam),[T,B]=n||["",""];be({BeginDate:T,EndDate:B,SearchWord:p,DepartmentId:l,MaterialType:P,Brand:_,Instrument:k,GoodsShelf:w,isHazardousChemical:1,NeedPaging:!0,PageNum:h,RecordPerPage:o}).then(m=>{a.pagination.total=m.TotalRecordCount,E(m.Stores)}).finally(()=>{a.loading=!1})},E=o=>{a.tableData=o.map(h=>{const{material:n,store:p,InStockStaking:l}=h,{id:P,MaterialId:_,Operator1Id:k,amount:w,unit:T,GoodsShelf:B,EndDate:U,CloneNumber:m,DiseaseType:A,DepartmentName:V,DepartmentOwner:q,LotNumber:L,ChangeReason:G,DeliverOrderId:Y,OperateTime:$}=p,{system_code:K,name:j,short_name:J,brand_id:Q,material_type:X,spec:Z}=n||{};return{id:P,material:n,inventory_check_status:l?"\u76D8\u5E93\u4E2D":"\u53EF\u9886\u7528",hospital_code:_,system_code:K,name:j,Operator1Id:k,ChangeReason:G,shortname:J,LotNumber:L,brandName:a.brandIdMap[Q],department:V,DepartmentId:q,inventory:w,standard:Z,unit:a.MinUnitTypeMap.get(T),kind:a.MaterialTypeMap.get(X),validity:U.substring(0,10),position1:B,CloneNumber:m||"\u65E0",DiseaseType:A,DeliverOrderId:Y,OperateTime:$.replace("T"," ")}})},S={changeReasons:{\u4E09\u7EA7\u51FA\u5E93:"level-three-out",\u9886\u7528:"request-for-use",\u7528\u5269\u5F52\u8FD8:"return-back"},inventoryCheckStatus:{\u53EF\u9886\u7528:"default",\u76D8\u5E93\u4E2D:"danger"}},a=re({loading:!1,searchParam:{dateRange:"",searchWord:""},searchMoreParam:{department:"",materialType:"",brand:"",instrument:"",warehouse:""},pagination:{currentPage:1,total:0,pageSize:30},headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1",width:90},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u76D8\u70B9\u72B6\u6001",prop:"inventory_check_status"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u89C4\u683C",prop:"standard"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u4EA4\u8D27\u5355ID",prop:"DeliverOrderId"},{label:"\u54C1\u724C",prop:"brandName"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u51FA\u5E93\u4EBA",prop:"Operator1Id"},{label:"\u64CD\u4F5C\u65F6\u95F4",prop:"OperateTime"},{label:"\u5E93\u5B58\u91CF",prop:"inventory"},{label:"\u5355\u4F4D",prop:"unit"},{label:"\u5E93\u5B58\u53D8\u52A8\u539F\u56E0",prop:"ChangeReason"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u6548\u671F",prop:"validity",width:110},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],tableData:[],multipleSelection:[],PDFHandling:!1,brandIdMap:y(()=>e.getters.brandIdMap),MaterialTypeMap:y(()=>e.getters.MaterialTypeMap),MinUnitTypeMap:y(()=>e.getters.MinUnitTypeMap)}),g=o=>{o&&(a.pagination.currentPage=1),F()},C=y(()=>a.headersConfig.filter(o=>!o.hidden)),M={calcHeaderWidth:R("calcHeaderMinWidth"),handleClickSetting(){N(a.headersConfig,o=>{a.headersConfig=o})},handlePaginationChange(){g(!1)},handleSearch(){g(!0)},handleSearchMoreParamChange(o){a.searchMoreParam=o,g(!0)},handleChangeMultiple(o){a.multipleSelection=o},handleModify(o){console.log(o)},handleExportPDF(){a.PDFHandling=!0,I(a.headersConfig,a.tableData,"\u6D4B\u8BD5\u6587\u4EF6").finally(()=>{a.PDFHandling=!1})},handleGoToOutWarehouse(){const o=D(a.multipleSelection);!o.length||t.push({name:"dangeroutwarehousing",params:{chosenTableData:JSON.stringify(o)}})}};return le(()=>e.getters.settings,()=>{a.headersConfig=e.getters.settings[r.name]||a.headersConfig}),ue(()=>{F()}),H(v(v({state:a},M),S),{headersShown:C})}}),ye={class:"date-box"},De=f("\u67E5\u8BE2"),fe={key:2};function Fe(e,t,r,I,N,F){const E=i("el-date-picker"),S=i("el-input"),a=i("el-button"),g=i("styled-search"),C=i("el-tag"),M=i("el-table-column"),o=i("styled-table"),h=i("styled-pagination");return d(),c(z,null,[u(g,{onChooseSearchMoreParam:e.handleSearchMoreParamChange},{"styled-search-left":s(()=>[u("div",ye,[u(E,{modelValue:e.state.searchParam.dateRange,"onUpdate:modelValue":t[1]||(t[1]=n=>e.state.searchParam.dateRange=n),type:"daterange","value-format":"YYYY-MM-DD","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),u(S,{modelValue:e.state.searchParam.searchWord,"onUpdate:modelValue":t[2]||(t[2]=n=>e.state.searchParam.searchWord=n),placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5173\u952E\u5B57",clearable:"",onKeydown:se(e.handleSearch,["enter"]),onClear:e.handleSearch},null,8,["modelValue","onKeydown","onClear"]),u(a,{type:"primary",class:"search",onClick:e.handleSearch},{default:s(()=>[De]),_:1},8,["onClick"])]),"styled-search-right":s(()=>[u(a,{type:"success",class:"export",disabled:e.state.multipleSelection.length===0,onClick:e.handleGoToOutWarehouse},{default:s(()=>[f("\u51FA\u5E93("+b(e.state.multipleSelection.length)+") ",1)]),_:1},8,["disabled","onClick"])]),_:1},8,["onChooseSearchMoreParam"]),u(o,{loading:e.state.loading,multiple:"",setting:"",data:e.state.tableData,onChangeMultiple:e.handleChangeMultiple,onClickSetting:e.handleClickSetting},{"table-columns":s(()=>[(d(!0),c(z,null,ie(e.headersShown,(n,p)=>(d(),c(M,{"show-overflow-tooltip":"",key:p,prop:n.prop,label:n.label,"min-width":e.calcHeaderWidth(n,p)},{header:s(l=>[u("span",null,b(l.column.label),1)]),default:s(l=>[l.column.property==="ChangeReason"?(d(),c(C,{key:0,class:e.changeReasons[l.row[n.prop]]},{default:s(()=>[f(b(l.row[n.prop]),1)]),_:2},1032,["class"])):l.column.property==="inventory_check_status"?(d(),c(C,{key:1,type:e.inventoryCheckStatus[l.row[n.prop]]},{default:s(()=>[f(b(l.row[n.prop]),1)]),_:2},1032,["type"])):(d(),c("span",fe,b(l.row[n.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["loading","data","onChangeMultiple","onClickSetting"]),u(h,{total:e.state.pagination.total,"current-page":e.state.pagination.currentPage,"onUpdate:current-page":t[3]||(t[3]=n=>e.state.pagination.currentPage=n),"page-size":e.state.pagination.pageSize,"onUpdate:page-size":t[4]||(t[4]=n=>e.state.pagination.pageSize=n),onPaginationChange:e.handlePaginationChange},null,8,["total","current-page","page-size","onPaginationChange"])],64)}var Pe=ce(Ce,[["render",Fe]]);export{Pe as default};
