var v=Object.defineProperty,A=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var R=(e,t,a)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,D=(e,t)=>{for(var a in t||(t={}))H.call(t,a)&&R(e,a,t[a]);if(B)for(var a of B(t))U.call(t,a)&&R(e,a,t[a]);return e},w=(e,t)=>A(e,N(t));import{r as V,U as O,_ as S,u as T,b as W,d as $}from"./index.1a2bb961.js";import{d as q,r as G,c as L,i as z,S as f,w as I,O as j,E as p,m as d,q as m,y as u,G as r,F as g,A as J,z as F,C as c}from"../vendors/element-plus-6f9977bb.js";import{_ as P}from"./tip-1b2ff95a.js";function K(e){return V.post(O.INWAREHOUSE.batchReturn,e)}const Q=q({name:"inwarehousing",setup(){const e=T(),t=W(),a=$(),_={FROM_WHERE:"/inwarehouse"},o=G({MinUnitTypeMap:L(()=>a.getters.MinUnitTypeMap),searchParam:{invoiceTogether:!0},totalMoney:0,tableData:[],headersConfig:[{label:"\u5E8F\u53F7",prop:"id"},{label:"\u9662\u5185\u7801",prop:"hospital_code"},{label:"\u5E93\u4F4D",prop:"position1"},{label:"\u7CFB\u7EDF\u7801",prop:"system_code"},{label:"\u7269\u6599\u540D\u79F0",prop:"name"},{label:"\u7269\u6599\u7B80\u79F0",prop:"shortname"},{label:"\u7269\u6599\u89C4\u683C",prop:"size"},{label:"\u7269\u6599\u6279\u53F7",prop:"LotNumber"},{label:"\u54C1\u724C\u540D\u79F0",prop:"brand"},{label:"\u7EC4\u7EC7\u540D\u79F0",prop:"department"},{label:"\u64CD\u4F5C\u65F6\u95F4",prop:"OperateTime"},{label:"\u9886\u7528\u6570\u91CF",prop:"use_amount"},{label:"\u5F52\u8FD8\u6570\u91CF",prop:"return_number"},{label:"\u5E93\u5B58\u53D8\u52A8\u539F\u56E0",prop:"ChangeReason"},{label:"\u7269\u6599\u7C7B\u578B",prop:"kind"},{label:"\u7269\u6599\u6548\u671F",prop:"validity"},{label:"\u514B\u9686\u53F7",prop:"CloneNumber"},{label:"\u75C5\u79CD\u7C7B\u578B",prop:"DiseaseType"}],returnDialog:!1,returning:!1}),E={calcHeaderWidth:z("calcHeaderMinWidth"),handleReturn(){o.returnDialog=!0},handleGoBack(){e.go(-1)},confirmReturn(){if(o.tableData.some(l=>Number(l.return_number)<=0))return f.error("\u4E0D\u5141\u8BB8\u5C06\u5F52\u8FD8\u91CF\u8BBE\u7F6E\u4E3A\u975E\u6B63\u6570\uFF01\uFF01\uFF01");if(o.tableData.some(l=>Number(l.return_number)>Number(l.use_amount)))return f.error("\u5F52\u8FD8\u91CF\u4E0D\u5141\u8BB8\u5927\u4E8E\u4E0A\u6B21\u7684\u9886\u7528\u91CF\uFF01\uFF01\uFF01");const n={ReturnHChemicals:o.tableData.map(l=>{const{id:b,return_number:h,unit:C}=l;return{StoreId:b,unit:C,amount:Number(h)}})};o.returning=!0,K(n).then(()=>{f.success("\u64CD\u4F5C\u6210\u529F"),e.push(_.FROM_WHERE)}).finally(()=>{o.returning=!1,o.returnDialog=!1})}};return I(()=>a.getters.settings,()=>{o.headersConfig=a.getters.settings[t.name]||o.headersConfig}),j(()=>{let n=t.params.chosenTableData;if(!n||(n=JSON.parse(n),!n.length))return e.push(_.FROM_WHERE);o.tableData=n.map(l=>w(D({},l),{return_number:0}))}),D({state:o},E)}}),X=c("\u786E\u5B9A\u5F52\u8FD8"),Y=c("\u8FD4\u56DE\u9009\u62E9"),Z={style:{"margin-left":"4px"}},x={key:1},ee=u("div",{class:"title"},"\u63D0\u793A",-1),te={class:"tip-body"},ue=u("img",{src:P,alt:""},null,-1),ae=c("\u786E\u8BA4\u8981\u5BF9\u9009\u4E2D\u7684"),oe={class:"item-name"},ne=c("\u4E2A\u7269\u6599\u8FDB\u884C\u5F52\u8FD8\u5417?"),re={class:"right-footer"},le=c("\u53D6\u6D88"),se=c("\u786E\u5B9A");function ie(e,t,a,_,o,E){const n=p("el-button"),l=p("styled-search"),b=p("el-input"),h=p("el-table-column"),C=p("styled-table"),k=p("el-dialog");return d(),m(g,null,[u(l,{"hide-search-more":""},{"styled-search-right":r(()=>[u(n,{type:"primary",class:"search",onClick:e.handleReturn},{default:r(()=>[X]),_:1},8,["onClick"]),u(n,{type:"primary",plain:"",onClick:e.handleGoBack},{default:r(()=>[Y]),_:1},8,["onClick"])]),_:1}),u(C,{setting:"",data:e.state.tableData},{"table-columns":r(()=>[(d(!0),m(g,null,J(e.state.headersConfig,(s,y)=>(d(),m(h,{"show-overflow-tooltip":"",key:y,prop:s.prop,label:s.label,"min-width":e.calcHeaderWidth(s,y)},{header:r(i=>[u("span",null,F(i.column.label),1)]),default:r(i=>[i.column.property==="return_number"?(d(),m(g,{key:0},[u(b,{style:{width:"calc(100% - 25px)"},type:"text",modelValue:i.row[s.prop],"onUpdate:modelValue":M=>i.row[s.prop]=M},null,8,["modelValue","onUpdate:modelValue"]),u("span",Z,F(e.state.MinUnitTypeMap.get(i.row.unit)),1)],64)):(d(),m("span",x,F(i.row[s.prop]),1))]),_:2},1032,["prop","label","min-width"]))),128))]),_:1},8,["data"]),u(k,{width:"466px",modelValue:e.state.returnDialog,"onUpdate:modelValue":t[2]||(t[2]=s=>e.state.returnDialog=s)},{title:r(()=>[ee]),footer:r(()=>[u("div",re,[u(n,{onClick:t[1]||(t[1]=s=>e.state.returnDialog=!1),class:"cancel"},{default:r(()=>[le]),_:1}),u(n,{type:"primary",loading:e.state.returning,onClick:e.confirmReturn,class:"confirm"},{default:r(()=>[se]),_:1},8,["loading","onClick"])])]),default:r(()=>[u("div",te,[ue,u("span",null,[ae,u("span",oe,F(e.state.tableData.length),1),ne])])]),_:1},8,["modelValue"])],64)}var _e=S(Q,[["render",ie]]);export{_e as default};
