var M=Object.defineProperty;var E=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var b=(e,a,t)=>a in e?M(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,k=(e,a)=>{for(var t in a||(a={}))G.call(a,t)&&b(e,t,a[t]);if(E)for(var t of E(a))W.call(a,t)&&b(e,t,a[t]);return e};import{d as Y,r as H,c as D,w as f,I,S as q,E as F,m as n,q as d,G as s,y as l,F as N,A as R,K as y,t as U,x as $,C as w}from"../vendors/element-plus-6f9977bb.js";import{r as K,b as j,c as O,d as P,_ as T}from"./failed-0ae6e7e8.js";import{r as i,U as c,_ as z}from"./index.1a2bb961.js";import{_ as A}from"./md5-3215d1da.js";function ve(e){return i.post(c.INWAREHOUSE.batchReturn,e)}function Ce(e){return i.post(c.DANGER.querySecondPerson,{DepartmentIds:e})}function J(e){return i.post(c.DANGER.beginReturnProcedure,e)}function Be(e){return i.post(c.INVENTORY.queryInventory,e)}function ye(e){return i.post(c.WAREHOUSE.queryWarehouse,e)}function fe(e){return i.post(c.INVENTORY.beginInventoryCheck,e)}function Ae(e){return i.post(c.INVENTORY.endInventoryCheck,e)}function we(e){return i.post(c.INVENTORY.modifyInventoryCheckList,e)}function he(e){return i.post(c.INVENTORY.abandonInventoryCheck,e)}function Se(e){return i.post(c.DANGER.querySecondPerson,{DepartmentIds:e})}function Q(e){return i.post(c.DANGER.beginCheckProcedure,e)}const X=Y({props:{purpose:{type:String,required:!0},param:{type:String,required:!0},dialogShow:{type:Boolean,required:!0},acceptors:{type:Array,required:!0},ids:{type:[Array,String],required:!0}},emits:["validate-success","update:dialogShow"],setup(e,{emit:a}){const t=H({dialogShow:!1,validateForm1:{way:"1",validateSuccess:!1,acceptor:"",password:"",captcha:""},validateForm2:{way:"1",validateSuccess:!1,acceptor:"",password:"",captcha:""},isSecondAdminFailed:!1}),V=D(()=>!t.validateForm1.acceptor||!t.validateForm2.acceptor),h=D(()=>{if(e.purpose==="DeliverOrder")return K;if(e.purpose==="Use")return j;if(e.purpose==="Return")return J;if(e.purpose==="FinishStockTaking")return Q}),S={handleValidateFirstAcceptor(){const u=e.ids,v=t.validateForm1.acceptor,r=t.validateForm2.acceptor;return h.value({[e.param]:u,Admins:[v,r]}).then(()=>{const{acceptor:p,way:m,password:C,captcha:B}=I(t.validateForm1);if(m==="1"){const o=A(`${C}-91360`),g=String(Math.floor(Date.now()/1e3)),L=A(`${o}-${g}`);return O({InspectionType:e.purpose,OrderIds:Array.isArray(u)?u:[u],IsFirstAdmin:!0,Username:p,Password:L,salt:g}).then(()=>{t.validateForm1.validateSuccess=!0})}else if(m==="2")return P({InspectionType:e.purpose,OrderIds:Array.isArray(u)?u:[u],IsFirstAdmin:!0,MobileCode:B}).then(()=>{t.validateForm1.validateSuccess=!0})})},async handleValidateSecondAcceptor(){t.isSecondAdminFailed&&(t.validateForm1.validateSuccess=!1,await S.handleValidateFirstAcceptor());const u=Array.isArray(e.ids)?e.ids:[e.ids],{acceptor:v,way:r,password:p,captcha:m}=I(t.validateForm2);if(r==="1"){const C=A(`${p}-91360`),B=String(Math.floor(Date.now()/1e3)),o=A(`${C}-${B}`);O({InspectionType:e.purpose,OrderIds:u,IsFirstAdmin:!1,Username:v,Password:o,salt:B}).then(()=>{t.validateForm2.validateSuccess=!0,a("validate-success"),t.isSecondAdminFailed=!1}).catch(()=>{t.isSecondAdminFailed=!0})}else r==="2"&&P({InspectionType:e.purpose,OrderIds:u,IsFirstAdmin:!1,MobileCode:m}).then(()=>{t.validateForm2.validateSuccess=!0,a("validate-success"),t.isSecondAdminFailed=!1}).catch(()=>{t.isSecondAdminFailed=!0})},handleCloseValidateAcceptorDialog(){t.dialogShow=!1,a("update:dialogShow",!1)}};return f(()=>e.dialogShow,u=>{u&&(t.dialogShow=!0)}),f(()=>e.dialogShow,u=>{u||(t.validateForm1={way:"1",validateSuccess:!1,acceptor:"",password:"",captcha:""},t.validateForm2={way:"1",validateSuccess:!1,acceptor:"",password:"",captcha:""})}),f(()=>t.validateForm1.way,u=>{u==="3"&&q.warning("\u751F\u7269\u8BC6\u522B\u7684\u529F\u80FD\u6B63\u5728\u5F00\u53D1\u4E2D\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85")}),f(()=>t.validateForm2.way,u=>{u==="3"&&q.warning("\u751F\u7269\u8BC6\u522B\u7684\u529F\u80FD\u6B63\u5728\u5F00\u53D1\u4E2D\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85")}),k({props:e,state:t,acceptorsNotChosen:V,reqBeginProcess:h},S)}}),Z=l("div",{class:"title"},"\u53CC\u4EBA\u53CC\u9501\u9A8C\u8BC1",-1),_={class:"feedback-img",src:T,alt:"\u9A8C\u8BC1\u6210\u529F"},x=w("\u786E\u8BA4\u8BC6\u522B"),ee=l("span",{class:"separator"},"|",-1),ae=l("span",{class:"separator"},"|",-1),te={class:"feedback-img",src:T,alt:"\u9A8C\u8BC1\u6210\u529F"},oe=w("\u786E\u8BA4\u8BC6\u522B "),le=l("span",{class:"separator"},"|",-1),ue=l("span",{class:"separator"},"|",-1),se={class:"center-footer"},re=w("\u53D6\u6D88"),ne=w("\u786E\u8BA4");function de(e,a,t,V,h,S){const u=F("el-option"),v=F("el-select"),r=F("el-form-item"),p=F("el-input"),m=F("el-button"),C=F("el-form"),B=F("el-dialog");return n(),d(B,{"custom-class":"validate-acceptor",width:"940px",modelValue:e.state.dialogShow,"onUpdate:modelValue":a[15]||(a[15]=o=>e.state.dialogShow=o),onClose:e.handleCloseValidateAcceptorDialog},{title:s(()=>[Z]),footer:s(()=>[l("div",se,[l(m,{class:"cancel",onClick:e.handleCloseValidateAcceptorDialog},{default:s(()=>[re]),_:1},8,["onClick"]),l(m,{type:"primary",class:"confirm",onClick:e.handleCloseValidateAcceptorDialog},{default:s(()=>[ne]),_:1},8,["onClick"])])]),default:s(()=>[l(C,{model:e.state.validateForm1,inline:""},{default:s(()=>[l(r,{label:"\u7B2C\u4E00\u9A8C\u6536\u4EBA"},{default:s(()=>[l(v,{modelValue:e.state.validateForm1.acceptor,"onUpdate:modelValue":a[1]||(a[1]=o=>e.state.validateForm1.acceptor=o),placeholder:"\u8BF7\u9009\u62E9\u7B2C\u4E00\u9A8C\u6536\u4EBA"},{default:s(()=>[(n(!0),d(N,null,R(e.acceptors,o=>(n(),d(u,{label:o.label,value:o.value,key:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.state.validateForm1.way==="1"?(n(),d(r,{key:0,label:"\u8EAB\u4EFD\u9A8C\u8BC1"},{default:s(()=>[l(p,{modelValue:e.state.validateForm1.password,"onUpdate:modelValue":a[2]||(a[2]=o=>e.state.validateForm1.password=o),type:"password","show-password":"",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5BC6\u7801"},null,8,["modelValue"])]),_:1})):y("",!0),e.state.validateForm1.way==="2"?(n(),d(r,{key:1,label:"\u8EAB\u4EFD\u8BC6\u522B"},{default:s(()=>[l(p,{modelValue:e.state.validateForm1.captcha,"onUpdate:modelValue":a[3]||(a[3]=o=>e.state.validateForm1.captcha=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},null,8,["modelValue"])]),_:1})):y("",!0),e.state.validateForm1.way==="3"?(n(),d(r,{key:2,label:"\u8EAB\u4EFD\u9A8C\u8BC1"},{default:s(()=>[l(p,{disabled:"",modelValue:e.state.validateForm1.captcha,"onUpdate:modelValue":a[4]||(a[4]=o=>e.state.validateForm1.captcha=o),placeholder:"\u8BF7\u767B\u5F55APP\u5F85\u9A8C\u8BC1"},null,8,["modelValue"])]),_:1})):y("",!0),l(r,null,{default:s(()=>[U(l("img",_,null,512),[[$,e.state.validateForm1.validateSuccess]]),l(m,{type:"primary",disabled:e.acceptorsNotChosen,onClick:e.handleValidateFirstAcceptor},{default:s(()=>[x]),_:1},8,["disabled","onClick"])]),_:1}),l("span",{class:["accept-way-choice",{underline:e.state.validateForm1.way==="1"}],onClick:a[5]||(a[5]=o=>e.state.validateForm1.way="1")},"\u5BC6\u7801\u8BC6\u522B",2),ee,l("span",{class:["accept-way-choice",{underline:e.state.validateForm1.way==="2"}],onClick:a[6]||(a[6]=o=>e.state.validateForm1.way="2")},"\u9A8C\u8BC1\u7801\u8BC6\u522B",2),ae,l("span",{class:["accept-way-choice",{underline:e.state.validateForm1.way==="3"}],onClick:a[7]||(a[7]=o=>e.state.validateForm1.way="3")},"\u751F\u7269\u8BC6\u522B",2)]),_:1},8,["model"]),l(C,{model:e.state.validateForm2,inline:""},{default:s(()=>[l(r,{label:"\u7B2C\u4E8C\u9A8C\u6536\u4EBA"},{default:s(()=>[l(v,{modelValue:e.state.validateForm2.acceptor,"onUpdate:modelValue":a[8]||(a[8]=o=>e.state.validateForm2.acceptor=o),placeholder:"\u8BF7\u9009\u62E9\u7B2C\u4E8C\u9A8C\u6536\u4EBA"},{default:s(()=>[(n(!0),d(N,null,R(e.acceptors,o=>(n(),d(u,{label:o.label,value:o.value,key:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.state.validateForm2.way==="1"?(n(),d(r,{key:0,label:"\u8EAB\u4EFD\u9A8C\u8BC1"},{default:s(()=>[l(p,{modelValue:e.state.validateForm2.password,"onUpdate:modelValue":a[9]||(a[9]=o=>e.state.validateForm2.password=o),type:"password","show-password":"",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5BC6\u7801"},null,8,["modelValue"])]),_:1})):y("",!0),e.state.validateForm2.way==="2"?(n(),d(r,{key:1,label:"\u8EAB\u4EFD\u8BC6\u522B"},{default:s(()=>[l(p,{modelValue:e.state.validateForm2.captcha,"onUpdate:modelValue":a[10]||(a[10]=o=>e.state.validateForm2.captcha=o),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},null,8,["modelValue"])]),_:1})):y("",!0),e.state.validateForm2.way==="3"?(n(),d(r,{key:2,label:"\u8EAB\u4EFD\u9A8C\u8BC1"},{default:s(()=>[l(p,{disabled:"",modelValue:e.state.validateForm2.captcha,"onUpdate:modelValue":a[11]||(a[11]=o=>e.state.validateForm2.captcha=o),placeholder:"\u8BF7\u767B\u5F55APP\u5F85\u9A8C\u8BC1"},null,8,["modelValue"])]),_:1})):y("",!0),l(r,null,{default:s(()=>[U(l("img",te,null,512),[[$,e.state.validateForm2.validateSuccess]]),l(m,{type:"primary",disabled:e.acceptorsNotChosen||!e.state.validateForm1.validateSuccess,onClick:e.handleValidateSecondAcceptor},{default:s(()=>[oe]),_:1},8,["disabled","onClick"])]),_:1}),l("span",{class:["accept-way-choice",{underline:e.state.validateForm2.way==="1"}],onClick:a[12]||(a[12]=o=>e.state.validateForm2.way="1")},"\u5BC6\u7801\u8BC6\u522B",2),le,l("span",{class:["accept-way-choice",{underline:e.state.validateForm2.way==="2"}],onClick:a[13]||(a[13]=o=>e.state.validateForm2.way="2")},"\u9A8C\u8BC1\u7801\u8BC6\u522B",2),ue,l("span",{class:["accept-way-choice",{underline:e.state.validateForm2.way==="3"}],onClick:a[14]||(a[14]=o=>e.state.validateForm2.way="3")},"\u751F\u7269\u8BC6\u522B",2)]),_:1},8,["model"])]),_:1},8,["modelValue","onClose"])}var Ve=z(X,[["render",de]]);export{Ve as V,Se as a,we as b,Ae as c,he as d,ye as e,Be as f,ve as g,Ce as h,fe as r};
